(window.webpackJsonp=window.webpackJsonp||[]).push([[147],{UQSp:function(e,t,a){"use strict";t.a={name:"VueRemarkRoot",render:function(e){return e("div",null,this.$slots.default)}}},lNkI:function(e,t,a){"use strict";a.r(t);var n=a("KHd+"),o=a("UQSp"),r=a("Kw5r");function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}r.a.config.optionMergeStrategies;var i={VueRemarkRoot:o.a},h=function(e){var t=e.options.components=e.options.components||{},a=e.options.computed=e.options.computed||{};Object.keys(i).forEach((function(e){"object"===s(i[e])&&"function"==typeof i[e].render||"function"==typeof i[e]&&"function"==typeof i[e].options.render?t[e]=i[e]:a[e]=function(){return i[e]}}))},l=r.a.config.optionMergeStrategies,d="__vueRemarkFrontMatter",p={excerpt:null};var c=function(e){e.options[d]&&(e.options[d]=p),r.a.util.defineReactive(e.options,d,p),e.options.computed=l.computed({$frontmatter:function(){return e.options[d]}},e.options.computed)},u=Object(n.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("VueRemarkRoot",[a("div",{staticClass:"toc-wrapper col-md-3"},[a("ul",[a("li",[a("p",[a("a",{attrs:{href:"#the-galaxy-api"}},[e._v("The Galaxy API")])]),a("ul",[a("li",[a("a",{attrs:{href:"#whats-an-api-and-why-would-i-care"}},[e._v("What's an API and why would I care?")])]),a("li",[a("a",{attrs:{href:"#br-"}},[a("br")])])])]),a("li",[a("p",[a("a",{attrs:{href:"#how-to-access-and-use-the-api"}},[e._v("How to Access and Use the API")])]),a("ul",[a("li",[a("a",{attrs:{href:"#the-concepts-of-resources-verbs-and-the-rest-model"}},[e._v("The concepts of resources, verbs, and the REST model")])]),a("li",[a("a",{attrs:{href:"#br--1"}},[a("br")])])])]),a("li",[a("p",[a("a",{attrs:{href:"#a-sample-use"}},[e._v("A Sample Use")])]),a("ul",[a("li",[a("a",{attrs:{href:"#br--2"}},[a("br")])])])]),a("li",[a("p",[a("a",{attrs:{href:"#the-set-up"}},[e._v("The Set Up")])]),a("ul",[a("li",[a("a",{attrs:{href:"#the-api-key"}},[e._v("The API Key")])]),a("li",[a("a",{attrs:{href:"#structure"}},[e._v("Structure")])]),a("li",[a("a",{attrs:{href:"#br--3"}},[a("br")])])])]),a("li",[a("p",[a("a",{attrs:{href:"#the-steps"}},[e._v("The Steps")])]),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"#1-checking-your-key-with-the-user-api"}},[e._v("1. Checking your key with the user API")])])]),a("li",[a("p",[a("a",{attrs:{href:"#2-looking-at-your-histories-with-the-history-api"}},[e._v("2. Looking at your histories with the history API")])]),a("ul",[a("li",[a("a",{attrs:{href:"#histories_1py"}},[e._v("histories_1.py")])]),a("li",[a("a",{attrs:{href:"#histories_2py"}},[e._v("histories_2.py")])])])]),a("li",[a("p",[a("a",{attrs:{href:"#br--4"}},[a("br")])])])])]),a("li",[a("p",[a("a",{attrs:{href:"#in-the-future"}},[e._v("In the Future")])]),a("ul",[a("li",[a("a",{attrs:{href:"#br--5"}},[a("br")])])])]),a("li",[a("p",[a("a",{attrs:{href:"#more-resources-and-thanks"}},[e._v("More Resources and Thanks")])])])])]),a("div",{staticClass:"body-wrapper col-md-9"},[e._t("/events/gcc2013/header"),e._t("/events/gcc2013/linkbox"),a("div",{staticClass:"right"},[a("a",{attrs:{href:"/events/gcc2013/training-day/"}},[a("img",{attrs:{src:"/images/logos/GCC2013TrainingDayLogo300.png",alt:"Training Day",width:"200"}})])]),a("h1",{attrs:{id:"the-galaxy-api"}},[a("a",{attrs:{href:"#the-galaxy-api","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),e._v("The Galaxy API")]),a("p",[e._v("The Galaxy API is a way of interacting with Galaxy data without using the web-based, user interface.")]),a("p",[e._v("A more thorough explanation can be found at "),a("a",{attrs:{href:"/learn/api/"}},[e._v("Learn/API")]),e._v(" along with some general steps on\nhow to begin using the API. This page may duplicate some of that data in order to keep information relevant to the\nworkshop in one place.")]),a("p",[e._v("Full documentation for each API function and module is posted at\n"),a("a",{attrs:{href:"http://galaxy-dist.readthedocs.org/en/latest/lib/galaxy.webapps.galaxy.api.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("ReadTheDocs.org")]),e._v(".")]),a("p",[e._v("This Wiki page is the outline of a 2013 GCC workshop that attempts to teach the conventions of Galaxy's API\nwhile building an example script.")]),a("br")],2),a("h2",{attrs:{id:"whats-an-api-and-why-would-i-care"}},[a("a",{attrs:{href:"#whats-an-api-and-why-would-i-care","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),e._v("What's an API and why would I care?")]),a("p",[e._v("An API (Application Programming Interface) is the syntax defined by a program for how it can be controlled by another.")]),a("p",[e._v("A web (REST or REpresentational State Transfer) API is just an another API where the syntax,\ninstead of function calls and their arguments, is made up of a series of URLs and HTTP requests. The server providing\nthe web API becomes the program and the URLs become the commands - all through the "),a("em",[e._v("medium")]),e._v(" of the HTTP protocol.")]),a("p",[e._v("Imagine if your home had a web API. You might be able to turn on the lights simply by typing\n"),a("code",{pre:!0},[e._v("myhouse.net/lights/dining-room/on")]),e._v(", "),a("code",{pre:!0},[e._v("myhouse.net/fireplace/on?setting=low")]),e._v(", etc. Each URL entered\nwould tell this external system (your home) to perform a single action.")]),a("p",[e._v("You certainly can do these things yourself by manually turning light switches on and lighting fires -\nbut the key advantages to an API are that you can:")]),a("ol",[a("li",[e._v("Iteratively accomplish tasks:\n"),a("code",{pre:!0},[e._v("for every book in the bedroom, return the book to the bookshelf (ok - that probably won't be possible any time soon - but wouldn't it be nice)")])]),a("li",[e._v("Scheduled or responsive tasks even when you're not around:\n"),a("code",{pre:!0},[e._v("when I'm on vacation, feed the cat everyday at 8am and bring in the mail at 2pm")])]),a("li",[e._v("Compose complex tasks/scripts from simple tasks to remove the tedium of common scenarios:\n"),a("code",{pre:!0},[e._v("wake me up at 6:00am, turn on the lights, and start making some frighteningly strong coffee")]),e._v(" → "),a("code",{pre:!0},[e._v("ohgodmorning.py")])])]),a("p",[e._v("In more Galaxy specific terms, the web API allows you to use Galaxy's capabilities programmatically:\nrunning a workflow "),a("em",[e._v("over each file")]),e._v(" in a directory, moving a dataset to a library "),a("em",[e._v("only if")]),e._v(" it passes some QA\nthreshold, upload a fastq file "),a("em",[e._v("when")]),e._v(" the sequencer finishes writing it, or "),a("em",[e._v("combine")]),e._v(" any or all of the above into\nanother script.")]),a("p",[e._v("Additionally, and perhaps more importantly: even when your scripts run, the features that make Galaxy great are still\napplied to your data:")]),a("ul",[a("li",[e._v("histories still capture the exact steps of your experiments and reproducibility is maintained,")]),a("li",[e._v("jobs and compute resources are still managed for you,")]),a("li",[e._v("datasets and metadata persist and are centrallized,")]),a("li",[e._v("your work is still sharable,")]),a("li",[e._v("etc.")])]),a("p",[e._v("It's also worth noting that all the work you did via the API is still accessible and modifiable when you return to the UI.")]),a("h2",{attrs:{id:"br-"}},[a("a",{attrs:{href:"#br-","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),a("br")]),a("h1",{attrs:{id:"how-to-access-and-use-the-api"}},[a("a",{attrs:{href:"#how-to-access-and-use-the-api","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),e._v("How to Access and Use the API")]),a("p",[e._v("Anything that can communicate over HTTP can use the Galaxy web API.")]),a("ul",[a("li",[e._v("browser - capable of only simple GET API methods")]),a("li",[e._v("wget - only GET methods - but from the command line")]),a("li",[e._v("curl - a unix program that will let you use any API method")])]),a("p",[e._v("Some programming or scripting languages have their own libraries to do this:")]),a("ul",[a("li",[e._v("python - urllib, urllib2 (can be complicated), requests (simplifies, but still many options)")]),a("li",[e._v("javascript - jquery (use any API method, browser only), node (any method, command line)")]),a("li",[e._v("bash - curl + bash = you're probably a bioinformaticist")])]),a("p",[e._v("There are several scripts and excellent programming libraries designed to help with the Galaxy API:")]),a("ul",[a("li",[e._v("scripts/api - a small selection of simple scripts and examples that can help you write and explore interacting with\nthe galaxy API in python, located in the root directory of a Galaxy installation")]),a("li",[e._v("bioblend - ("),a("a",{attrs:{href:"https://github.com/afgane/bioblend",target:"_blank",rel:"noopener noreferrer"}},[e._v("source")]),e._v(", "),a("a",{attrs:{href:"http://blend.readthedocs.org/en/latest/",target:"_blank",rel:"noopener noreferrer"}},[e._v("documentation")]),e._v(")\na library for use in python that greatly simplifies writing complex Galaxy API interactions")]),a("li",[e._v("blend4j - ("),a("a",{attrs:{href:"https://github.com/jmchilton/blend4j",target:"_blank",rel:"noopener noreferrer"}},[e._v("source")]),e._v(", "),a("a",{attrs:{href:"https://github.com/jmchilton/blend4j#readme",target:"_blank",rel:"noopener noreferrer"}},[e._v("documentation")]),e._v(")\na library for use in Java based on bioblend")])]),a("p",[e._v("Data returned from (and in some cases passed to) the Galaxy API is often described or formatted in\n"),a("a",{attrs:{href:"http://en.wikipedia.org/wiki/JSON",target:"_blank",rel:"noopener noreferrer"}},[e._v("JSON")]),e._v(" (JavaScript Object Notation) - a compact and flexible way of describing\nrelatively complex data structures. Conversion to the language you may be programming in is automatic in the case of the\nscripts/api directory, BioBlend, and !Blend4j and relatively easy for python, and a non-issue for JavaScript.")]),a("br"),a("h2",{attrs:{id:"the-concepts-of-resources-verbs-and-the-rest-model"}},[a("a",{attrs:{href:"#the-concepts-of-resources-verbs-and-the-rest-model","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),e._v("The concepts of resources, verbs, and the REST model")]),a("p",[e._v("A common way to construct an API command is to view it as a simple (imperative) sentence: [verb]  [a resource]")]),a("ul",[a("li",[e._v("What are resources? The datasets you upload and generate from tools, the tools themselves, jobs, histories,\nlibraries, even you (a "),a("code",{pre:!0},[e._v("galaxy_user")]),e._v(") - essentially any "),a("em",[e._v("thing")]),e._v(" in Galaxy that is recorded in the database.")]),a("li",[e._v("Your verbs are "),a("a",{attrs:{href:"http://en.wikipedia.org/wiki/CRUD",target:"_blank",rel:"noopener noreferrer"}},[e._v("CRUD (Create, Retrieve, Update, Delete)")]),e._v(" - considered by many to\nbe the four building blocks of any interaction with a database and, because of that, resources. Some map to the\nsentence metaphor well (e.g. "),a("code",{pre:!0},[e._v("delete a history")]),e._v(") others do not (e.g. "),a("code",{pre:!0},[e._v("create a workflow")]),e._v(" would "),a("em",[e._v("run")]),e._v(" a workflow).")]),a("li",[e._v("The HTTP versions of CRUD are POST (Create), GET (Retrieve), PUT (Update), and DELETE (Delete). There are\nothers but they don't apply (yet). These are\n"),a("a",{attrs:{href:"http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods",target:"_blank",rel:"noopener noreferrer"}},[e._v("HTTP request methods")]),e._v(".")]),a("li",[e._v("Often additional options and parameters must be passed to specify how the command should take place.")])]),a("p",[e._v("From that then, it follows that each web API URL (command) is composed of three parts:")]),a("ol",[a("li",[e._v("an HTTP method - the verb")]),a("li",[e._v("a URL path - the resource")]),a("li",[e._v("and any additional arguments or parameters the API command may need")])]),a("h2",{attrs:{id:"br--1"}},[a("a",{attrs:{href:"#br--1","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),a("br")]),a("h1",{attrs:{id:"a-sample-use"}},[a("a",{attrs:{href:"#a-sample-use","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),e._v("A Sample Use")]),a("p",[e._v("We'll slowly build a fairly complex script using the API to:")]),a("ul",[a("li",[e._v("Create a history")]),a("li",[e._v("Upload a file from our local system to the server and place it in that history (data/myIlluminaRun.solexa.fastq -\nalso available from "),a("a",{attrs:{href:"https://main.g2.bx.psu.edu/u/aun1/h/quickie-14",target:"_blank",rel:"noopener noreferrer"}},[e._v("this published history on Galaxy Main")]),e._v(")")]),a("li",[e._v("Run a workflow on that file "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/Galaxy-Workflow-Joined_Solexa_QC.ga",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/Galaxy-Workflow-Joined_Solexa_QC.ga")]),e._v(" (already available in your instance)")]),a("li",[e._v("Get some information about the workflow")]),a("li",[e._v("Rename the file and annotate it")]),a("li",[e._v("Copy the file to a library")])]),a("p",[e._v("The final script should not be considered a 'good' script, however, because a good script would take into account:")]),a("ul",[a("li",[e._v("Complications: typically in a robust script/application, a significant amount of code will go towards handling\n"),a("a",{attrs:{href:"http://en.wikipedia.org/wiki/Corner_case",target:"_blank",rel:"noopener noreferrer"}},[e._v("corner-cases")]),e._v(". For the sake of making the learning examples clear and\neasy to follow, we won't cover very many of these situations.")]),a("li",[e._v("Error handling: errors can and will occur during development. Again in this case, we'll only make limited use\nof python's error handling capability and a real script would have more and better handling. "),a("strong",[e._v("We want everyone to be\nable to follow along, however, so if you do see an error - please, let us know and we can try and get you past it.")])]),a("li",[e._v("Windows compatibility: these scripts aren't tested with Windows (but they should work with some minor tweaking).")])]),a("p",[e._v("There are 10 steps total to building the script. Each step (step_1.py, step_2.py, ...) has its own progressively longer\nversion of the final script, adding new sections and new functionality.")]),a("p",[e._v("As each step introduces new functionality in the API, they will themselves include new, short modules that center\naround some resource and the API methods that can be applied to them. For example, when writing step_2.py, we'll create\nseveral history scripts (histories_1.py, histories_2.py) that each add more to what we can do with histories. step_2.py\nwill then "),a("code",{pre:!0},[e._v("import")]),e._v(" these smaller modules to combine them into our final script.")]),a("p",[e._v("Also note: that almost every 'resource' script can function on its own, providing some functionality (such as querying\nor creating).")]),a("h2",{attrs:{id:"br--2"}},[a("a",{attrs:{href:"#br--2","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),a("br")]),a("h1",{attrs:{id:"the-set-up"}},[a("a",{attrs:{href:"#the-set-up","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),e._v("The Set Up")]),a("ul",[a("li",[e._v("If you haven't already, download the "),a("a",{attrs:{href:"http://wiki.galaxyproject.org/Events/GCC2013/TrainingDay/VMs",target:"_blank",rel:"noopener noreferrer"}},[e._v("virtual machine (VM) image")]),e._v(" for this workshop.")]),a("li",[e._v("If you haven't already, start the VM")]),a("li",[e._v("fire up Etherpad ("),a("a",{attrs:{href:"https://etherpad.mozilla.org/hCF6QedfLD",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://etherpad.mozilla.org/hCF6QedfLD")]),e._v(")")]),a("li",[e._v("fire up the terminal")]),a("li",[e._v("directory structure for the workshop")]),a("li",[e._v("Galaxy start up - mention the use of a local installation (or a development installation) for exploring the API")]),a("li",[e._v("open gedit (or other) in order to load the scripts in each step")])]),a("h2",{attrs:{id:"the-api-key"}},[a("a",{attrs:{href:"#the-api-key","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),e._v("The API Key")]),a("ul",[a("li",[e._v("load the galaxy home page, login, and go to the top menu 'User' → 'API Keys'")]),a("li",[e._v("Let's look for the api key (don't change it or press the 'Generate' button)")])]),a("p",[e._v("Your "),a("strong",[e._v("API key")]),e._v(" is unique identifier that is sent to the API to link you with your Galaxy account and checks your\naccess to data. It is effectively your username and password. "),a("strong",[e._v("Treat it with the same caution and care you would your\npassword")]),e._v(".")]),a("p",[e._v("For the purposes of simplifying some of our scripts, we're going to add our API key as an environment variable in our\nterminal session.")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-wiki"}},[e._v("**Keeping any form of unencrypted authentication can be dangerous and that includes your API key**.\nIf you use the following technique, place the `source`ed environment variable file in a secure location on your\nlocal filesystem.\n")])]),a("p",[e._v("Let's load the API key into our terminal session:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("source apiworkshop-setup.sh\n")])]),a("p",[e._v("And check what environment variables it's added. First, the API key:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("echo $GALAXY_API_KEY\n")])]),a("p",[e._v("then the "),a("strong",[e._v("base url")]),e._v(" of where our Galaxy installation is served:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("echo $GALAXY_BASE_URL\n")])]),a("p",[e._v("These will both be needed in every call to the API.")]),a("h2",{attrs:{id:"structure"}},[a("a",{attrs:{href:"#structure","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),e._v("Structure")]),a("p",[e._v("We'll be using python and "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/common.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("scripts/api/common.py")]),e._v(" as a layer on top of urllib2.\n"),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/setup.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/setup.py")]),e._v(" will load our key and base URL for every API call.")]),a("p",[e._v("Much of the functionality of the resource scripts (such as users_1.py, histories_1.py, etc.) is available already\nin BioBlend or Blend4j - we won't use them here so we can get a closer look on the internals and conventions of the API.")]),a("h2",{attrs:{id:"br--3"}},[a("a",{attrs:{href:"#br--3","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),a("br")]),a("h1",{attrs:{id:"the-steps"}},[a("a",{attrs:{href:"#the-steps","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),e._v("The Steps")]),a("br"),a("h2",{attrs:{id:"1-checking-your-key-with-the-user-api"}},[a("a",{attrs:{href:"#1-checking-your-key-with-the-user-api","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),e._v("1. Checking your key with the user API")]),a("p",[e._v("We'll start with the scripts: "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_1.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_1.py")]),e._v(" and "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/users_1.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/users_1.py")]),e._v(".")]),a("p",[e._v("These are simple scripts that only make a connection, call GET api/users, and return information about us - the current\nuser.")]),a("p",[e._v("Of course, normally we already know this information but this allows us to "),a("strong",[e._v("test whether our server, url, and key are\nworking properly")]),e._v(".")]),a("p",[e._v("Taking a look inside users_1.py we can see we're simply calling a function in our "),a("code",{pre:!0},[e._v("main")]),e._v(" clause: get_users. It takes\nour key (since it's our form of authentication here) and the root URL, builds on that URL with the api/ + resource and\nthen calls "),a("code",{pre:!0},[e._v("common.get")]),e._v(" with those parameters (which does some of the heavy/tedious lifting here).")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-wiki"}},[e._v("All API method calls will follow this pattern: build a URL from a base URL and a resource then pass it to an HTTP method\nin `common.py` with the key authentication.\n")])]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("./users_1.py\n")])]),a("p",[e._v("Here's the data the users_1.py script should return (if all went well):")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("[ { u'email': u'apiworkshop@example.com',\n    u'id': u'1cd8e2f6b131e891',\n    u'model_class': u'User',\n    u'quota_percent': None,\n    u'url': u'/api/users/1cd8e2f6b131e891'}]\n")])]),a("p",[e._v("(Note: your ID may be different)")]),a("p",[e._v("Note the syntax of what's returned: a list with one element, the element is in python dictionary form, and the strings\nare unicode strings. Most resource data returned from the API will be in dictionary form (after having been converted\nfrom JSON objects in common.py). It's a list because we used the index API method (we'll cover that in step 2) and\nthere's only one element because we're only allowed to access our own user data. Unicode strings will be a common sight\nduring the workshop for both dictionary keys and values. They're a special string for encoding many human languages and\nwriting systems but for all intents and purposes here they can be thought of as normal strings.")]),a("p",[e._v("Now - try the first iteration of our main script, step_1.py.")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("./step_1.py\n")])]),a("p",[e._v("You should see the same data returned as users_1.py - we're not doing much yet.")]),a("br"),a("h2",{attrs:{id:"2-looking-at-your-histories-with-the-history-api"}},[a("a",{attrs:{href:"#2-looking-at-your-histories-with-the-history-api","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),e._v("2. Looking at your histories with the history API")]),a("p",[e._v("Here we'll learn how to query all our histories and query a specific history.")]),a("p",[e._v("Scripts: "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_2.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_2.py")]),e._v(", "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/histories_1.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/histories_1.py")]),e._v(", "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/histories_2.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/histories_2.py")])]),a("br"),a("h3",{attrs:{id:"histories_1py"}},[a("a",{attrs:{href:"#histories_1py","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),e._v("histories_1.py")]),a("p",[e._v("histories_1.py allows us to get (summary) data on all our histories using the GET method and the index API method.")]),a("p",[e._v("Calling histories_1.py from the command line should show us a single, 'Unnamed history' complete with Id, name, and\nother attributes. Note that, even though there is only one history, the form of the data returned is a list:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("[ { u'deleted': False,\n    u'id': u'c24141d7e4e77705',\n    u'model_class': u'History',\n    u'name': u'Unnamed History',\n    u'published': False,\n    u'tags': [],\n    u'url': u'/api/histories/c24141d7e4e77705'}]\n")])]),a("p",[e._v("histories_1.py is an "),a("strong",[e._v("index")]),e._v(" API method. These are generally used to return lists of often summary information about\na group of resources (e.g. all my histories, or the results of a search query such as 'all histories whose names begin\nwith X').")]),a("br"),a("h3",{attrs:{id:"histories_2py"}},[a("a",{attrs:{href:"#histories_2py","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),e._v("histories_2.py")]),a("p",[e._v("histories_2.py allows us to get more detailed info about a "),a("em",[e._v("specific")]),e._v(" history also using the GET command.")]),a("p",[e._v("You must call histories_2.py from the command line and give it a single Id as a parameter - in this case, copy the\nid attribute from the history returned from histories_1.py (without quotes) and paste it after the histories_2.py script\nname:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("./histories_2.py 1cd8e2f6b131e891\n")])]),a("p",[e._v("(Again: the ID may be different - make sure you paste the one from histories_1.py)")]),a("p",[e._v("In histories_2.get_history, we're building the url and including an ID in it to get data about a specific history.\nMany resources are stored in the database with an ID and adding them to the url allows us to specify which resource\nwe want to use. Even though were using the same HTTP method/verb as index here (GET), because we've added the id to the\npath, the API now recognizes we want to do a "),a("strong",[e._v("show")]),e._v(": get specific information on "),a("em",[e._v("one")]),e._v(" history. The way you build\na URL (and what/how you add extra parameters) can make each of the four basic HTTP methods do very different things.")]),a("p",[e._v("You should get a single python dictionary containing quite a bit of information about your current history. Although\nyou have no datasets in it yet, notice the attributes which would contain the counts and ids of datasets keyed by\ntheir potential states.")]),a("p",[e._v("Note that histories_2.py is the same file as histories_1.py with a new function added in. The resource scripts will\nall follow this pattern. The 'last' resource script will always contain the functionality of the ones 'before' it, just\nas each step_N will add new functionality to the overall, final script. (Warning: the effects of calling the resource\nscripts on the command line will change however from number to number - it will often be a demonstration of the most\nrecently added functionality.)")]),a("p",[e._v("Again:")]),a("ul",[a("li",[a("strong",[e._v("index")]),e._v(": histories_1.py: GET api/histories → a list of histories for the current user")]),a("li",[a("strong",[e._v("show")]),e._v(": histories_2.py: GET api/histories/[a history id] → a single, specific history")])]),a("p",[e._v("Many resources in the Galaxy API will have index and show methods for reading and retrieving information.")]),a("br"),e._v("\n## Errors!\n"),a("p",[e._v("Now that we have something we can pass an argument to (and therefore break), let's break it! Try entering this:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("histories_2.py bler\n")])]),a("p",[e._v("You should see a stack trace. You should already be familiar with a stack trace but, if you're not, note the two\nmost important pieces of info it provides: an error string ("),a("code",{pre:!0},[e._v("urllib2.HTTPError: HTTP Error 500: Internal Server Error")]),e._v(")\nand a location in a script file. There is difference here from a normal error in a local script: although we made a\nmistake the stack trace location won't help us much because the relevant code is on the server. We can only use the\nerror string to let us know what happened.")]),a("p",[e._v("In many places in the Galaxy API 'HTTP' errors and exceptions will be thrown, both with (hopefully) descriptive\nmessages and also with an "),a("a",{attrs:{href:"http://en.wikipedia.org/wiki/List_of_HTTP_status_codes",target:"_blank",rel:"noopener noreferrer"}},[e._v("HTTP status code")]),e._v(". Generally when\nyou make an error using the API, Galaxy will (or should) return something in the 400's (meaning user error). In this\ncase, even though it was clearly our fault, Galaxy returned a 500 (Internal Server Error) meaning something went wrong\non it's side.")]),a("p",[e._v("(We're striving to make this more consistent - but when using the API you should be aware of this pitfall)")]),a("br"),e._v("\n## 3. Creating a history with the history API\n"),a("p",[e._v("Here we'll learn how to create a new history which will (automatically) become our 'working' history.")]),a("p",[e._v("Scripts: "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_3.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_3.py")]),e._v(", "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/histories_3.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/histories_3.py")])]),a("br"),e._v("\n### histories_3.py\n"),a("p",[e._v("We've added the function "),a("code",{pre:!0},[e._v("create_history")]),e._v(" in this version of "),a("code",{pre:!0},[e._v("histories")]),e._v(". This will build a URL to "),a("code",{pre:!0},[e._v("api/histories")]),e._v("\nand call that URL with the HTTP method POST (common.post). Note that we don't need to send an ID as this is a new\nhistory and Galaxy will assign the ID itself (the new ID will be returned to us so we can use to further manipulate\nthe history later). This is a common pattern with "),a("strong",[e._v("create")]),e._v(".")]),a("p",[e._v("Note also that "),a("code",{pre:!0},[e._v("create_history")]),e._v(" allows us to immediately name the history by passing in a "),a("code",{pre:!0},[e._v("name")]),e._v(" argument. The name is\npassed to "),a("code",{pre:!0},[e._v("common.post")]),e._v(" bundled in a dictionary. This is also a common pattern with POST (and PUT) and, although these\nadditional arguments are often optional in practice, there are cases were they're required. It's generally best to\ncheck the "),a("a",{attrs:{href:"http://galaxy-dist.readthedocs.org/en/latest/lib/galaxy.webapps.galaxy.api.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("API documentation")]),e._v(" or\nthe code to find out.")]),a("p",[e._v("histories_3.py is also set up to create a new history from the command line now but since we're also doing that in\nstep_3.py, we'll just call that:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("./step_3.py\n")])]),a("p",[e._v("The output:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("created history! Step 3\nnew history:\n{ u'annotation': u*,\n  u'contents_url': u'/api/histories/ee3742ed6d8b4a0c/contents',\n  u'deleted': False,\n  u'genome_build': None,\n  u'id': u'ee3742ed6d8b4a0c',\n  u'model_class': u'History',\n  u'name': u'Step 3',\n  ...\n")])]),a("p",[e._v("(The output has been truncated here with '...')")]),a("p",[e._v("According to the script we created a new history with a name of 'Step 3'.")]),a("p",[e._v("We can double check this a couple of different ways - we could refresh Galaxy in our browser and this history should\nbe our current, 'working' history. Or we could call either histories_1.py (which will have a list of our histories that\nshould contain the new one) or step_2.py (which will give details about our current history).")]),a("p",[e._v("Since each step_N.py script will build on the previous, we'll be creating a new history for each step and each new\nhistory will be named 'Step N'. This will allow us to 'start fresh' with each step and not worry about 'polluting' any\none history. You can even call ./step_3.py (or any of the step scripts) multiple times without fear of ruining any\nfollowing steps.")]),a("br"),e._v("\n## 4. Checking the contents of a history with the history contents API\n"),a("p",[e._v("Histories can be thought of as containers for the datasets we produce over time. The python class for those datasets\n(that are associated with a history and a user) is HistoryDatasetAssociation (HDA).")]),a("p",[e._v("Here we'll learn how to query the datasets "),a("em",[e._v("within")]),e._v(" a history using a "),a("strong",[e._v("contents")]),e._v(" style API URL. This is\nvery similar in functionality to the right-hand history panel in the Galaxy web UI - in fact that panel uses a version\nof this API call to build its HTML.")]),a("p",[e._v("Scripts: "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_4.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_4.py")]),e._v(", "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/hdas_1.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/hdas_1.py")])]),a("p",[e._v("hdas_1.py will do an "),a("code",{pre:!0},[e._v("index")]),e._v(" of the hdas if you call it from the command line. Examine hdas_1.get_hdas. In some ways\nit's very similar to histories.get_history (the "),a("code",{pre:!0},[e._v("show")]),e._v(") but we've added "),a("code",{pre:!0},[e._v("/contents")]),e._v(" to the URL path.")]),a("p",[e._v("If we want to get the HDAs from a history we need to tell the API two things: 1) the specific history we want the HDAs\nfrom and 2) that we're interested in the 'contents' and not the information on the history itself (which we would get\nfrom "),a("code",{pre:!0},[e._v("show")]),e._v("). This is a common pattern for the API when dealing with "),a("strong",[e._v("containers")]),e._v(", we need to specify the containers\nand tell the API to do something with the "),a("em",[e._v("contents")]),e._v(".")]),a("p",[e._v("./step_4.py does everything that steps 1 to 3 do and then queries the HDAs in the new history:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("./step_4.py\n")])]),a("p",[e._v("The output:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("created history! Step 4\nHDAs:\n[]\n")])]),a("p",[e._v("Note the empty list for the HDAs. Since this is an "),a("code",{pre:!0},[e._v("index")]),e._v(" of the HDAs we know it will return a list, but the emptiness\nis a bit anti-climatic. This is a new history, however, so it is the correct return value. If it had HDAs to return,\nthat would have been a pretty big bug!")]),a("br"),e._v("\n## 5. Uploading a file to a new HDA with the history contents API\n"),a("p",[e._v("Here we'll start moving a bit faster: we'll upload a file from our 'local' machine into a new history and get some\ndetails on the HDA that Galaxy creates for it.")]),a("p",[e._v("Scripts: "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_5.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_5.py")]),e._v(", "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/tools_1.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/tools_1.py")]),e._v(", "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/hdas_2.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/hdas_2.py")])]),a("p",[e._v("The file will be "),a("code",{pre:!0},[e._v("myIlluminaRun.solexa.fastq")]),e._v(" and contain some solexa fastq reads. As an aside: this file is from the\nhistory uploaded by Anton Nekrutenko at Galaxy Main server's published histories:\n"),a("a",{attrs:{href:"https://main.g2.bx.psu.edu/u/aun1/h/quickie-14",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://main.g2.bx.psu.edu/u/aun1/h/quickie-14")]),e._v(".\nIt's the initial data used in the screencast quickie: "),a("a",{attrs:{href:"http://screencast.g2.bx.psu.edu/quickie%5C_13%5C_fastq_basic/flow.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://screencast.g2.bx.psu.edu/quickie\\_13\\_fastq_basic/flow.html")])]),a("p",[e._v("The tools_1.py contains one function: upload_hda. The Galaxy developers would like to have every tool be available to\nrun through the API but this is still a work in progress. In this case, we use another module/script\n"),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/upload_to_history.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/upload_to_history.py")]),e._v(" to remove some of the complexity and it itself uses the "),a("code",{pre:!0},[e._v("requests")]),e._v(" module to handle\nmoving the file into the POST data. Be sure to check out those modules for more details on what's involved.")]),a("p",[e._v("The takeaway here is that, to run a tool we combine four things:")]),a("ol",[a("li",[e._v("the POST HTTP method (or "),a("code",{pre:!0},[e._v("create")]),e._v(" again)")]),a("li",[e._v("the resource URL "),a("code",{pre:!0},[e._v("api/tools")])]),a("li",[e._v("the ID of the tool to use: "),a("code",{pre:!0},[e._v("upload1")])]),a("li",[e._v("and any parameters the tool needs: the file, a name, some extra options and directives")])]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("./step_5.py\n")])]),a("p",[e._v("The output:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("created history! Step 5\nuploaded hda! myIlluminaRun.solexa.fastq\nHDAs now:\n[ { u'id': u'9d052533bb57bd3e',\n    u'name': u'myIlluminaRun.solexa.fastq',\n    u'type': u'file',\n    u'url': u'/api/histories/9752b387803d3e1e/contents/9d052533bb57bd3e'}]\nUploaded:\n{ u'accessible': True,\n  u'api_type': u'file',\n  u'data_type': u'auto',\n  u'deleted': False,\n  u'display_apps': [],\n  u'display_types': [],\n  u'download_url': u'/api/histories/9752b387803d3e1e/contents/9d052533bb57bd3e/display',\n  u'file_ext': u'auto',\n  u'file_size': 0,\n  u'genome_build': u'?',\n  u'hda_ldda': u'hda',\n  u'hid': 1,\n  u'history_id': u'9752b387803d3e1e',\n  u'id': u'9d052533bb57bd3e',\n  ...\n")])]),a("p",[e._v("There's our uploaded file in Galaxy.")]),a("br"),e._v("\n### Asynchronous\n"),a("p",[e._v("Note the "),a("code",{pre:!0},[e._v("state")]),e._v(" attribute of the uploaded file:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("u'state': u'queued',\n")])]),a("p",[e._v("This means that the job that uploads the HDA isn't actually finished when our script is. In fact, since many things\nhappen asynchronously (not always one-after-another) - Galaxy's infrastructure, the API, and calls to it are designed\nto return data and continue even if a particular function or command is not 'finished' yet. Essentially, what\n"),a("code",{pre:!0},[e._v("upload_hda")]),e._v(" does is tell Galaxy to bring in the file, return some data immediately, and then move on to the next\ncommand in the script.")]),a("p",[e._v("This is an advantage in many situations and a disadvantage in others.")]),a("p",[e._v("An advantage is that "),a("strong",[e._v("you don't have to wait for Galaxy's jobs to finish before sending more commands")]),e._v(": you could\ncall the "),a("code",{pre:!0},[e._v("upload_hda")]),e._v(" 100 times for 100 files within a minute and all those jobs will queue while you go get a beer.\nGalaxy will create those 100 jobs in the queue while you do other things.")]),a("p",[e._v("If you have to use the data from an asynchronous operation like running a tool or a workflow, it becomes (a slight)\ndisadvantage and you "),a("strong",[e._v("need to wait for something to finish")]),e._v(". Handling this properly is something we'll cover in\nstep 6.")]),a("br"),e._v("\n## 6. Uploading a file and waiting until the API says it's 'ok'\n"),a("p",[e._v("Here we'll handle the asynchronous nature of Galaxy tool running and jobs in order to be sure the data is uploaded\nand ready before we start using it.")]),a("p",[e._v("Scripts: "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_6.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_6.py")])]),a("p",[e._v("Most of our changes will be 'local' this time in the step_6.py version of our final script. We'll use a while loop\nand the "),a("code",{pre:!0},[e._v("state")]),e._v(" information from the HDA "),a("code",{pre:!0},[e._v("show")]),e._v(" api to "),a("strong",[e._v("wait")]),e._v(" for the upload to finish.")]),a("p",[e._v("The psuedo code for this loop might look like this:")]),a("pre",[a("code",{pre:!0},[e._v("Get the state of the HDA from the API\nWhile the state isn't 'ok':\n  Wait for four seconds\n  Check the state again using the API\n")])]),a("p",[e._v("We'll also output some of that information while our script is running. This is always a good idea especially during\ndevelopment so you know what's going on.")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("./step_6.py\n")])]),a("p",[e._v("The output:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("created history! Step 6\nuploaded hda! myIlluminaRun.solexa.fastq\n     uploaded_hda_state: queued\n     (waiting 4 seconds...)\nUploaded:\n{ u'accessible': True,\n  u'api_type': u'file',\n  u'data_type': u'fastq',\n  ...\n")])]),a("p",[e._v("(Note: you may see more waiting when you run the script)")]),a("p",[e._v("Now we know that when the loop completes in our script the dataset is finished uploading and any operations we do after\nthe loop will have access to the dataset's data.")]),a("br"),e._v("\n## 7. Running a workflow on an uploaded HDA using the workflows API\n"),a("p",[e._v("Now we'll run a workflow on our uploaded file and again wait for all of it to finish. We'll be moving faster here.")]),a("p",[e._v("Scripts: "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_7.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_7.py")]),e._v(", "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/workflows_1.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/workflows_1.py")])]),a("br"),e._v("\n### Workflows\n"),a("p",[e._v("Workflows are complicated structures. For this workshop, the needed workflow here is already loaded and available to\nthe workshop user (but it is also available at TODO). All we need to do is 'invoke' it from the api on the uploaded HDA.\nThis is another example of "),a("code",{pre:!0},[e._v("POST + resource URL + parameters")]),e._v(" to "),a("code",{pre:!0},[e._v("create")]),e._v(". It's also an example of "),a("strong",[e._v("composing")]),e._v("\ncomplex scripts - this time using the server side instead of the client.")]),a("p",[e._v("Note: there are some rough ways to change the parameters used in workflows dynamically through the API. Be sure to\ncheck out "),a("code",{pre:!0},[e._v("scripts/api/workflow_execute")]),e._v(" and "),a("code",{pre:!0},[e._v("scripts/api/workflow_execute_parameters")]),e._v(" for examples.")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("./step_7.py\n")])]),a("p",[e._v("The output:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("created history! Step 7\nuploaded hda! myIlluminaRun.solexa.fastq\n     uploaded_hda_state: queued\n     (waiting 4 seconds...)\nfound workflow! Joined Solexa QC\nrunning Joined Solexa QC workflow...\nworkflow started!\ngroomed.fastq\n     state: running\n     (waiting 4 seconds...)\n     ok\nfiltered at > 17\n     state: running\n     (waiting 4 seconds...)\n     state: running\n     (waiting 4 seconds...)\n     state: running\n     (waiting 4 seconds...)\n     state: running\n     (waiting 4 seconds...)\n     ok\nstatistics\n     state: running\n     (waiting 4 seconds...)\n     ok\nforward reads\n     ok\nreverse reads\n     ok\nstatistics plot\n     ok\nworkflow complete!\nOutput:\n{ u'history': u'df7a1f0c02a5b08e',\n  u'outputs': [ u'f597429621d6eb2b',\n                u'1cd8e2f6b131e891',\n                u'ebfb8f50c6abde6d',\n                u'33b43b4e7093c91f',\n                u'a799d38679e985db',\n                u'5969b1f7201f12ae']}\n")])]),a("p",[e._v("Note the final output: these are the HDAs created by the workflow. (We can also list them using hdas_2.py.)")]),a("br"),e._v("\n## 8. Checking the data of an HDA using the datasets API\n"),a("p",[e._v("Now we'll introduce the possibility of a "),a("strong",[e._v("conditional")]),e._v(" in our API script: specifically, we'll "),a("em",[e._v("look inside the\ndataset data")]),e._v(" of one of the HDAs created by our workflow. This will give us an opportunity to do something different\ndepending on what we find.")]),a("p",[e._v("Scripts: "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_8.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_8.py")]),e._v(", "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/datasets_3.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/datasets_3.py")])]),a("br"),e._v("\n### The datasets API\n"),a("p",[e._v("It's all fine and good to operate on the information from resources, but if we consider the actual 'currency' of\nGalaxy to be the "),a("em",[e._v("data inside datasets")]),e._v(" we'll need to get at that information as well.")]),a("p",[e._v("Note that we've skipped talking about "),a("code",{pre:!0},[e._v("datasets_1")]),e._v(" and "),a("code",{pre:!0},[e._v("datasets_2")]),e._v(". These would be the "),a("code",{pre:!0},[e._v("index")]),e._v(" and "),a("code",{pre:!0},[e._v("show")]),e._v(" methods\nfor the datasets resource. In many ways, the datasets resource is a simplification of the HDA resource (and it's sibling\nthe LibraryDatasetDatasetAssociation or LDDA resource - which we'll cover a bit). Datasets is an interface to both HDAs\nand LDDAs that often (effectively) 'strip' or ignore the information about the datasets' containers.")]),a("p",[e._v("Let's try datasets_1.py, tho, to see something important:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("./datasets_1.py\n")])]),a("p",[e._v("The output:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("Traceback (most recent call last):\n...\nurllib2.HTTPError: HTTP Error 501: Not Implemented\n")])]),a("p",[e._v("(Again, the '...' was added to simplify the output)")]),a("p",[a("code",{pre:!0},[e._v("HTTP Error 501: Not Implemented")]),e._v(" is a server error (with status code 501) meaning this functionality hasn't been\nadded yet (and may never be).")]),a("p",[e._v("In this case, you're seeing it because the developers don't have an implementation of "),a("code",{pre:!0},[e._v("index")]),e._v(" for datasets (what might\nthat be? A list of all datasets for the current user? All published datasets? An interface to a dataset search?) In any\nevent, that functionality isn't available throught the API at this time. Keep this error in mind when exploring the API.")]),a("p",[a("code",{pre:!0},[e._v("datasets_2.py")]),e._v(" in many respects mimics the functionality of "),a("code",{pre:!0},[e._v("hdas_2.show")]),e._v(" and returns simple data and metadata for\nthe dataset.")]),a("p",[e._v("However, the same API method from "),a("code",{pre:!0},[e._v("datasets_2")]),e._v(" (`GET + resource_url + ID), when passed some optional parameters\nallows us to "),a("strong",[e._v("get data from within the dataset")]),e._v(". This is done through the Galaxy construct of data providers.")]),a("br"),e._v("\n### Data providers\n"),a("p",[e._v("Data providers allow us to get specific data from within a dataset's file contents. In this case\n("),a("code",{pre:!0},[e._v("datasets_3.get_column_data")]),e._v("), we're using the ColumnDataProvider which provides columns from the Tabular dataset\n"),a("code",{pre:!0},[e._v("statistics")]),e._v(".")]),a("p",[e._v("Data provider are also a work in progress and currently only used in visualizations, but work is underway to make\nthem easier to use and more powerful in general.")]),a("p",[e._v("See the "),a("code",{pre:!0},[e._v("datasets_3.get_dataset_column")]),e._v(" for an example of how to use the datasets API to get raw data from a file.")]),a("p",[e._v("Let's now run step 8:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("./step_8.py\n")])]),a("p",[e._v("The output:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("uploaded hda! myIlluminaRun.solexa.fastq\n     uploaded_hda_state: queued\n     (waiting 4 seconds...)\nfound workflow! Joined Solexa QC\nrunning Joined Solexa QC workflow...\nworkflow started!\n...\nworkflow complete!\nget_dataset_column, full_url: http://localhost:8081/api/datasets/3f5830403180d620?key=a63a28c5d5575a8ca78e97e01a73f901&data_type=raw_data&provider=column&columns=[5]\nmean: 38.8721137988 median: 19.776113249\n")])]),a("p",[e._v("So now we've gotten some quality information about our workflow run and fastq reads. As "),a("code",{pre:!0},[e._v("step_8.py")]),e._v(" mentions, we\ncould use that information to "),a("em",[e._v("conditionally")]),e._v(" run a seperate script, provide some warning/email to the user, etc.")]),a("p",[e._v("(Also note the print out of the get_dataset_column full url: see "),a("code",{pre:!0},[e._v("step_8.py")]),e._v(" and "),a("code",{pre:!0},[e._v("datasets_3.py")]),e._v(" for an explanation of\nwhy but, in the simplest terms, its an illustration of how some API calls transmit extra parameters.)")]),a("br"),e._v("\n## 9. Renaming and annotating an HDA using the history contents API\n"),a("p",[e._v("We'll now introduce a third HTTP method: PUT (DELETE won't be covered in this workshop but know that it's available\nfor many resources) and use it to: "),a("strong",[e._v("update")]),e._v(" (change) the name of our final, desired fastq HDAs and annotate them\nwith the quality information from step 8.")]),a("p",[e._v("Scripts: "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_9.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_9.py")]),e._v(", "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/hdas_3.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/hdas_3.py")])]),a("p",[e._v("PUT/"),a("code",{pre:!0},[e._v("update")]),e._v(" methods are meant to alter existing resources - much like the edit attributes page of the Galaxy UI. Their\nURLs are constructed very similarly to any GET method where we specify resources, containers, and contained objects\nby id. We pass the data we want to change in the form of a dictionary and that gets packaged into the HTTP request\nmuch like POST data does.")]),a("p",[e._v("hdas_3.py adds the function "),a("code",{pre:!0},[e._v("update_hda")]),e._v(" which allows us to change the state and information contained in the HDA\n(but "),a("em",[e._v("not")]),e._v(" the file contents). We can change the name, annotation, "),a("code",{pre:!0},[e._v("misc_info")]),e._v(" (the small amount of text that\ndescribes what the HDA's file contains), the genome build (or "),a("code",{pre:!0},[e._v("dbkey")]),e._v(") and whether this HDA is visible and/or deleted.\nSetting "),a("code",{pre:!0},[e._v("deleted")]),e._v(" to true does not mean the file and HDA are purged from the filesystem and database only they are\n'marked as deleted' and any admin scripts that run later can purge them. The closest analogy is your desktop OS's\ntrash bin - in this way Galaxy allows for a reversible step before the actual file/database removal.")]),a("p",[e._v("Many "),a("code",{pre:!0},[e._v("update")]),e._v("/PUT API methods will only allow the direct change of a limited set of attributes. It's generally best\nto check the documentation or source to find out what has been enabled in an "),a("code",{pre:!0},[e._v("update")]),e._v(" method.")]),a("p",[e._v("The "),a("code",{pre:!0},[e._v("update")]),e._v(" method of the HDA API is designed to accept the same dictionary that's returned from the HDA "),a("code",{pre:!0},[e._v("show")]),e._v("\nmethod. This allows us to capture the dictionary from that method, change what we need, and send the same dictionary to\nthe "),a("code",{pre:!0},[e._v("update")]),e._v(" method. It also allows a partial dictionary with just the keys and new values we want to change.")]),a("p",[e._v("In either case, the "),a("code",{pre:!0},[e._v("update")]),e._v(" method returns a dictionary of what has successfully been changed.")]),a("p",[e._v("Note: unfortunately, at the time this was written the HDA annotations were not passed back in the HDA "),a("code",{pre:!0},[e._v("show")]),e._v(" method.\nAlthough we do change the annotations of the read files in step_9.py, you'll need to check for the changed annotations\nin your browser - by navigating to the most recent 'Step 9' history and opening the annotations of the forward and\nreverse reads.")]),a("p",[e._v("Step 9 will, however, show us the changed names of the HDAs:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("./step_9.py\n")])]),a("p",[e._v("The output:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("created history! Step 9\nuploaded hda! myIlluminaRun.solexa.fastq\n     uploaded_hda_state: queued\n     (waiting 4 seconds...)\nfound workflow! Joined Solexa QC\nrunning Joined Solexa QC workflow...\nworkflow started!\n...\nworkflow complete!\nget_dataset_column, full_url: ...\nmean: 38.8721137988 median: 19.776113249\nfound fwd/rev reads: forward reads reverse reads\nForward: myIlluminaRun.fwd.fastqsanger\nReverse: myIlluminaRun.rev.fastqsanger\n")])]),a("br"),e._v("\n## 10. Copying an HDA to a library using the library contents API\n"),a("p",[e._v("For our final step, we'll take our quality controlled and annotated read files and copy them into a shared Library\nfor everyone in our lab to use.")]),a("p",[e._v("Scripts: "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_10.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/step_10.py")]),e._v(", "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/libraries_1.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/libraries_1.py")]),e._v(", "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/lddas_1.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/lddas_1.py")])]),a("p",[e._v("The API is a great way for administrators and 'power-users' (that's you now) to "),a("strong",[e._v("create and manage shared resources")]),e._v("\nquickly and easily. This makes life easier for people at your lab that are more comfortable with the UI (or those that\nsimply 'explore' the data more there) by creating accessible, shared data and makes your life easier by automating all\nor parts of the frequent bioinformatic requests you may get.")]),a("br"),e._v("\n### libraries_1.py and lddas_1.py\n"),a("p",[e._v("Libraries are unique containers (when compared to histories) in that they can contain "),a("em",[e._v("other containers")]),e._v(". These\nnested containers are folders and add a layer of complexity to our last task.")]),a("p",[e._v("For the purposes of simplifying this workshop, we'll only copy our reads to the root folder of an existing library, but\nyou should be aware that the Library/LDDA API is capable of creating and modifying both libraries and any amount of\nfolders within them. Libraries (and their contents) can also be imported or exported through the API, effectively\nmaking it a good candidate of data communication or migration "),a("strong",[e._v("between Galaxy instances")]),e._v(".")]),a("p",[e._v("Step 9 will, however, show us the changed names of the HDAs:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("./step_10.py\n")])]),a("p",[e._v("The output:")]),a("pre",[a("code",{pre:!0,attrs:{class:"language-bash"}},[e._v("created history! Step 10\nuploaded hda! myIlluminaRun.solexa.fastq\n     uploaded_hda_state: queued\n     (waiting 4 seconds...)\nfound workflow! Joined Solexa QC\nrunning Joined Solexa QC workflow...\nworkflow started!\n...\nworkflow complete!\nget_dataset_column, full_url: http://localhost:8081/api/datasets/ba751ee0539fff04?key=a63a28c5d5575a8ca78e97e01a73f901&data_type=raw_data&provider=column&columns=[5]\nmean: 38.8721137988 median: 19.776113249\nfound fwd/rev reads: forward reads reverse reads\nchanged read HDA names and annotations: myIlluminaRun.fwd.fastqsanger myIlluminaRun.rev.fastqsanger\nfound reads library: Reads Library\nfound root folder: /\ncopying HDAs to library: Reads Library\n     forward read: myIlluminaRun.fwd.fastqsanger\n     reverse read: myIlluminaRun.rev.fastqsanger\n...\nForward reads in library:\n{ u'data_type': u'fastqsanger',\n  u'deleted': False,\n  u'file_name': u'/home/gcc2013/Desktop/Training_Day_Workshops/API/galaxy-central/database/files/000/dataset_26.dat',\n  u'file_size': 1093696,\n  u'genome_build': u'?',\n  u'hda_ldda': u'ldda',\n  ...\nReverse reads in library:\n{ u'data_type': u'fastqsanger',\n  u'deleted': False,\n  u'file_name': u'/home/gcc2013/Desktop/Training_Day_Workshops/API/galaxy-central/database/files/000/dataset_27.dat',\n  u'file_size': 1093696,\n  u'genome_build': u'?',\n  u'hda_ldda': u'ldda',\n  ...\n")])]),a("p",[e._v("And ... we're done!")]),a("h2",{attrs:{id:"br--4"}},[a("a",{attrs:{href:"#br--4","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),a("br")]),a("h1",{attrs:{id:"in-the-future"}},[a("a",{attrs:{href:"#in-the-future","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),e._v("In the Future")]),a("p",[e._v("We are always adding new functionality to the API and progressively ensuring that everything that can be done in the\nUI can be done in the API - because of that, please, consider the API a 'work in progress' and check the\n"),a("a",{attrs:{href:"/docs/"}},[e._v("Galaxy Development Briefs")]),e._v(" for new features or fixes.")]),a("br"),e._v("\n### Versioning of the API\n"),a("p",[e._v("As things change in Galaxy and we make improvements to the API, there will be times when the data that's passed to\nan API method, the data that's returned, or the fundamental effects of an API method "),a("em",[e._v("should")]),e._v(" change.")]),a("p",[e._v("The fact that people have and will continue to write scripts that depend on the API functioning in a particular way\ncomplicates this issue and the developers know that a certain amount of "),a("strong",[e._v("backwards compatibility")]),e._v(" should be\nmaintained.")]),a("p",[e._v("Although the API should still be considered a 'work in progress', there are plans to have "),a("strong",[e._v("two versions")]),e._v(" of the\nAPI. The first, would be the 'stable' api and the second: the 'development' version. The development version may not\nalways behave in the same manner as the stable (hopefully it will be an improvement) and shouldn't be relied upon\nas a source for data or control. The 'stable' version is meant to be used and consumed and should provide the most\nstable, secure, and robust system for scripting the API.")]),a("p",[e._v("As the development version nears a point of completion and reliability itself, the previous stable version will\nbe replaced with it and a new development version will be started.")]),a("br"),e._v("\n### Tool Running\n"),a("p",[e._v("We know that running tools via the API would be a big win for everyone - so it's a priority on our list. Before that\nhappens some amount of core changes need to take place to make this as easy and flexible to use as possible.")]),a("h2",{attrs:{id:"br--5"}},[a("a",{attrs:{href:"#br--5","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),a("br")]),a("h1",{attrs:{id:"more-resources-and-thanks"}},[a("a",{attrs:{href:"#more-resources-and-thanks","aria-hidden":"true"}},[a("span",{staticClass:"icon icon-link"})]),e._v("More Resources and Thanks")]),a("ul",[a("li",[a("p",[e._v("a tarball of all the scripts used is here: "),a("a",{attrs:{href:"https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/all-scripts.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://depot.galaxyproject.org/hub/attachments/events/gcc2013/training-day/api/all-scripts.tar.gz")])])]),a("li",[a("p",[a("a",{attrs:{href:"http://galaxy-dist.readthedocs.org/en/latest/lib/galaxy.webapps.galaxy.api.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("ReadTheDocs.org")]),e._v(".")])]),a("li",[a("p",[e._v("There are good examples in the "),a("code",{pre:!0},[e._v("scripts/api")]),e._v(" directory of a Galaxy installation.")])]),a("li",[a("p",[e._v("BioBlend and Blend4j (links are at the top of this page) can make your API scripting easier.")])]),a("li",[a("p",[e._v("Thanks for coming!")])])]),e._t("/events/gcc2013/footer")],2)}),[],!1,null,null,null);"function"==typeof h&&h(u),"function"==typeof c&&c(u);t.default=u.exports}}]);