{"hash":"eaf962330836a104724e8b210d95933603316eda","data":{"article":{"id":"ec13212c27addb885c9c3b9e7299b0be","title":"Custom Genomes","tease":"","category":null,"date":null,"days":null,"contact":"","contact_url":"","authors":"","location":"","location_url":"","source_blog":"","source_blog_url":"","skip_title_render":null,"redirect":"","links":[],"image":"","images":{},"external_url":"","content":"<div class=\"toc-wrapper col-md-3\">\n<ul>\n<li><a href=\"#what-is-a-custom-reference-genome-\">What is a \"Custom Reference Genome\" ?</a></li>\n<li><a href=\"#overview\">Overview</a></li>\n<li><a href=\"#screencasts--tutorials\">Screencasts &#x26; Tutorials</a></li>\n<li><a href=\"#sources\">Sources</a></li>\n<li><a href=\"#format\">Format</a></li>\n<li><a href=\"#custom-builds\">Custom Builds</a></li>\n<li><a href=\"#sorting\">Sorting</a></li>\n<li>\n<p><a href=\"#troubleshooting\">Troubleshooting</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#1-custom-genome-not-assigned-as-a-hreflearndatatypesfastafastaa-format\">1. Custom genome not assigned as <a href=\"/learn/datatypes/#fasta\">FASTA</a> format</a></li>\n<li><a href=\"#2-incomplete-custom-genome-file-load\">2. Incomplete Custom genome file load</a></li>\n<li><a href=\"#3-extra-spaces-extra-lines-inconsistent-line-wrapping-or-any-deviation-from-strict-a-hreflearndatatypesfastafastaa-format\">3. Extra spaces, extra lines, inconsistent line wrapping, or any deviation from strict <a href=\"/learn/datatypes/#fasta\">FASTA</a> format</a></li>\n<li><a href=\"#4-inconsistent-line-wrapping-common-if-merging-chromosomes-from-various-genbank-records-eg-primary-chroms-with-mito\">4. Inconsistent line wrapping, common if merging chromosomes from various Genbank records (e.g. primary chroms with mito)</a></li>\n<li><a href=\"#5-unsorted-fasta-genome-file\">5. Unsorted fasta genome file</a></li>\n<li><a href=\"#6-identifier-and-description-in--title-lines-used-inconsistently-by-tools-in-the-same-analysis\">6. Identifier and Description in \">\" title lines used inconsistently by tools in the same analysis</a></li>\n<li><a href=\"#7-unassigned-database\">7. Unassigned database</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#a-problem-or-not-a-problem\">A problem or not a problem?</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#a-did-you-use-the-same-exact-reference-genome-for-all-steps-in-the-same-analysis-pipeline\">A. Did you use the same exact reference genome for all steps in the same analysis pipeline?</a></li>\n<li><a href=\"#b-any-tool-including-cufflinksmergediff-reports-a-missingproblem-transcriptsgtf-file\">B. Any tool, including Cufflinks/merge/diff, reports a missing/problem transcripts.gtf file.</a></li>\n<li><a href=\"#c-what-if-the-inputs-are-truly-not-a-match\">C. What if the inputs are truly not a match?</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</div>\n<div class=\"body-wrapper col-md-9\">\n<p><a href=\"/support/\">Support Hub</a></p>\n<p><a href=\"/learn/\">Learning Hub</a></p>\n<hr>\n<h1 id=\"what-is-a-custom-reference-genome-\"><a href=\"#what-is-a-custom-reference-genome-\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>What is a \"Custom Reference Genome\" ?</h1>\n<p>A reference genome contains the nucleotide sequence of the chromosomes, scaffolds, transcripts, or contigs for a single species. It is representative of a specific genome build or release.</p>\n<p>In <a href=\"http://usegalaxy.org\" target=\"_blank\" rel=\"noopener noreferrer\">Galaxy</a>, a <strong>custom reference genome</strong> is a <a href=\"/learn/datatypes/#fasta\">FASTA</a> formatted <a href=\"/learn/#datasets\">dataset</a> that can be used in place of a <strong>native reference genome</strong> with most tools.</p>\n<ul>\n<li><strong>custom</strong>: a dataset <em>from the history</em> loaded by users</li>\n<li><strong>native</strong>: <em>local</em> or <em>cached</em> by administrators (see <a href=\"/admin/data-preparation/\">Admin/DataPreparation</a>)</li>\n</ul>\n<h1 id=\"overview\"><a href=\"#overview\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Overview</h1>\n<p>There are <strong>five basic steps</strong> to using a <em>Custom Reference Genome</em>:</p>\n<ul>\n<li>Obtain a <strong><a href=\"/learn/datatypes/#fasta\">FASTA</a> copy of the target genome</strong></li>\n<li><strong><a href=\"/ftp-upload/\">FTP</a> the genome to Galaxy</strong> and load into a history as a <a href=\"/learn/#datasets\">dataset</a></li>\n<li><strong>Clean up the format</strong> with the tool <strong>NormalizeFasta</strong> using the options to wrap sequence lines at 80 bases and to trim the title line at the first whitespace.</li>\n<li>Make sure the <a href=\"https://galaxyproject.org/support/chrom-identifiers\" target=\"_blank\" rel=\"noopener noreferrer\">chromosome identifiers</a> are a match for other inputs</li>\n<li><strong>Set a tool form's options to use a custom reference genome from the history</strong> and select the loaded genome</li>\n</ul>\n<h1 id=\"screencasts--tutorials\"><a href=\"#screencasts--tutorials\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Screencasts &#x26; Tutorials</h1>\n<table>\n<thead>\n<tr>\n<th>Screencast</th>\n<th>Topic</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><a href=\"https://vimeo.com/123108417\" target=\"_blank\" rel=\"noopener noreferrer\">NGS101-8 Mapping to YOUR Reference</a></strong></td>\n<td>demonstrates <strong>BWA-MEM</strong> tool form options using a custom genome from the history</td>\n</tr>\n<tr>\n<td><strong><a href=\"https://vimeo.com/75918922\" target=\"_blank\" rel=\"noopener noreferrer\">Custom Genomes</a></strong></td>\n<td>explains format, usage, and how to load a genome that works with tools</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"sources\"><a href=\"#sources\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Sources</h1>\n<ul>\n<li>UCSC, Ensembl, NCBI/GenBank</li>\n<li>Other Research project associated with specific genome projects</li>\n<li>Internal research projects</li>\n<li>Selected genomes can be found in \"Data Libraries\" on <a href=\"/main/\">Main</a> for use at <a href=\"http://usegalaxy.org\" target=\"_blank\" rel=\"noopener noreferrer\">http://usegalaxy.org</a>. Example: <strong>hg19</strong> is available for GATK under that sub-directory.</li>\n</ul>\n<h1 id=\"format\"><a href=\"#format\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Format</h1>\n<ul>\n<li>Custom Genomes are required to be in <a href=\"/learn/datatypes/#fasta\">FASTA</a> format</li>\n<li>The data should be formatted as <a href=\"/learn/datatypes/#fasta\">FASTA</a> prior to upload into Galaxy</li>\n<li>The dataset will need to be labeled as <a href=\"/learn/datatypes/#fasta\">FASTA</a> after loaded (if not automatically assigned)</li>\n<li>Did you use <strong>NormalizeFasta</strong> with the options to wrap sequence lines at 80 bases and to trim the title line at the first whitespace?</li>\n</ul>\n<h1 id=\"custom-builds\"><a href=\"#custom-builds\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Custom Builds</h1>\n<p>Some tools and functions require that the <a href=\"/support/datatypes-and-tools/\">'database' attribute is assigned</a> or that a Custom Reference Genome is set up as a <em>Custom Build</em> prior to use. Examples are the tools <strong>Featurecounts</strong>, <strong>Extract Genomic DNA</strong>, certain <strong>Picard</strong> tools, and the functions under  <strong>Visualization</strong>.</p>\n<p>Once created, a <em>Custom Build</em> is added to the list <strong>Database/Build:</strong> on the dataset 'Edit Attributes' and 'Upload File' tool forms and is available for 'Visualizations'. These can be assigned or used just like any other reference genome.</p>\n<ul>\n<li>Start with an existing fasta Custom Reference Genome in your history. It is <em>very important</em> make sure the <a href=\"/learn/custom-genomes/#format\">format</a> is correct.</li>\n<li>Go to the top \"User\" menu and select \"Custom Builds\"</li>\n<li>Enter in the labels (no spaces and no special characters other than \"_\")</li>\n<li>Select the fasta Custom Reference Genome</li>\n<li>Submit and wait for the build to finish loading before assigning to a dataset or using to start a new Visualization</li>\n<li>Note: It is fine to navigate away from this form and come back to it later to check for status. The larger the fasta file and busier the Galaxy instance is, the longer the processing will take.</li>\n</ul>\n<h1 id=\"sorting\"><a href=\"#sorting\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Sorting</h1>\n<p>Certain tools expect that reference genomes are sorted in <a href=\"http://en.wikipedia.org/wiki/Lexicographical_order\" target=\"_blank\" rel=\"noopener noreferrer\">lexicographical order</a>. These tools are often downstream of the initial mapping tools, which means that a large investment in a project has already been made (i.e. a long mapping process), before a problem with sorting pops up in conclusion layer tools. No one likes to start over!</p>\n<p>How to avoid? Always sort your <a href=\"/learn/datatypes/#fasta\">FASTA</a> reference genome dataset at the beginning of a project. Many sources only provide sorted genomes, but double checking is your own responsibility, and super easy in Galaxy. So easy that there isn't even a shared workflow, just a recipe (but feel free to make your own):</p>\n<p>Quick lexicographical sort recipe:</p>\n<pre><code>1. Convert Formats -> FASTA-to-Tabular\n2. Filter and Sort -> Sort\n       on column: c1 \n       with flavor: Alphabetical\n       everything in: Ascending order\n3. Convert Formats -> Tabular-to-FASTA\n</code></pre>\n<p>The above sorting method is for most tools, but not all. In particular, GATK tools have a tool-specific sort order requirement. The <a href=\"http://www.broadinstitute.org\" target=\"_blank\" rel=\"noopener noreferrer\">Broad Institute</a> FAQ with input format instructions is <strong><a href=\"http://www.broadinstitute.org/gark/guide/article?id=1204\" target=\"_blank\" rel=\"noopener noreferrer\">here</a></strong>.</p>\n<h1 id=\"troubleshooting\"><a href=\"#troubleshooting\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Troubleshooting</h1>\n<p>If a custom genome dataset is producing errors, double check the format and that the chromosome identifiers between <strong>ALL</strong> inputs. Clicking on the green bug icon <img src=\"/images/icons/bug.png\"> will often provide a description of the problem. This does not automatically submit a bug report, and it is not always necessary to do so, but it is a good way to get more information about why a job is failing.</p>\n<h3 id=\"1-custom-genome-not-assigned-as-a-hreflearndatatypesfastafastaa-format\"><a href=\"#1-custom-genome-not-assigned-as-a-hreflearndatatypesfastafastaa-format\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>1. Custom genome not assigned as <a href=\"/learn/datatypes/#fasta\">FASTA</a> format</h3>\n<ul>\n<li><strong>Symptoms include</strong>: Dataset not included in custom genome pull down menu on tool forms.</li>\n<li><strong>Solution</strong>: Check datatype assigned to dataset and assign <strong>fasta</strong> format.</li>\n<li><strong>How</strong>: Click on the dataset's pencil icon <img src=\"/images/icons/pencil.png\"> to reach the \"Edit Attributes\" page, and in the <a href=\"/learn/datatypes/\">datatypes</a> section, type in \"fasta\", and save.</li>\n</ul>\n<h3 id=\"2-incomplete-custom-genome-file-load\"><a href=\"#2-incomplete-custom-genome-file-load\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>2. Incomplete Custom genome file load</h3>\n<ul>\n<li><strong>Symptoms include</strong>: Tool errors result the first time you use the Custom genome.</li>\n<li><strong>Solution</strong>: Use <strong>Text Manipulation → Select last lines from a dataset</strong> to check last 10 lines to see if file is truncated.</li>\n<li><strong>How</strong>: Reload the dataset (switch to <strong><a href=\"/ftp-upload/\">FTP</a></strong> if not using already). Check your FTP client logs to make sure the load is complete.</li>\n</ul>\n<h3 id=\"3-extra-spaces-extra-lines-inconsistent-line-wrapping-or-any-deviation-from-strict-a-hreflearndatatypesfastafastaa-format\"><a href=\"#3-extra-spaces-extra-lines-inconsistent-line-wrapping-or-any-deviation-from-strict-a-hreflearndatatypesfastafastaa-format\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>3. Extra spaces, extra lines, inconsistent line wrapping, or any deviation from strict <a href=\"/learn/datatypes/#fasta\">FASTA</a> format</h3>\n<ul>\n<li><strong>Symptoms include</strong>: RNA-seq tools (<strong>Cufflinks, Cuffcompare, Cuffmerge, Cuffdiff</strong>) fails with error <code>Error: sequence lines in a FASTA record must have the same length!</code>.</li>\n<li><strong>Solution</strong>: File tested and corrected locally then re-upload or test/fix within Galaxy, then re-run.</li>\n<li><strong>How</strong>:</li>\n<li><strong>Quick re-formatting</strong> Run the tool through the tool <strong>NormalizeFasta</strong> using the options to wrap sequence lines at 80 bases and to trim the title line at the first whitespace.</li>\n<li><strong>Optional Detailed re-formatting</strong> Start with <strong>FASTA manipulation → FASTA Width formatter </strong> with a value between 40-80 (60 is common) to reformat wrapping. Next, use <strong>Filter and Sort → Select</strong> with \">\" to examine identifiers. Use a combination of <strong>Convert Formats → FASTA-to-Tabular</strong>, <strong>Text Manipulation</strong> tools, then <strong>Tabular-to-FASTA</strong> to correct.</li>\n<li><strong>With either of the above</strong>, finish by using <strong>Filter and Sort → Select</strong> with <code>^\\w*$</code> to search for empty lines (use \"NOT matching\" to remove these lines and output a properly format fasta dataset).</li>\n</ul>\n<h3 id=\"4-inconsistent-line-wrapping-common-if-merging-chromosomes-from-various-genbank-records-eg-primary-chroms-with-mito\"><a href=\"#4-inconsistent-line-wrapping-common-if-merging-chromosomes-from-various-genbank-records-eg-primary-chroms-with-mito\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>4. Inconsistent line wrapping, common if merging chromosomes from various Genbank records (e.g. primary chroms with mito)</h3>\n<ul>\n<li><strong>Symptoms include</strong>: Tools (<strong>SAMTools</strong>, <strong>Extract Genomic DNA</strong>, but rarely alignment tools) may complain about unexpected line lengths/missing identifiers. Or they may just fail for what appears to be a cluster error.</li>\n<li><strong>Solution</strong>: File tested and corrected locally then re-upload or <strong>test/fix within Galaxy</strong>.</li>\n<li><strong>How</strong>: Use <strong><strong>NormalizeFasta</strong></strong> using the options to wrap sequence lines at 80 bases and to trim the title line at the first whitespace. Finish by using <strong>Filter and Sort → Select</strong> with <code>^\\w*$</code> to search for empty lines (use \"NOT matching\" to remove these lines and output a properly format fasta dataset).</li>\n</ul>\n<h3 id=\"5-unsorted-fasta-genome-file\"><a href=\"#5-unsorted-fasta-genome-file\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>5. Unsorted fasta genome file</h3>\n<ul>\n<li><strong>Symptoms include</strong>: Tools such as <strong>Extract Genomic DNA</strong> report problems with sequence lengths.</li>\n<li><strong>Solution</strong>: First try sorting and re-formatting in Galaxy then re-run.</li>\n<li><strong>How</strong>: To sort, follow instructions for <a href=\"/learn/custom-genomes/#sorting\">Sorting</a> a Custom Genome.</li>\n</ul>\n<h3 id=\"6-identifier-and-description-in--title-lines-used-inconsistently-by-tools-in-the-same-analysis\"><a href=\"#6-identifier-and-description-in--title-lines-used-inconsistently-by-tools-in-the-same-analysis\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>6. Identifier and Description in \">\" title lines used inconsistently by tools in the same analysis</h3>\n<ul>\n<li><strong>Symptoms include</strong>: Will generally manifest as a false genome-mismatch problem.</li>\n<li><strong>Solution</strong>: Remove the description content and re-run all tools/workflows that used this input. Mapping tools will usually not fail, but downstream tools will. When this comes up, it usually means that an analysis needs to be started over from the mapping step to correct the problems. No one enjoys redoing this work. Avoid the problems by formatting the genome, by double checking that the same reference genome was used for all steps, and by making certain the 'identifiers' are a match between all planned inputs (including reference annotation such as GTF data) <strong>before using your custom genome</strong>.</li>\n<li><strong>How</strong>: To drop the title line description content, use <strong>NormalizeFasta</strong> using the options to wrap sequence lines at 80 bases and to trim the title line at the first whitespace. Next, double check that the <a href=\"https://galaxyproject.org/support/chrom-identifiers\" target=\"_blank\" rel=\"noopener noreferrer\">chromosome identifiers are an exact match between all inputs</a>.</li>\n</ul>\n<h3 id=\"7-unassigned-database\"><a href=\"#7-unassigned-database\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>7. Unassigned database</h3>\n<ul>\n<li><strong>Symptoms include</strong>: Tools report that no build is available for the assigned reference genome.</li>\n<li><strong>Solution</strong> This occurs with tools that require an assigned <em>database</em> metadata attribute. <strong>SAMTools</strong> and <strong>Picard</strong> often require this assignment.</li>\n<li><strong>How</strong>: Create a <a href=\"/learn/custom-genomes/#custom-builds\">Custom Build</a> and assign it to the dataset</li>\n</ul>\n<h1 id=\"a-problem-or-not-a-problem\"><a href=\"#a-problem-or-not-a-problem\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>A problem or not a problem?</h1>\n<p>Certain job errors with RNA-seq tools can at first appear to look like a format problem with a custom reference genome, but are actually a bit more complicated...</p>\n<h3 id=\"a-did-you-use-the-same-exact-reference-genome-for-all-steps-in-the-same-analysis-pipeline\"><a href=\"#a-did-you-use-the-same-exact-reference-genome-for-all-steps-in-the-same-analysis-pipeline\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>A. Did you use the same exact reference genome for all steps in the same analysis pipeline?</h3>\n<p>Alignment tools (BWA, Bowtie, Tophat) are generally tolerant of minor formatting problems with reference genomes. However, downstream tools tend to have more stringent format requirements. To avoid having to reprocess, <strong>a best practice is to verify that the formatting is correct before any steps are started</strong>.</p>\n<h3 id=\"b-any-tool-including-cufflinksmergediff-reports-a-missingproblem-transcriptsgtf-file\"><a href=\"#b-any-tool-including-cufflinksmergediff-reports-a-missingproblem-transcriptsgtf-file\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>B. Any tool, including Cufflinks/merge/diff, reports a missing/problem transcripts.gtf file.</h3>\n<p>This generally indicates a mismatch in the chromosome identifiers between the reference genome used for the mapping/alignment step, and the reference annotation GTF data and/or the reference genome used in downstream steps.</p>\n<h3 id=\"c-what-if-the-inputs-are-truly-not-a-match\"><a href=\"#c-what-if-the-inputs-are-truly-not-a-match\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>C. What if the inputs are truly not a match?</h3>\n<p>The problem can sometimes be corrected by altering the chromosome identifiers in the GTF file or the reference genome. However, making changes can introduce scientific genome-mismatch problems. It is generally much better to find reference data (genomes, reference files) that are confirmed to be a match.</p>\n</div>\n"}},"context":{}}