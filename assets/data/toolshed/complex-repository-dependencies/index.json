{"hash":"c32ecfdb33b075b0057598b5b9118f3554a398cf","data":{"article":{"id":"77eba557a4b4210a7ad44b14434a4096","title":"","tease":"","image":"","images":{},"category":null,"contact":"","date":null,"content":"<div class='center'> <a href='http://toolshed.g2.bx.psu.edu'>![Galaxy Main Tool Shed](/src/images/logos/ToolShed.jpg)</a> </div>\n<h1 id=\"complex-repository-dependencies\"><a href=\"#complex-repository-dependencies\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Complex Repository Dependencies</h1>\n<p>Complex repository dependencies allow many Tool Shed repository installations into a single Galaxy instance where any number of the contained tools across installed repositories can all reference a single installation of a specific tool dependency package (e.g. bwa version 0.5.9).</p>\n<p>Describing how this works is tricky, so let's see if we can state it in a way that can be understood: tool dependency definitions that contain repository dependency definitions define a relationship to a tool dependency that will be installed using the instructions in the required repository's <strong>tool_dependencies.xml</strong> file, where the relationship to the required repository is defined by the contained repository dependency definition. Hmmm...okay, let's try to clarify this a bit...</p>\n<p>To demonstrate how this works, we'll refer to 2 repositories in the <a href=\"http://testtoolshed.g2.bx.psu.edu\" target=\"_blank\" rel=\"noopener noreferrer\">test Galaxy Tool Shed</a>: <a href=\"http://testtoolshed.g2.bx.psu.edu/view/greg/bwa_059\" target=\"_blank\" rel=\"noopener noreferrer\">bwa_059</a> and <a href=\"http://testtoolshed.g2.bx.psu.edu/view/greg/complex_repository_dependency_on_bwa_059\" target=\"_blank\" rel=\"noopener noreferrer\">complex_repository_dependency_on_bwa_059</a>.</p>\n<p>The <a href=\"http://testtoolshed.g2.bx.psu.edu/view/greg/bwa_059\" target=\"_blank\" rel=\"noopener noreferrer\">bwa_059</a> repository has type <strong>Tool dependency definition</strong> and contains only a single file named <strong>tool_dependencies.xml</strong> which looks like the following. This definition will download and compile version 0.5.9 of the bwa package.</p>\n<pre><code>&#x3C;?xml version=\"1.0\"?>\n&#x3C;tool_dependency>\n    &#x3C;package name=\"bwa\" version=\"0.5.9\">\n        &#x3C;install version=\"1.0\">\n            &#x3C;actions>\n                &#x3C;action type=\"download_by_url\">http://downloads.sourceforge.net/project/bio-bwa/bwa-0.5.9.tar.bz2&#x3C;/action>\n                &#x3C;action type=\"shell_command\">make clean&#x3C;/action>\n                &#x3C;action type=\"shell_command\">make&#x3C;/action>\n                &#x3C;action type=\"move_file\">\n                    &#x3C;source>bwa&#x3C;/source>\n                    &#x3C;destination>$INSTALL_DIR/bin&#x3C;/destination>\n                &#x3C;/action>\n                &#x3C;action type=\"set_environment\">\n                    &#x3C;environment_variable name=\"PATH\" action=\"prepend_to\">$INSTALL_DIR/bin&#x3C;/environment_variable>\n                &#x3C;/action>\n            &#x3C;/actions>\n        &#x3C;/install>\n        &#x3C;readme>\nCompiling BWA requires zlib and libpthread to be present on your system.\n        &#x3C;/readme>\n    &#x3C;/package>\n&#x3C;/tool_dependency>\n</code></pre>\n<p>To demonstrate how the <a href=\"http://testtoolshed.g2.bx.psu.edu/view/greg/bwa_059\" target=\"_blank\" rel=\"noopener noreferrer\">bwa_059</a> repository can be used, let's take a look at the <strong>tool_dependencies.xml</strong> file contained in the <a href=\"http://testtoolshed.g2.bx.psu.edu/view/greg/complex_repository_dependency_on_bwa_059\" target=\"_blank\" rel=\"noopener noreferrer\">complex_repository_dependency_on_bwa_059</a> repository, which looks like the following.</p>\n<pre><code>&#x3C;?xml version=\"1.0\"?>\n&#x3C;tool_dependency>\n    &#x3C;package name=\"bwa\" version=\"0.5.9\">\n        &#x3C;repository toolshed=\"http://testtoolshed.g2.bx.psu.edu\" name=\"bwa_059\" owner=\"greg\" changeset_revision=\"a347750db1d1\" />\n    &#x3C;/package>\n&#x3C;/tool_dependency>\n</code></pre>\n<p>The above tool dependency definition is associated with the entry in the <code>&#x3C;requirements></code> tag set defined in the <strong>bwa_wrapper.xml</strong> Galaxy tool configuration file contained in the same repository. The <strong>bwa_wrapper.xml</strong> <code>&#x3C;requirements></code> tag set looks like the following. Notice that the type <strong>package</strong>, version <strong>0.5.9</strong> and name <strong>bwa</strong> match the definition in the above <strong>tool_dependencies.xml</strong> file.</p>\n<pre><code>&#x3C;requirements>\n    &#x3C;requirement type=\"package\" version=\"0.5.9\">bwa&#x3C;/requirement>\n&#x3C;/requirements>\n</code></pre>\n<p>Visiting the repository's main page displays various containers. There are two dependencies defined for this repository, both of which are defined in the simple <strong>tool_dependencies.xml</strong> file above. The repository dependency on revision <strong>a347750db1d1</strong> of the repository named <strong>bwa_059</strong> owned by <strong>greg</strong> is defined by the <code>repository</code> tag, while the tool dependency on version <strong>0.5.9</strong> of the <strong>bwa package</strong> is defined by the <code>&#x3C;package></code> tag set.</p>\n<p><img src=\"/src/toolshed/complex-repository-dependencies/manage_complex_repository_dependency_on_bwa_059.png\"></p>\n<p>For more technical details on this XML file, see the <a href=\"/src/toolshed/tool-dependencies-tag-sets/index.md\">supported tool_dependencies.xml tag sets</a>.</p>\n"}},"context":{}}