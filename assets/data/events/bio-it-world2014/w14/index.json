{"hash":"4f66c62fb6940f4cd6ecf5e4a1e2d62361ec5ff4","data":{"article":{"id":"8be8f380c4677e243ed4647b2bf1d0ac","title":"Workshop 14: Running a Local Galaxy Instance","tease":"","category":null,"date":null,"days":null,"contact":"","contact_url":"","fileInfo":{"path":"build/content-md/events/bio-it-world2014/w14/index.md"},"authors":"","location":"","location_url":"","source_blog":"","source_blog_url":"","skip_title_render":null,"redirect":"","autotoc":null,"links":[],"image":"","images":{},"external_url":"","content":"<div class=\"toc-wrapper col-md-3\">\n<ul>\n<li>\n<p><a href=\"#setting-up-a-local-galaxy-tutorial-part-i\">Setting up a Local Galaxy Tutorial (Part I)</a></p>\n<ul>\n<li>\n<p><a href=\"#clone-download-galaxy\">Clone (download) Galaxy</a></p>\n<ul>\n<li><a href=\"#references\">References</a></li>\n</ul>\n</li>\n<li><a href=\"#update-to-the-stable-branch\">Update to the stable branch</a></li>\n<li><a href=\"#start-galaxy\">Start Galaxy</a></li>\n<li><a href=\"#serve-over-public-interface\">Serve over public interface</a></li>\n<li>\n<p><a href=\"#installing-tools-from-the-tool-shed\">Installing tools from the Tool Shed</a></p>\n<ul>\n<li><a href=\"#topics-for-this-section\">Topics for this section</a></li>\n<li><a href=\"#install-a-tool-from-the-tool-shed\">Install a tool from the Tool Shed</a></li>\n</ul>\n</li>\n<li><a href=\"#create-a-new-user-for-galaxy\">Create a new user for Galaxy</a></li>\n<li><a href=\"#create-a-python-virtual-environment\">Create a Python virtual environment</a></li>\n<li><a href=\"#clone-download-galaxy-1\">Clone (download) Galaxy</a></li>\n<li><a href=\"#configure-galaxy\">Configure Galaxy</a></li>\n<li><a href=\"#start-a-galaxy-server-to-complete-first-run-setup\">Start a Galaxy server to complete first run setup</a></li>\n<li><a href=\"#install-and-configure-grid-engine\">Install and configure Grid Engine</a></li>\n<li><a href=\"#install-nginx-uwsgi-and-supervisord\">Install nginx, uWSGI, and supervisord</a></li>\n<li><a href=\"#configure-nginx\">Configure nginx</a></li>\n<li><a href=\"#configure-supervisord\">Configure supervisord</a></li>\n<li><a href=\"#start-galaxy-and-nginx\">Start Galaxy and nginx</a></li>\n<li><a href=\"#references-1\">References</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#transcripts\">Transcripts</a></p>\n<ul>\n<li><a href=\"#adding-local-data-by-hand\">Adding local data by hand</a></li>\n</ul>\n</li>\n</ul>\n</div>\n<div class=\"body-wrapper col-md-9\">\n<p><a href=\"http://bioteam.net/company-leadership/\" target=\"_blank\" rel=\"noopener noreferrer\">Adam Kraut</a>, <a href=\"/people/nate/\">Nate Coraor</a>, <a href=\"http://bioteam.net/company-leadership/\" target=\"_blank\" rel=\"noopener noreferrer\">Anushka Brownley</a>, Tristan Lubinski, <a href=\"http://www.sgi.com/solutions/genomics\" target=\"_blank\" rel=\"noopener noreferrer\">James Reaney</a></p>\n<br />\n![](https://dev.twitter.com/sites/default/files/images_documentation/bird_blue_16.png) #usegalaxy #BioIT2014\n<p>This page covers the follow-along steps of the workshop. Other material from the workshop may be found on  <a href=\"/events/bioitworld2014/\">Events/BioITWorld2014</a> or <a href=\"http://www.bio-itworldexpo.com/Bio-It_Expo_Content.aspx?id=135152\" target=\"_blank\" rel=\"noopener noreferrer\">the Bio-IT World Expo workshop details page</a>.</p>\n<p>For this workshop we will be using virtual machines on an SGI UV system at Penn State (provided by workshop sponsor SGI). You will need an SSH client (<code>ssh</code> in Terminal on OS X and Linux, or e.g. <a href=\"http://the.earth.li/~sgtatham/putty/latest/x86/putty.exe\" target=\"_blank\" rel=\"noopener noreferrer\">PuTTY</a> on Windows). Login details for the virtual machines are:</p>\n<table>\n  <tr>\n    <th> Hostnames </th>\n    <td> <code>bioit[1-39].galaxyproject.org</code> </td>\n  </tr>\n  <tr>\n    <th> Username </th>\n    <td> <code>ubuntu</code> </td>\n  </tr>\n  <tr>\n    <th> Password </th>\n    <td> <code>galaxy</code> </td>\n  </tr>\n</table>\n<p>The virtual machines are running a bare installation of Ubuntu 14.04 LTS.</p>\n<p><strong>Please use Firefox or Chrome for this tutorial.</strong> Galaxy is compatible with all modern versions of Firefox, Chrome, Safari, and Internet Explorer. However, for the purposes of this tutorial it will help us when assisting people encountering problems if only Firefox or Chrome are used.</p>\n<h1 id=\"setting-up-a-local-galaxy-tutorial-part-i\"><a href=\"#setting-up-a-local-galaxy-tutorial-part-i\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Setting up a Local Galaxy Tutorial (Part I)</h1>\n<h2 id=\"clone-download-galaxy\"><a href=\"#clone-download-galaxy\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Clone (download) Galaxy</h2>\n<p>The Galaxy distribution is found at <a href=\"https://bitbucket.org/galaxy/galaxy-dist/\" target=\"_blank\" rel=\"noopener noreferrer\">https://bitbucket.org/galaxy/galaxy-dist/</a>, but for the purposes of this workshop, we'll use a trimmed version to decrease the time it takes to clone.</p>\n<pre><code class=\"language-console\">ubuntu@bioit:~$ hg clone https://bitbucket.org/natefoo/galaxy-bioit galaxy-dist\nThe program 'hg' is currently not installed. You can install it by typing:\nsudo apt-get install mercurial\nubuntu@bioit:~$\n</code></pre>\n<p>An introduction to the system package manager (APT):</p>\n<pre><code class=\"language-console\">ubuntu@bioit:~$ sudo apt-get update\n[sudo] password for ubuntu: galaxy\n  ...\nFetched 179 kB in 4s (41.2 kB/s)\nReading package lists... Done\nubuntu@bioit:~$ sudo apt-get install mercurial\n  ...\nAfter this operation, 86.7 MB of additional disk space will be used.\nDo you want to continue? [Y/n]\n  ...\nubuntu@bioit:~$\n</code></pre>\n<p>Trying again:</p>\n<pre><code class=\"language-console\">ubuntu@bioit:~$ hg clone https://bitbucket.org/natefoo/galaxy-bioit galaxy-dist\nrequesting all changes\nadding changesets\nadding manifests\nadding file changes\nadded 8 changesets with 3443 changes to 3443 files\nupdating to branch default\n3443 files updated, 0 files merged, 0 files removed, 0 files unresolved\nubuntu@bioit:~/galaxy-dist$\n</code></pre>\n<h3 id=\"references\"><a href=\"#references\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>References</h3>\n<ul>\n<li><a href=\"http://getgalaxy.org\" target=\"_blank\" rel=\"noopener noreferrer\">getgalaxy.org</a></li>\n<li><a href=\"https://wiki.galaxyproject.org\" target=\"_blank\" rel=\"noopener noreferrer\">Galaxy Wiki/documentation</a></li>\n</ul>\n<h2 id=\"update-to-the-stable-branch\"><a href=\"#update-to-the-stable-branch\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Update to the stable branch</h2>\n<pre><code class=\"language-console\">ubuntu@bioit:~$ cd galaxy-dist\nubuntu@bioit:~/galaxy-dist$ hg update stable\n0 files updated, 0 files merged, 0 files removed, 0 files unresolved\nubuntu@bioit:~/galaxy-dist$\n</code></pre>\n<h2 id=\"start-galaxy\"><a href=\"#start-galaxy\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Start Galaxy</h2>\n<pre><code class=\"language-console\">ubuntu@bioit:~/galaxy-dist$ sh run.sh\nInitializing datatypes_conf.xml from datatypes_conf.xml.sample\n  ...\nSome eggs are out of date, attempting to fetch...\nFetched http://scofield.galaxyproject.org/eggs/Mako/Mako-0.4.1-py2.7.egg\n  ...\nFetch successful.\npython path is: /home/ubuntu/galaxy-dist/eggs/mercurial-2...\n  ...\nStarting server in PID 3091.\nserving on http://127.0.0.1:8080\n</code></pre>\n<h2 id=\"serve-over-public-interface\"><a href=\"#serve-over-public-interface\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Serve over public interface</h2>\n<p>Stop Galaxy by hitting <code>CTRL-c</code>:</p>\n<pre><code class=\"language-console\">serving on http://127.0.0.1:8080\n^Cgalaxy.jobs.handler INFO 2014-04-23 13:27:59,203 sending stop signal to worker thread\ngalaxy.jobs.handler INFO 2014-04-23 13:27:59,204 job handler queue stopped\ngalaxy.jobs.runners INFO 2014-04-23 13:27:59,204 LWRRunner: Sending stop signal to monitor thread\ngalaxy.jobs.runners INFO 2014-04-23 13:27:59,204 LWRRunner: Sending stop signal to 3 worker threads\ngalaxy.jobs.runners INFO 2014-04-23 13:27:59,204 LocalRunner: Sending stop signal to 5 worker threads\ngalaxy.jobs.handler INFO 2014-04-23 13:27:59,205 sending stop signal to worker thread\ngalaxy.jobs.handler INFO 2014-04-23 13:27:59,205 job handler stop queue stopped\nubuntu@bioit:~/galaxy-dist$\n</code></pre>\n<p>Edit the primary Galaxy configuration file, <code>universe_wsgi.ini</code>. If you are not familiar with <code>vi</code>, I suggest using <code>nano</code> instead.</p>\n<pre><code class=\"language-console\">ubuntu@bioit:~/galaxy-dist$ vi universe_wsgi.ini\n</code></pre>\n<p>In the <code>[server:main]</code> section, uncomment <code>#host = 127.0.0.1</code> and set:</p>\n<pre><code class=\"language-ini\">host = 0.0.0.0\n</code></pre>\n<p>While we are in the config, we should set two options necessary for the next section. The file is large and it's easiest to search for these (<code>/&#x3C;pattern></code> in vi, <code>CTRL-w</code> <code>&#x3C;pattern></code> in nano):</p>\n<pre><code class=\"language-ini\">[app:main]\nadmin_users = nate@bx.psu.edu\ntool_dependency_dir = /home/ubuntu/tool_deps\n</code></pre>\n<p>Then save and quit (<code>CTRL-x</code> <code>y</code> <code>ENTER</code> in nano). Start Galaxy again:</p>\n<pre><code class=\"language-console\">ubuntu@bioit:~/galaxy-dist$ sh run.sh\n  ...\nStarting server in PID 3298.\nserving on 0.0.0.0:8080 view at http://127.0.0.1:8080\n</code></pre>\n<p>The message <code>view at http://127.0.0.1:8080</code> is generated by the embedded webserver and cannot be changed so it is not entirely accurate, but <code>serving on 0.0.0.0:8080</code> reveals that the server is now listening on public interfaces.</p>\n<table>\n  <tr class=\"th\" >\n    <th colspan=10 style=\" text-align: center;\"> VM Galaxy Instances </th>\n  </tr>\n  <tr>\n    <td> <a href='http://bioit0.galaxyproject.org:8080'>bioit0</a> </td>\n    <td> <a href='http://bioit1.galaxyproject.org:8080'>bioit1</a> </td>\n    <td> <a href='http://bioit2.galaxyproject.org:8080'>bioit2</a> </td>\n    <td> <a href='http://bioit3.galaxyproject.org:8080'>bioit3</a> </td>\n    <td> <a href='http://bioit4.galaxyproject.org:8080'>bioit4</a> </td>\n    <td> <a href='http://bioit5.galaxyproject.org:8080'>bioit5</a> </td>\n    <td> <a href='http://bioit6.galaxyproject.org:8080'>bioit6</a> </td>\n    <td> <a href='http://bioit7.galaxyproject.org:8080'>bioit7</a> </td>\n    <td> <a href='http://bioit8.galaxyproject.org:8080'>bioit8</a> </td>\n    <td> <a href='http://bioit9.galaxyproject.org:8080'>bioit9</a> </td>\n  </tr>\n  <tr>\n    <td> <a href='http://bioit10.galaxyproject.org:8080'>bioit10</a> </td>\n    <td> <a href='http://bioit11.galaxyproject.org:8080'>bioit11</a> </td>\n    <td> <a href='http://bioit12.galaxyproject.org:8080'>bioit12</a> </td>\n    <td> <a href='http://bioit13.galaxyproject.org:8080'>bioit13</a> </td>\n    <td> <a href='http://bioit14.galaxyproject.org:8080'>bioit14</a> </td>\n    <td> <a href='http://bioit15.galaxyproject.org:8080'>bioit15</a> </td>\n    <td> <a href='http://bioit16.galaxyproject.org:8080'>bioit16</a> </td>\n    <td> <a href='http://bioit17.galaxyproject.org:8080'>bioit17</a> </td>\n    <td> <a href='http://bioit18.galaxyproject.org:8080'>bioit18</a> </td>\n    <td> <a href='http://bioit19.galaxyproject.org:8080'>bioit19</a> </td>\n  </tr>\n  <tr>\n    <td> <a href='http://bioit20.galaxyproject.org:8080'>bioit20</a> </td>\n    <td> <a href='http://bioit21.galaxyproject.org:8080'>bioit21</a> </td>\n    <td> <a href='http://bioit22.galaxyproject.org:8080'>bioit22</a> </td>\n    <td> <a href='http://bioit23.galaxyproject.org:8080'>bioit23</a> </td>\n    <td> <a href='http://bioit24.galaxyproject.org:8080'>bioit24</a> </td>\n    <td> <a href='http://bioit25.galaxyproject.org:8080'>bioit25</a> </td>\n    <td> <a href='http://bioit26.galaxyproject.org:8080'>bioit26</a> </td>\n    <td> <a href='http://bioit27.galaxyproject.org:8080'>bioit27</a> </td>\n    <td> <a href='http://bioit28.galaxyproject.org:8080'>bioit28</a> </td>\n    <td> <a href='http://bioit29.galaxyproject.org:8080'>bioit29</a> </td>\n  </tr>\n  <tr>\n    <td> <a href='http://bioit30.galaxyproject.org:8080'>bioit30</a> </td>\n    <td> <a href='http://bioit31.galaxyproject.org:8080'>bioit31</a> </td>\n    <td> <a href='http://bioit32.galaxyproject.org:8080'>bioit32</a> </td>\n    <td> <a href='http://bioit33.galaxyproject.org:8080'>bioit33</a> </td>\n    <td> <a href='http://bioit34.galaxyproject.org:8080'>bioit34</a> </td>\n    <td> <a href='http://bioit35.galaxyproject.org:8080'>bioit35</a> </td>\n    <td> <a href='http://bioit36.galaxyproject.org:8080'>bioit36</a> </td>\n    <td> <a href='http://bioit37.galaxyproject.org:8080'>bioit37</a> </td>\n    <td> <a href='http://bioit38.galaxyproject.org:8080'>bioit38</a> </td>\n    <td> <a href='http://bioit39.galaxyproject.org:8080'>bioit39</a> </td>\n  </tr>\n</table>\n<h2 id=\"installing-tools-from-the-tool-shed\"><a href=\"#installing-tools-from-the-tool-shed\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Installing tools from the Tool Shed</h2>\n<h3 id=\"topics-for-this-section\"><a href=\"#topics-for-this-section\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Topics for this section</h3>\n<ul>\n<li>\n<p>What is a Galaxy tool?</p>\n<ul>\n<li>Basic: An XML description of the tool's interface, allowing Galaxy to render a UI (tool form), as well as the command line to execute.</li>\n<li>Complex: XML + wrapper scripts and interfaces to external dependencies</li>\n</ul>\n</li>\n<li>\n<p>Exploring preinstalled tools and filesystem layout</p>\n<ul>\n<li><code>galaxy-dist/tool_conf.xml</code></li>\n<li><code>galaxy-dist/tools/</code></li>\n<li>Example simple tool: <code>galaxy-dist/tools/filters/sorter.xml</code> (tool xml), <code>galaxy-dist/tools/filters/sorter.py</code> (tool code)</li>\n<li>Example tool with unmet dependencies: <code>galaxy-dist/tools/sr_mapping/mosaik.xml</code></li>\n</ul>\n</li>\n<li>\n<p>The Tool Shed</p>\n<ul>\n<li>Installing tools from the Tool Shed</li>\n<li>Exploring the filesystem layout of tools installed from the Tool Shed</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"install-a-tool-from-the-tool-shed\"><a href=\"#install-a-tool-from-the-tool-shed\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Install a tool from the Tool Shed</h3>\n<pre><code class=\"language-wiki\">**You will need to enable 3rd-party cookies in your browser for Tool Shed installations to work:**\n\n  * Chrome: Settings -> Show advanced settings... -> Privacy -> Content Settings... -> Block third-party cookies and site data -> *uncheck*\n  * Firefox: Settings -> Privacy -> History -> Firefox will: *Remember history* **or** Firefox will: *Use custom settings for history* -> Accept third-party cookies: *Always*\n\nReload the Galaxy interface if your 3rd party cookies were not previously enabled.```\n\n\n&#x3C;br />\n* Register an account that matches the address you set in `admin_users`\n* Follow the [tutorial on installing tools from the Tool Shed](/src/admin/tools/add-tool-from-toolshed-tutorial/index.md). In brief:\n  * Click **Admin** from the masthead\n  * Click **Search and browse tool sheds** from the left panel\n  * Click the popup icon for **Galaxy main tool shed** and select **Search for valid tools**\n  * Search for **Tool name**s that contain the name `bwa`\n  * Click the popup icon for **bwa_wrappers** and select **Install to Galaxy**\n  * Select the **NGS: Mapping** section and click **Install to Galaxy**\n* Tools (XML, wrapper scripts) are installed in `/home/ubuntu/shed_tools`\n* Tool dependencies (binaries) are installed in `/home/ubuntu/tool_deps`\n\n### References\n\n* [Tools hub page](/src/tools/index.md)\n* [Tutorial on adding custom tools](/src/admin/tools/add-tool-tutorial/index.md)\n* [Tutorial on installing tools from the Tool Shed](/src/admin/tools/add-tool-from-toolshed-tutorial/index.md)\n* [Current tools/ directory](https://bitbucket.org/galaxy/galaxy-central/src/3b42725359224832317a066d95dff596f93ab33f/tools?at=stable)\n* [Tool Shed hub page](/src/toolshed/index.md)\n* [Tool Shed tour](/src/toolshed/tour/index.md)\n* [Galaxy Main Tool Shed](http://toolshed.g2.bx.psu.edu/)\n\n## Managing local data\n\n### Topics for this section\n\n* What is local data?\n* Manual data inclusion\n  * Building indexes on the command line\n  * `.loc` files\n  * `tool_data_table_conf.xml`\n  * Example of the above with bwa and S. cerevisiae (sacCer2) [transcript](/src/events/bio-it-world2014/w14/index.md#adding-local-data-by-hand)\n* Galaxy Data Managers\n\n### Adding local data with a Galaxy Data Manager\n\nInstall data managers for fetching the reference genome and building BWA indexes:\n\n* Click **Admin** from the masthead\n* Click **Search and browse tool sheds** from the left panel\n* Click the popup icon for **Galaxy main tool shed** and select **Search for valid tools**\n* Search for **Tool id**s that contain the name `manager`\n* Check **data_manager_fetch_genome_all_fasta** and **data_manager_bwa_index_builder**, then click **Install to Galaxy** (at the bottom of the page)\n* Click **Install**\n\nFetch reference genome (fasta):\n\n* Click **Manage local data (beta)** from the left panel\n* Click **Reference Genome - fetching**\n* In the **DBKEY to assign to data:** field, type `sacCer2`\n* In the **UCSC's DBKEY for source FASTA:** field, type `sacCer2`\n* Click **Execute**\n\nBuild BWA indexes:\n\n* Click **Manage local data (beta)** from the left panel\n* Click **BWA index - builder**\n* Click **Execute**\n\nUpon completion:\n\n* `galaxy-dist/tool-data/sacCer2/seq/sacCer2.fa` has been created from chromosome fastas fetched from UCSC\n* `galaxy-dist/tool-data/sacCer2/bwa_index/sacCer2.fa.*` indexes have been generated with `bwa index`\n* `galaxy-dist/tool-data/toolshed.g2.bx.psu.edu/repos/devteam/data_manager_fetch_genome_all_fasta/2ebc856bce29/all_fasta.loc` contains a reference to the newly created `sacCer2.fa`\n* `galaxy-dist/tool-data/toolshed.g2.bx.psu.edu/repos/devteam/data_manager_bwa_index_builder/367878cb3698/bwa_index.loc` contains a reference to the newly built bwa indexes\n* `galaxy-dist/shed_tool_data_table_conf.xml` includes entries for the `all_fasta` and `bwa_indexes` data tables\n\n### References\n\n* [(Manual) index building](/src/admin/data-preparation/index.md)\n* [(Manual) data integration](/src/admin/data-integration/index.md)\n* [Automated data management with Data Managers](/src/admin/tools/data-managers/index.md)\n\n# Setting up a Local Galaxy Tutorial (Part II)\n\nDocumentation for the features used in this section can be found at [usegalaxy.org/production](https://usegalaxy.org/production) (forwards to [Admin/Config/Performance/ProductionServer](/src/admin/config/performance/production-server/index.md))\n\n## Install and configure PostgreSQL\n\n```hightlight console\nubuntu@bioit:~$ sudo apt-get install postgresql\n  ...\nAfter this operation, 15.5 MB of additional disk space will be used.\nDo you want to continue? [Y/n]\n  ...\nCreating new cluster 9.3/main ...\n  config /etc/postgresql/9.3/main\n  data   /var/lib/postgresql/9.3/main\n  locale en_US.UTF-8\n  port   5432\n* Starting PostgreSQL 9.3 database server\n    ...done.\n\nubuntu@bioit:~$ sudo -u postgres createuser galaxy\nubuntu@bioit:~$ sudo -u postgres createdb -O galaxy galaxy\n</code></pre>\n<h2 id=\"create-a-new-user-for-galaxy\"><a href=\"#create-a-new-user-for-galaxy\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Create a new user for Galaxy</h2>\n<pre><code class=\"language-console\">ubuntu@bioit:~$ sudo useradd -m -s /bin/bash galaxy\nubuntu@bioit:~$\n</code></pre>\n<h2 id=\"create-a-python-virtual-environment\"><a href=\"#create-a-python-virtual-environment\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Create a Python virtual environment</h2>\n<pre><code class=\"language-console\">ubuntu@bioit:~$ sudo apt-get install python-virtualenv\nReading package lists... Done\nBuilding dependency tree\nReading state information... Done\nThe following extra packages will be installed:\n  ...\nDo you want to continue? [Y/n]\n  ...\nGet:1 http://us.archive.ubuntu.com/ubuntu/ trusty/main libasan0 amd64 4.8.2-19ubuntu1 [63.0 kB]\n  ...\nProcessing triggers for libc-bin (2.19-0ubuntu6) ...\nubuntu@bioit:~$ sudo -iu galaxy\ngalaxy@bioit:~$ virtualenv venv\nNew python executable in venv/bin/python\nInstalling setuptools, pip...done.\ngalaxy@bioit:~$ source ./venv/bin/activate\n(venv)galaxy@bioit:~$\n</code></pre>\n<h2 id=\"clone-download-galaxy-1\"><a href=\"#clone-download-galaxy-1\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Clone (download) Galaxy</h2>\n<pre><code class=\"language-console\">galaxy@bioit:~$ hg clone https://bitbucket.org/natefoo/galaxy-bioit galaxy-dist\nrequesting all changes\nadding changesets\nadding manifests\nadding file changes\nadded 8 changesets with 3443 changes to 3443 files\nupdating to branch default\n3443 files updated, 0 files merged, 0 files removed, 0 files unresolved\ngalaxy@bioit:~$ cd galaxy-dist\ngalaxy@bioit:~/galaxy-dist$ hg update stable\n0 files updated, 0 files merged, 0 files removed, 0 files unresolved\ngalaxy@bioit:~/galaxy-dist$\n</code></pre>\n<h2 id=\"configure-galaxy\"><a href=\"#configure-galaxy\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Configure Galaxy</h2>\n<pre><code class=\"language-console\">galaxy@bioit:~/galaxy-dist$ cp universe_wsgi.ini.sample universe_wsgi.ini\ngalaxy@bioit:~/galaxy-dist$ vi universe_wsgi.ini\n</code></pre>\n<p>Add the following section for uWSGI's configuration and the job handler processes</p>\n<pre><code class=\"language-ini\">[uwsgi]\nsocket = 127.0.0.1:4001\nstats = 127.0.0.1:9191\nprocesses = 2\nthreads = 4\nmaster = True\nlogto = /home/galaxy/uwsgi.log\npythonpath = lib\n\n[server:handler0]\nuse = egg:Paste#http\nport = 9010\nuse_threadpool = True\nthreadpool_workers = 10\n\n[server:handler1]\nuse = egg:Paste#http\nport = 9011\nuse_threadpool = True\nthreadpool_workers = 10\n</code></pre>\n<p>Set the following settings in the <code>[app:main]</code> section:</p>\n<pre><code class=\"language-ini\">database_connection = postgresql:///galaxy?host=/var/run/postgresql\ndatabase_engine_option_server_side_cursors = True\ndatabase_engine_option_strategy = threadlocal\ntool_dependency_dir = /home/galaxy/tool_deps\nstatic_enabled = False\nnginx_x_accel_redirect_base = /_x_accel_redirect\nnginx_upload_store = /home/galaxy/uploads\nnginx_upload_path = /_upload\nlog_events = False\nlog_actions = False\ndebug = False\nuse_interactive = False\nid_secret = &#x3C;random text>\nadmin_users = nate@bx.psu.edu\n</code></pre>\n<p>Explanations of these options:</p>\n<ul>\n<li><code>database_connection = postgresql:///galaxy?host=/var/run/postgresql</code> - Use a PostgreSQL database via a local UNIX domain socket (the socket is in <code>/var/run/postgresql</code>). <a href=\"https://docs.galaxyproject.org/en/latest/admin/production.html#switching-to-postgresql-database-server\" target=\"_blank\" rel=\"noopener noreferrer\">documentation</a></li>\n<li><code>database_engine_option_server_side_cursors = True</code> - Keep large SQL query results on the PostgreSQL server, rather the transferring the entire result set to the Galaxy processes.</li>\n<li><code>database_engine_option_strategy = threadlocal</code> - Only use one database connection per thread</li>\n<li><code>tool_dependency_dir = /home/galaxy/tool_deps</code> - The directory that will house tool dependencies</li>\n<li><code>static_enabled = False</code> - Static content will be served by the proxy server</li>\n<li><code>nginx_x_accel_redirect_base = /_x_accel_redirect</code> - Delegate dataset downloads to nginx</li>\n<li><code>nginx_upload_store = /home/galaxy/uploads</code> - Delegate uploads to nginx, set temporary directory</li>\n<li><code>nginx_upload_path = /_upload</code> - Special path configured in nginx where uploads will be POSTed</li>\n<li><code>log_events = False</code> - Don't log events in the database (faster)</li>\n<li><code>log_actions = False</code> - Don't log actions in the database (faster)</li>\n<li><code>debug = False</code> - Disables debugging middleware that loads server responses in to memory (can crash the server when handling large files)</li>\n<li><code>use_interactive = False</code> - Disables live client browser debugging (insecure).</li>\n<li><code>id_secret = &#x3C;random text></code> - Ensures that the encoded IDs used by Galaxy (especially session IDs) are unique.  One simple way to generate a value for this is with a shell command like <code>$ date | md5sum</code></li>\n<li><code>admin_users = nate@bx.psu.edu</code> - Make nate@example.org an administrator. Galaxy's Admin UI is only accessible if you define administrators here!</li>\n</ul>\n<p>Honorable mentions for features we won't use today but that are common in big setups:</p>\n<ul>\n<li><code>ftp_upload_dir</code> and <code>ftp_upload_site</code> - Allow users to upload data to the server using FTP</li>\n<li><code>use_remote_user</code> and <code>remote_user_maildomain</code> - Use your institution's existing authentication system to log in to Galaxy. <a href=\"/admin/config/ExternalUserDatbases/\">Apache documentation</a> or <a href=\"https://galaxyproject.org/admin/config/nginx-external-user-auth/#nginx-external-authentication\" target=\"_blank\" rel=\"noopener noreferrer\">nginx documentation</a></li>\n<li><code>allow_user_impersonation</code> - Users configured as administrators (with <code>admin_users</code>) can \"become\" other users to view Galaxy exactly as the impersonated user does. Useful for providing support.</li>\n<li><code>library_import_dir</code> - Administrators can directly import datasets from this directory on the server to Data Libraries.  This includes an option that allows an effective \"symlink\" to the data, rather than copying it in to Galaxy's <code>file_path</code> directory. <a href=\"/admin/data-libraries/uploading-library-files/\">documentation</a></li>\n<li><code>user_library_import_dir</code> - Non-administrators can directly import datasets from this directory on this server to Data Libraries from which they have been given write permission. <a href=\"/admin/data-libraries/uploading-library-files/\">documentation</a></li>\n<li><code>allow_library_path_paste</code> - Administrators can import datasets from anywhere on the server's filesystem(s) by entering their paths in to a text box</li>\n<li><code>object_store_config_file</code> - Configure Galaxy's \"object storage\" layer to store data in multiple filesystems, Amazon S3, iRODS, etc.</li>\n<li><code>error_email_to</code> (with <code>smtp_server</code>) - Allow users to send bug reports directly to you</li>\n<li><code>user_activation_on</code> and related options - Require new users to verify their email address</li>\n<li><code>allow_user_dataset_purge = True</code> - Allow users to forcibly remove their datasets from disk (note that the data is only actually removed if all versions of a shared dataset are purged by all users who are sharing the dataset). By default, Galaxy does not remove data, as this is done at a later time by the dataset cleanup scripts.</li>\n<li><code>enable_quotas = True</code> - Enable Galaxy's quota system. Quotas are configured by administrators in the Galaxy Admin UI</li>\n</ul>\n<p>Create a job system configuration:</p>\n<pre><code class=\"language-console\">galaxy@bioit:~/galaxy-dist$ vi job_conf.xml\n</code></pre>\n<p>In the editor, paste:</p>\n<pre><code class=\"language-xml\">&#x3C;?xml version=\"1.0\"?>\n&#x3C;job_conf>\n    &#x3C;plugins workers=\"2\">\n        &#x3C;plugin id=\"gridengine\" type=\"runner\" load=\"galaxy.jobs.runners.drmaa:DRMAAJobRunner\"/>\n    &#x3C;/plugins>\n    &#x3C;handlers default=\"handlers\">\n        &#x3C;handler id=\"handler0\" tags=\"handlers\"/>\n        &#x3C;handler id=\"handler1\" tags=\"handlers\"/>\n    &#x3C;/handlers>\n    &#x3C;destinations default=\"gridengine\">\n        &#x3C;destination id=\"gridengine\" runner=\"gridengine\"/>\n    &#x3C;/destinations>\n    &#x3C;limits>\n        &#x3C;limit type=\"registered_user_concurrent_jobs\">2&#x3C;/limit>\n        &#x3C;limit type=\"unregistered_user_concurrent_jobs\">1&#x3C;/limit>\n        &#x3C;limit type=\"job_walltime\">24:00:00&#x3C;/limit>\n    &#x3C;/limits>\n&#x3C;/job_conf>\n</code></pre>\n<h2 id=\"start-a-galaxy-server-to-complete-first-run-setup\"><a href=\"#start-a-galaxy-server-to-complete-first-run-setup\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Start a Galaxy server to complete first run setup</h2>\n<pre><code class=\"language-console\">galaxy@bioit:~/galaxy-dist$ sh run.sh\nInitializing datatypes_conf.xml from datatypes_conf.xml.sample\n  ...\nserving on http://127.0.0.1:8080\n^C\n  ...\ngalaxy@bioit:~/galaxy-dist$ logout\nubuntu@bioit:~$\n</code></pre>\n<h2 id=\"install-and-configure-grid-engine\"><a href=\"#install-and-configure-grid-engine\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Install and configure Grid Engine</h2>\n<pre><code class=\"language-console\">ubuntu@bioit:~$ sudo apt-get install gridengine-master gridengine-exec gridengine-client gridengine-drmaa1.0\nReading package lists... Done\nBuilding dependency tree\nReading state information... Done\nThe following extra packages will be installed:\n  bsd-mailx gridengine-common postfix tcsh\nSuggested packages:\n  gridengine-qmon procmail postfix-mysql postfix-pgsql postfix-ldap postfix-pcre sasl2-bin dovecot-common postfix-cdb mail-reader postfix-doc\nThe following NEW packages will be installed:\n  bsd-mailx gridengine-client gridengine-common gridengine-drmaa1.0 gridengine-exec gridengine-master postfix tcsh\n0 upgraded, 8 newly installed, 0 to remove and 5 not upgraded.\nNeed to get 9,172 kB of archives.\nAfter this operation, 51.6 MB of additional disk space will be used.\nDo you want to continue? [Y/n]\n  ...\nPreconfiguring packages ...\n</code></pre>\n<p>You'll be asked a series of configuration questions for Postfix and Grid Engine at this point. The following answers are suitable for this workshop:</p>\n<ul>\n<li>General type of mail configuration: Local only</li>\n<li>System mail name: bioit</li>\n<li>Configure SGE automatically?: Yes</li>\n<li>SGE cell name: default</li>\n<li>SGE master hostname: bioit</li>\n</ul>\n<pre><code class=\"language-console\">ubuntu@bioit:~$ sudo vi /var/lib/gridengine/default/common/host_aliases\n  ...\nlocalhost bioit\n  ...\nubuntu@bioit:~$ sudo service gridengine-master restart\nubuntu@bioit:~$ sudo pkill sge_execd &#x26;&#x26; sudo service gridengine-exec restart\nubuntu@bioit:~$ sudo qconf -aq all.q\n  ...\nhostlist              localhost\nshell                 /bin/bash\n  ...\nubuntu@bioit:~$ sudo qconf -as localhost\nlocalhost added to submit host list\nubuntu@bioit:~$\n</code></pre>\n<h2 id=\"install-nginx-uwsgi-and-supervisord\"><a href=\"#install-nginx-uwsgi-and-supervisord\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Install nginx, uWSGI, and supervisord</h2>\n<pre><code class=\"language-console\">ubuntu@bioit:~$ sudo add-apt-repository ppa:natefoo/bioit2014\n Provides a rebuilt nginx-extras with the upload module for the workshop @\n Bio-IT World Expo 2014\n More info: https://launchpad.net/~natefoo/+archive/bioit2014\nPress [ENTER] to continue or ctrl-c to cancel adding it\n\ngpg: keyring `/tmp/tmp71rhd5g3/secring.gpg' created\ngpg: keyring `/tmp/tmp71rhd5g3/pubring.gpg' created\ngpg: requesting key 12788738 from hkp server keyserver.ubuntu.com\ngpg: /tmp/tmp71rhd5g3/trustdb.gpg: trustdb created\ngpg: key 12788738: public key \"Launchpad PPA for Nate Coraor\" imported\ngpg: Total number processed: 1\ngpg:               imported: 1  (RSA: 1)\nOK\nubuntu@bioit:~$ sudo apt-get update\n  ...\n﻿﻿Fetched 141 kB in 4s (34.0 kB/s)\nReading package lists... Done\nubuntu@bioit:~$ sudo apt-get install nginx-extras uwsgi uwsgi-plugin-python supervisor\n  ...\nAfter this operation, 10.4 MB of additional disk space will be used.\nDo you want to continue? [Y/n]\nGet:1 http://ppa.launchpad.net/natefoo/bioit2014/ubuntu/ trusty/main nginx-common all 1.4.6-1ubuntu3ppa1 [81.5 kB]\nGet:2 http://ppa.launchpad.net/natefoo/bioit2014/ubuntu/ trusty/main nginx-extras amd64 1.4.6-1ubuntu3ppa1 [570 kB]\n  ...\nubuntu@bioit:~$ sudo /etc/init.d/nginx stop\nubuntu@bioit:~$ sudo update-rc.d -f nginx remove\n Removing any system startup links for /etc/init.d/nginx ...\n   /etc/rc0.d/K20nginx\n   /etc/rc1.d/K20nginx\n   /etc/rc2.d/S20nginx\n   /etc/rc3.d/S20nginx\n   /etc/rc4.d/S20nginx\n   /etc/rc5.d/S20nginx\n   /etc/rc6.d/K20nginx\nubuntu@bioit:~$ sudo update-rc.d -f uwsgi remove\n Removing any system startup links for /etc/init.d/uwsgi ...\n   /etc/rc0.d/K20uwsgi\n   /etc/rc1.d/K20uwsgi\n   /etc/rc2.d/S20uwsgi\n   /etc/rc3.d/S20uwsgi\n   /etc/rc4.d/S20uwsgi\n   /etc/rc5.d/S20uwsgi\n   /etc/rc6.d/K20uwsgi\nubuntu@bioit:~$\n</code></pre>\n<h2 id=\"configure-nginx\"><a href=\"#configure-nginx\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Configure nginx</h2>\n<pre><code class=\"language-console\">ubuntu@bioit:~$ cd /etc/nginx\nubuntu@bioit:/etc/nginx$ sudo vi nginx.conf\n  ...\n  user galaxy;\n  daemon off;\n  http {\n      gzip_vary on;\n      gzip_proxied any;\n      gzip_comp_level 6;\n      gzip_buffers 16 8k;\n      gzip_http_version 1.1;\n      gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;\n  }\n  ...\nubuntu@bioit:/etc/nginx$ cd sites-available\nubuntu@bioit:/etc/nginx/sites-available$ sudo vi galaxy\n</code></pre>\n<p>In the editor, paste:</p>\n<pre><code class=\"language-nginx\">client_max_body_size 50g;\nuwsgi_read_timeout 300;\n\nserver {\n    listen 80 default_server;\n    server_name  bioit.galaxyproject.org;\n\n    # pass to uWSGI by default\n    location / {\n        uwsgi_pass 127.0.0.1:4001;\n        include uwsgi_params;\n    }\n\n    # serve static content\n    location /static {\n        alias /home/galaxy/galaxy-dist/static;\n        gzip on;\n        gzip_types text/plain text/xml text/javascript text/css application/x-javascript;\n        expires 24h;\n    }\n    location /static/style {\n        alias /home/galaxy/galaxy-dist/static/style/blue;\n        gzip on;\n        gzip_types text/plain text/xml text/javascript text/css application/x-javascript;\n        expires 24h;\n    }\n    location /static/scripts {\n        alias /home/galaxy/galaxy-dist/static/scripts/packed;\n        gzip on;\n        gzip_types text/plain text/javascript application/x-javascript;\n        expires 24h;\n    }\n    location ~ ^/plugins/visualizations/(?&#x3C;vis_name>.+?)/static/(?&#x3C;static_file>.*?)$ {\n        alias /home/galaxy/galaxy-dist/config/plugins/visualizations/$vis_name/static/$static_file;\n    }\n\n    # delegated downloads\n    location /_x_accel_redirect {\n        internal;\n        alias /;\n    }\n\n    # delegated uploads\n    location /_upload {\n        upload_store /home/galaxy/uploads;\n        upload_store_access user:rw;\n        upload_pass_form_field \"\";\n        upload_set_form_field \"__${upload_field_name}__is_composite\" \"true\";\n        upload_set_form_field \"__${upload_field_name}__keys\" \"name path\";\n        upload_set_form_field \"${upload_field_name}_name\" \"$upload_file_name\";\n        upload_set_form_field \"${upload_field_name}_path\" \"$upload_tmp_path\";\n        upload_pass_args on;\n        upload_pass /_upload_done;\n    }\n    location /_upload_done {\n        set $dst /api/tools;\n        if ($args ~ nginx_redir=([^&#x26;]+)) {\n            set $dst $1;\n        }\n        rewrite \"\" $dst;\n    }\n}\n</code></pre>\n<pre><code class=\"language-console\" class=\"./sites-enabled/\">ubuntu@bioit:/etc/nginx/sites-available$ cd ../sites-enabled/\nubuntu@bioit:/etc/nginx/sites-enabled$ sudo rm default\nubuntu@bioit:/etc/nginx/sites-enabled$ sudo ln -s ../sites-available/galaxy\nubuntu@bioit:/etc/nginx/sites-enabled$\n</code></pre>\n<h2 id=\"configure-supervisord\"><a href=\"#configure-supervisord\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Configure supervisord</h2>\n<pre><code class=\"language-console\">ubuntu@bioit:~$ cd /etc/supervisor/conf.d\nubuntu@bioit:/etc/supervisor/conf.d$ sudo vi galaxy.conf\n</code></pre>\n<p>In the editor, paste:</p>\n<pre><code class=\"language-ini\">[program:nginx]\ncommand     = /usr/sbin/nginx\ndirectory   = /\numask       = 022\nautostart   = true\nautorestart = unexpected\nstartsecs   = 5\nexitcodes   = 0\nuser        = root\n\n[program:galaxy_uwsgi]\ncommand         = /usr/bin/uwsgi --plugin python --ini-paste /home/galaxy/galaxy-dist/universe_wsgi.ini\ndirectory       = /home/galaxy/galaxy-dist\numask           = 022\nautostart       = true\nautorestart     = true\nstartsecs       = 10\nuser            = galaxy\nenvironment     = PATH=/home/galaxy/venv:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin,PYTHON_EGG_CACHE=/home/galaxy/.python-eggs,PYTHONPATH=/home/galaxy/galaxy-dist/eggs/PasteDeploy-1.5.0-py2.7.egg\nnumprocs        = 1\nstopsignal      = INT\n\n[program:handler]\ncommand         = /home/galaxy/venv/bin/python ./scripts/paster.py serve universe_wsgi.ini --server-name=handler%(process_num)s --pid-file=/home/galaxy/handler%(process_num)s.pid --log-file=/home/galaxy/handler%(process_num)s.log\ndirectory       = /home/galaxy/galaxy-dist\nprocess_name    = handler%(process_num)s\nnumprocs        = 2\numask           = 022\nautostart       = true\nautorestart     = true\nstartsecs       = 15\nuser            = galaxy\nenvironment     = PYTHON_EGG_CACHE=/home/galaxy/.python-eggs,DRMAA_LIBRARY_PATH=/usr/lib/gridengine-drmaa/lib/libdrmaa.so.1.0,SGE_ROOT=/var/lib/gridengine\n\n[group:galaxy]\nprograms = handler\n</code></pre>\n<h2 id=\"start-galaxy-and-nginx\"><a href=\"#start-galaxy-and-nginx\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Start Galaxy and nginx</h2>\n<pre><code class=\"language-console\">ubuntu@bioit:~$ sudo supervisorctl update\ngalaxy: added process group\ngalaxy_uwsgi: added process group\nnginx: added process group\nubuntu@bioit:~$ sudo supervisorctl status\ngalaxy:handler0                  STARTING\ngalaxy:handler1                  STARTING\ngalaxy_uwsgi                     STARTING\nnginx                            STARTING\n</code></pre>\n<p>You can now visit your Galaxy server at:</p>\n<table>\n  <tr class=\"th\" >\n    <th colspan=10 style=\" text-align: center;\"> VM Galaxy Instances </th>\n  </tr>\n  <tr>\n    <td> <a href='http://bioit0.galaxyproject.org'>bioit0</a> </td>\n    <td> <a href='http://bioit1.galaxyproject.org'>bioit1</a> </td>\n    <td> <a href='http://bioit2.galaxyproject.org'>bioit2</a> </td>\n    <td> <a href='http://bioit3.galaxyproject.org'>bioit3</a> </td>\n    <td> <a href='http://bioit4.galaxyproject.org'>bioit4</a> </td>\n    <td> <a href='http://bioit5.galaxyproject.org'>bioit5</a> </td>\n    <td> <a href='http://bioit6.galaxyproject.org'>bioit6</a> </td>\n    <td> <a href='http://bioit7.galaxyproject.org'>bioit7</a> </td>\n    <td> <a href='http://bioit8.galaxyproject.org'>bioit8</a> </td>\n    <td> <a href='http://bioit9.galaxyproject.org'>bioit9</a> </td>\n  </tr>\n  <tr>\n    <td> <a href='http://bioit10.galaxyproject.org'>bioit10</a> </td>\n    <td> <a href='http://bioit11.galaxyproject.org'>bioit11</a> </td>\n    <td> <a href='http://bioit12.galaxyproject.org'>bioit12</a> </td>\n    <td> <a href='http://bioit13.galaxyproject.org'>bioit13</a> </td>\n    <td> <a href='http://bioit14.galaxyproject.org'>bioit14</a> </td>\n    <td> <a href='http://bioit15.galaxyproject.org'>bioit15</a> </td>\n    <td> <a href='http://bioit16.galaxyproject.org'>bioit16</a> </td>\n    <td> <a href='http://bioit17.galaxyproject.org'>bioit17</a> </td>\n    <td> <a href='http://bioit18.galaxyproject.org'>bioit18</a> </td>\n    <td> <a href='http://bioit19.galaxyproject.org'>bioit19</a> </td>\n  </tr>\n  <tr>\n    <td> <a href='http://bioit20.galaxyproject.org'>bioit20</a> </td>\n    <td> <a href='http://bioit21.galaxyproject.org'>bioit21</a> </td>\n    <td> <a href='http://bioit22.galaxyproject.org'>bioit22</a> </td>\n    <td> <a href='http://bioit23.galaxyproject.org'>bioit23</a> </td>\n    <td> <a href='http://bioit24.galaxyproject.org'>bioit24</a> </td>\n    <td> <a href='http://bioit25.galaxyproject.org'>bioit25</a> </td>\n    <td> <a href='http://bioit26.galaxyproject.org'>bioit26</a> </td>\n    <td> <a href='http://bioit27.galaxyproject.org'>bioit27</a> </td>\n    <td> <a href='http://bioit28.galaxyproject.org'>bioit28</a> </td>\n    <td> <a href='http://bioit29.galaxyproject.org'>bioit29</a> </td>\n  </tr>\n  <tr>\n    <td> <a href='http://bioit30.galaxyproject.org'>bioit30</a> </td>\n    <td> <a href='http://bioit31.galaxyproject.org'>bioit31</a> </td>\n    <td> <a href='http://bioit32.galaxyproject.org'>bioit32</a> </td>\n    <td> <a href='http://bioit33.galaxyproject.org'>bioit33</a> </td>\n    <td> <a href='http://bioit34.galaxyproject.org'>bioit34</a> </td>\n    <td> <a href='http://bioit35.galaxyproject.org'>bioit35</a> </td>\n    <td> <a href='http://bioit36.galaxyproject.org'>bioit36</a> </td>\n    <td> <a href='http://bioit37.galaxyproject.org'>bioit37</a> </td>\n    <td> <a href='http://bioit38.galaxyproject.org'>bioit38</a> </td>\n    <td> <a href='http://bioit39.galaxyproject.org'>bioit39</a> </td>\n  </tr>\n</table>\n<h2 id=\"references-1\"><a href=\"#references-1\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>References</h2>\n<ul>\n<li><a href=\"http://uwsgi-docs.readthedocs.org/en/latest/\" target=\"_blank\" rel=\"noopener noreferrer\">uWSGI</a></li>\n<li><a href=\"http://supervisord.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Supervisor</a></li>\n<li><a href=\"http://packaging.ubuntu.com/html/\" target=\"_blank\" rel=\"noopener noreferrer\">Ubuntu Packaging Guide</a> - for repackaging <code>nginx-extras</code>, particularly, chapters 4-7 in the Knowledge Base section</li>\n<li><a href=\"https://code.launchpad.net/~natefoo/ubuntu/trusty/nginx/nginx-upload-module\" target=\"_blank\" rel=\"noopener noreferrer\">Modifications to the nginx-extras package</a> - I added the <code>nginx-upload</code> module, which was part of the nginx-extras package in Ubuntu 12.04 LTS (\"precise\").</li>\n</ul>\n<h1 id=\"transcripts\"><a href=\"#transcripts\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Transcripts</h1>\n<h2 id=\"adding-local-data-by-hand\"><a href=\"#adding-local-data-by-hand\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Adding local data by hand</h2>\n<pre><code class=\"language-console\">ubuntu@bioit:~$ mkdir -p ~/local_data/sacCer2/seq/work\nubuntu@bioit:~$ cd ~/local_data/sacCer2/seq/work\nubuntu@bioit:~/local_data/sacCer2/seq/work$ rsync -vz rsync://hgdownload.cse.ucsc.edu/goldenPath/sacCer2/bigZips/chromFa.tar.gz .\nchromFa.tar.gz\n\nsent 51 bytes  received 3,824,563 bytes  1,092,746.86 bytes/sec\ntotal size is 3,823,174  speedup is 1.00\nubuntu@bioit:~/local_data/sacCer2/seq/work$ tar zxvf chromFa.tar.gz\n2micron.fa\nchrI.fa\nchrII.fa\nchrIII.fa\nchrIV.fa\nchrIX.fa\nchrM.fa\nchrV.fa\nchrVI.fa\nchrVII.fa\nchrVIII.fa\nchrX.fa\nchrXI.fa\nchrXII.fa\nchrXIII.fa\nchrXIV.fa\nchrXV.fa\nchrXVI.fa\nubuntu@bioit:~/local_data/sacCer2/seq/work$ cat *.fa >../sacCer2.fa\nubuntu@bioit:~/local_data/sacCer2/seq/work$ cd ../..\nubuntu@bioit:~/local_data/sacCer2$ mkdir bwa_index\nubuntu@bioit:~/local_data/sacCer2$ cd bwa_index\nubuntu@bioit:~/local_data/sacCer2/bwa_index$ ~/tool_deps/bwa/0.5.9/devteam/package_bwa_0_5_9/ec2595e4d313/bin/bwa index -a bwtsw sacCer2.fa\n[bwa_index] Pack FASTA... 0.18 sec\n[bwa_index] Reverse the packed sequence... 0.06 sec\n[bwa_index] Construct BWT for the packed sequence...\n[BWTIncConstructFromPacked] 10 iterations done. 2968163 characters processed.\n[BWTIncConstructFromPacked] 20 iterations done. 5189523 characters processed.\n[BWTIncConstructFromPacked] 30 iterations done. 6938035 characters processed.\n[BWTIncConstructFromPacked] 40 iterations done. 8313523 characters processed.\n[BWTIncConstructFromPacked] 50 iterations done. 9394739 characters processed.\n[BWTIncConstructFromPacked] 60 iterations done. 10243827 characters processed.\n[BWTIncConstructFromPacked] 70 iterations done. 10909811 characters processed.\n[BWTIncConstructFromPacked] 80 iterations done. 11431331 characters processed.\n[BWTIncConstructFromPacked] 90 iterations done. 11838867 characters processed.\n[BWTIncConstructFromPacked] 100 iterations done. 12156547 characters processed.\n[bwt_gen] Finished constructing BWT in 101 iterations.\n[bwa_index] 3.30 seconds elapse.\n[bwa_index] Construct BWT for the reverse packed sequence...\n[BWTIncConstructFromPacked] 10 iterations done. 2968163 characters processed.\n[BWTIncConstructFromPacked] 20 iterations done. 5189523 characters processed.\n[BWTIncConstructFromPacked] 30 iterations done. 6938035 characters processed.\n[BWTIncConstructFromPacked] 40 iterations done. 8313523 characters processed.\n[BWTIncConstructFromPacked] 50 iterations done. 9394739 characters processed.\n[BWTIncConstructFromPacked] 60 iterations done. 10243827 characters processed.\n[BWTIncConstructFromPacked] 70 iterations done. 10909811 characters processed.\n[BWTIncConstructFromPacked] 80 iterations done. 11431331 characters processed.\n[BWTIncConstructFromPacked] 90 iterations done. 11838867 characters processed.\n[BWTIncConstructFromPacked] 100 iterations done. 12156547 characters processed.\n[bwt_gen] Finished constructing BWT in 101 iterations.\n[bwa_index] 3.41 seconds elapse.\n[bwa_index] Update BWT... 0.08 sec\n[bwa_index] Update reverse BWT... 0.07 sec\n[bwa_index] Construct SA from BWT and Occ... 1.03 sec\n[bwa_index] Construct SA from reverse BWT and Occ... 1.02 sec\nubuntu@bioit:~/local_data/sacCer2/bwa_index$ cd ~/galaxy-dist/tool-data\nubuntu@bioit:~/galaxy-dist/tool-data$ vim bwa_index.loc\n  ...\n  sacCer2byhand   sacCer2 S. cerevisiae June 2008 (index by hand) /home/ubuntu/local_data/sacCer2/bwa_index/sacCer2.fa\n  ...\nubuntu@bioit:~/galaxy-dist/tool-data$ cd ..\nubuntu@bioit:~/galaxy-dist$ vim tool_data_table_conf.xml\n  ...\n  &#x3C;table name=\"bwa_indexes\" comment_char=\"#\">\n      &#x3C;columns>value, dbkey, name, path&#x3C;/columns>\n      &#x3C;file path=\"tool-data/bwa_index.loc\" />\n  &#x3C;/table>\n  ...\nubuntu@bioit:~/galaxy-dist$ sh run.sh\n  ...\n</code></pre>\n</div>\n"}},"context":{}}