{"hash":"4f66c62fb6940f4cd6ecf5e4a1e2d62361ec5ff4","data":{"article":{"id":"5e86611282aae32e79c8cfff31cfdfa6","title":"Galaxy Release and Update Process","tease":"","category":null,"date":null,"days":null,"contact":"","contact_url":"","fileInfo":{"path":"build/content-md/release-and-update-process/index.md"},"authors":"","location":"","location_url":"","source_blog":"","source_blog_url":"","skip_title_render":null,"redirect":"","autotoc":null,"links":[],"image":"","images":{},"external_url":"","content":"<div class=\"toc-wrapper col-md-3\">\n<ul>\n<li>\n<p><a href=\"#release-process\">Release Process</a></p>\n<ul>\n<li><a href=\"#repositories-branches-and-tags\">Repositories, Branches and Tags</a></li>\n<li><a href=\"#releases\">Releases</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#updating-galaxy\">Updating Galaxy</a></p>\n<ul>\n<li><a href=\"#intra-release-updates\">Intra-release updates</a></li>\n<li><a href=\"#upgrading-to-a-new-release\">Upgrading to a new release</a></li>\n</ul>\n</li>\n<li><a href=\"#additional-information\">Additional Information</a></li>\n</ul>\n</div>\n<div class=\"body-wrapper col-md-9\">\n<h1 id=\"release-process\"><a href=\"#release-process\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Release Process</h1>\n<h2 id=\"repositories-branches-and-tags\"><a href=\"#repositories-branches-and-tags\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Repositories, Branches and Tags</h2>\n<p>There are two Galaxy repositories:</p>\n<ul>\n<li><a href=\"https://bitbucket.org/galaxy/galaxy-central/\" target=\"_blank\" rel=\"noopener noreferrer\">galaxy-central</a> - The active development repository, all commits go here, all pull requests should be created against it.</li>\n<li><a href=\"https://bitbucket.org/galaxy/galaxy-dist/\" target=\"_blank\" rel=\"noopener noreferrer\">galaxy-dist</a> - The deployment repository, this is where people deploying Galaxy servers should pull from. Its <code>stable</code> branch is rapidly updated from galaxy-central's <code>stable</code> branch. galaxy-dist provides a buffer in the event that a bad commit is pushed to galaxy-central and needs to be stripped.</li>\n</ul>\n<p>The Galaxy repositories always contain at least two branches:</p>\n<ul>\n<li><code>default</code> - Contains active development (in galaxy-central) and is analogous to an <em>unstable</em> version of Galaxy. galaxy-dist's <code>default</code> branch is not updated and should not be used.</li>\n<li><code>stable</code> - Production servers should always run on <code>stable</code>.</li>\n</ul>\n<p>In addition, just prior to a stable release, galaxy-central will contain a <code>next-stable</code> branch, explained below.</p>\n<p>Each release on the <code>stable</code> branch gets two tags:</p>\n<ul>\n<li><code>release_&#x3C;YYYY>.&#x3C;MM>.&#x3C;DD></code> - A fixed tag pointing to the changeset identified as the release.</li>\n<li><code>latest_&#x3C;YYYY>.&#x3C;MM>.&#x3C;DD></code> - A moving tag that is updated to point to the latest change on the stable branch for the given release.</li>\n</ul>\n<h2 id=\"releases\"><a href=\"#releases\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Releases</h2>\n<p>Stable releases of Galaxy occur on a roughly two month cycle. This is the point at which new features are added from the <code>default</code> branch. Two weeks prior to the stable release, we follow this process:</p>\n<ol>\n<li>The <code>next-stable</code> branch in <a href=\"https://bitbucket.org/galaxy/galaxy-central/\" target=\"_blank\" rel=\"noopener noreferrer\">galaxy-central</a> is opened by merging all of the changes from <code>default</code>. New features are frozen from this branch during the duration of its existence.</li>\n<li><a href=\"https://usegalaxy.org/\" target=\"_blank\" rel=\"noopener noreferrer\">usegalaxy.org</a> is updated to the <code>next-stable</code> branch.</li>\n<li>For the following two weeks, bugs in <code>next-stable</code> are identified and fixed.</li>\n<li>On the release date\na. <code>next-stable</code> is merged to <code>stable</code>\na. The <code>release</code> and <code>latest</code> tags for this release are created\na. galaxy-central is pushed to galaxy-dist</li>\n</ol>\n<p>The <code>release</code> tag is used to create a fixed point - this tag will always point to the changeset that was identified as the release for that date. However, its use is discouraged. The <code>latest</code> tag initially starts at the same changeset as the <code>release</code> tag but as bug fixes are committed to the <code>stable</code> branch, the <code>latest</code> tag is updated to point at the most recent <code>stable</code> version. Thus, it should always be safe to update Galaxy using the <code>latest</code> tag corresponding to the stable release you are currently running.</p>\n<h1 id=\"updating-galaxy\"><a href=\"#updating-galaxy\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Updating Galaxy</h1>\n<h2 id=\"intra-release-updates\"><a href=\"#intra-release-updates\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Intra-release updates</h2>\n<p>Because new features, changes to configuration files, database migrations, tool migrations, and other major functionality differences only occur with new releases, Galaxy administrators are encouraged to stay up-to-date with the most recent changes for their release with this process:</p>\n<ol>\n<li><code>hg pull -u latest_&#x3C;YYYY>.&#x3C;MM>.&#x3C;DD></code></li>\n<li>Restart all Galaxy server processes</li>\n</ol>\n<h2 id=\"upgrading-to-a-new-release\"><a href=\"#upgrading-to-a-new-release\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Upgrading to a new release</h2>\n<p>Larger sites are encouraged to run a testing/QA Galaxy server to identify any problems that might occur with the upgrade <em>before</em> upgrading production servers.</p>\n<p>To upgrade to a new release, the following process can be followed:</p>\n<ol>\n<li>Read the <a href=\"https://wiki.galaxyproject.org/DevNewsBriefs/\" target=\"_blank\" rel=\"noopener noreferrer\">Galaxy News Brief</a> for the release you are upgrading to, as well as any other releases newer than your current Galaxy version.</li>\n<li>Check for differences between the old versions of Galaxy configuration files and new ones. There's no trivial process for this right now, but Bitbucket does make it fairly easy on a per-file basis, through the following steps:\na. Locate the desired config file in the source, e.g. <a href=\"https://bitbucket.org/galaxy/galaxy-dist/src/tip/universe_wsgi.ini.sample?at=stable\" target=\"_blank\" rel=\"noopener noreferrer\">universe_wsgi.ini.sample</a>\na. Click the <strong>Diff</strong> button.\na. In the <strong>Diff from</strong> box, choose a suitably old revision (at least as old as your current Galaxy version). The <strong>to</strong> box should already be populated with the most recent revision.\na. Make note of any changes and incorporate them in to your config file, if necessary.</li>\n<li>Back up your database</li>\n<li>Pull the new release: <code>hg pull -u latest_&#x3C;YYYY>.&#x3C;MM>.&#x3C;DD></code></li>\n<li>Upgrade your database with <code>sh manage_db.sh upgrade</code></li>\n<li>Restart the Galaxy server. If you are running a multiprocess Galaxy server, restart <strong>one</strong> Galaxy server process. If any tools were migrated from the distribution to the Tool Shed since your previous release, Galaxy will stop and inform you of this (be sure to scroll up and take note if there was more than one migration version since your Galaxy release).\na. To install the migrated tools from the Tool Shed, follow the instructions given by Galaxy, e.g. <code>sh ./scripts/migrate_tools/0003_tools.sh install_dependencies</code>. A backup of <code>tool_conf.xml</code> will be made and the tools will be installed from the Tool Shed, added to <code>migrated_tools_conf.xml</code> and removed from <code>tool_conf.xml</code>.\na. To continue without installing the migrated tools, remove the migrated tools from your <code>tool_conf.xml</code> (if you have no local tools in <code>tool_conf.xml</code> you can simply <code>cp tool_conf.xml.sample tool_conf.xml</code> and start the server again.</li>\n<li>If you are running a multiprocess Galaxy server, retart the remaining server processes.</li>\n</ol>\n<p>The config files that typically should be checked and merged from the upstream source are <code>universe_wsgi.ini.sample</code>, and <code>datatypes_conf.xml.sample</code>. A full list of sample files that are installed can be found in <a href=\"https://bitbucket.org/galaxy/galaxy-dist/src/tip/scripts/common_startup.sh?at=stable\" target=\"_blank\" rel=\"noopener noreferrer\">scripts/common_startup.sh</a>. Most of these rarely change and many are for features that are not commonly used, so most deployers will not need to track changes in all of them.</p>\n<h1 id=\"additional-information\"><a href=\"#additional-information\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Additional Information</h1>\n<ul>\n<li><a href=\"/admin/get-galaxy/\">/Admin/GetGalaxy</a> - Basic instructions for getting and running the Galaxy code</li>\n<li><a href=\"/admin/config/performance/production-server/\">/Admin/Config/Performance/ProductionServer</a> - Details for running a \"production\" Galaxy server</li>\n<li><a href=\"https://github.com/galaxyproject/usegalaxy-playbook\" target=\"_blank\" rel=\"noopener noreferrer\">usegalaxy-playbook</a> - The <a href=\"http://www.ansible.com\" target=\"_blank\" rel=\"noopener noreferrer\">Ansible</a> playbook used by the Galaxy Team to update <a href=\"https://usegalaxy.org/\" target=\"_blank\" rel=\"noopener noreferrer\">usegalaxy.org</a></li>\n</ul>\n</div>\n"}},"context":{}}