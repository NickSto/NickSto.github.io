{"hash":"c32ecfdb33b075b0057598b5b9118f3554a398cf","data":{"article":{"id":"7bd3f104a89799caa85d6d1c12590088","title":"Enabling cloud bursting for Galaxy","tease":"Expand your compute horizons.","image":"/src/blog/2019-05-gcr/gcr.png","images":{"gcr.png":{"type":"image","mimeType":"image/png","src":"/assets/static/gcr.3fda4bd.171b78fa698b33794eb5c989c33f831c.png","size":{"width":347,"height":253},"sizes":"(max-width: 347px) 100vw, 347px","srcset":["/assets/static/gcr.3fda4bd.171b78fa698b33794eb5c989c33f831c.png 347w"],"dataUri":"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 347 253' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-4d00f563111106e2b71a3890801bdfab'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-4d00f563111106e2b71a3890801bdfab)' width='347' height='253' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAvCAYAAABTy8xRAAAACXBIWXMAAAsSAAALEgHS3X78AAAMgElEQVRo3tVZC3BU5RX%2b792sGOQhDymItrYgj3FsDQNYtK0ULG3FkqkoqUSGPDchEDQkPAIhm91NAiGY8H4LDBWLWKYdpiMC2ewmAgGhFCJUkJfyKNApM304A%2baxt%2bf8//nv/nt3Nzwj8c6cuY%2b9e%2b893/nO82fsdrb5%2b8Xe83HwmtN/8/%2bVHWKsZI84LtnTE%2bRxOtbY2/Xs27HNrhF7V7XYu/39mcffTgDiD163bvL6omM2vq/8NBOOZ/PjJZ%2bJay7vtwCAQp/40Heuavx84d82svJDA4SFP9FY6d4IjDmEQDGWu5Wx92/o/NrSE7Vs2ecn%2bPE/DcaKvOKeIl8bVt6ADy0FCpfuFcoX7OgF1jNYxZE0fl5xVFjSU2OxPrlH2UHxe%2bne59nKcwZ757IBoI0RQB6OCWFKm9zkx8mPnX9gKtty3WCLPt3Nz2sMjTnhsLg2/L9uBZTK%2bn1s/VUBwOLjn7H46e3InbS2q7zjIOP0du4S50Pj7ayi/gTbAPxdfspgLt9Pybrh/lx6DcET1wt3FbJVXxhszYVGtuZ8I1t70WDOqiUEsM7doM1t%2bVVgHfLN%2bQdiKHJnsvVXDLb6/A228V8GsOIjfn3zVzpz7hT%2bLBkj94uP28HXT8K9AMD5JgChmR8XVV1h8/Y9TPe2QRbMJeU9NeLjcrZ0B%2btf4RRe9UUzKWPA768RC2LMrKACUOK3A1NOwn0Gm1fXAOm0EYAF9lRfhX0XYk4bBGAe5HuXD/O/RgptYWsvGZzCSOfVXzazdXBeuu8yy9/eK8yfy/YFXcDtLwbwDFLcgHiAx6v5b0VePSyAtpnN7SMFfBPBDQxIYY1A/wAAECAQGiALAJ2920RhBJZ0KxFdsqEMKO72lwGgF0H%2bAccrWLGvjQdB9P/CXRod17KSvWg5EcBWnQsAEwJsxZkAKIBW/Zp5avuFKFTqZ2Hp0VPbAc47Bc/JvYr3MLOWiFRT3DcA%2bMd93B6OT0GaQ39vBhag8gZnwfwDAYjmzXAPULpmBAGgUwrUzDSIIBSRO0jaS6CmfRB857StYp/9YVsAgCy44T8YC45ABkCqN8FxAIJZAABB5QNgfRDwbbd/sAlA4S6ljCZlsJhy%2bzS4VzNrhhezxD59tc5m/0UAN/NPrG3EhIJdqLiMAQtZ%2bV%2bR6tcBBKE47pH6pXuxHvg7K66LIetS0PTGgcSa9YFbKXdl6VtZr1M1mQDHQ%2biaBixrK25ANC2u7QYKnGELDhmkeDMXjAsIgLvmZTNoLj1FWaRuK0h/Yf19Gs8oPL1WCXZN3gT1w3%2bpRzh5AMrrBfx4%2bamYEBe8b1tRtYzkOoHwOHzUh0JxcAdPLVr%2bc/j9ZaWiE4DN2v4dsGqALTj4BjVMNih6QjND%2bSHBrnn7h/LaYvmpCyznDx0IPPEcZ9V97gHcZiTXlcg9EIAYDb8NAyXspvKwxXqqyHr%2bRLb5f1gpbsbTwYUbH0h1ZOjp6elcxkyZbVvpmaUZokXey6tLLK8XHq7AS73Ka2yvZuUxuJclJyfzR6ampt6nTOCpCYJQuDMsZw%2bcudaekZ6mJ2VkabxzFBbczn7/b%2bgYj15j06sfjvp8Z3U2W3nWgAKrgVeVCw5Cj1Abp95CoNloryEoKAiIw%2bFgaWlprc8Eu4uoWHacPTrnff1HecvtA2asiwnrnEF65G6IY28fuQH1QgCKJuOx/PeW5Ce9Oi7ZMSkTPhxlErAha1pKYnLngj8fY6V1UGCdbGKLjn2NxVb3gm2Lr73AOo7Ontt5QlJK5B7N4dAIFA4IAXXvAZFo0zG%2bTLf83h3kxyCvpzgmvTU9OWHSd/Pf3cPWXMQqsZGtu2zElvgupSdNiHM4MvqlOTL6wr19J2Rm99889umesc4dFQAWBtZmXlCV7jPi8pZ5clISJwNI%2bXAvypsgE0FGgjwJ8mCE75TuxUGQ337HboMoqg9SFSelXwKZSjIOPnZoQcprXe05m7uy%2bZ9c4j0Cb5ig81t6EoJl3YiIL1p0tR242TZgWQME1K9A3BbFYkH6gAwDSSAw5oDMAEkEGQzSIRoYViPelsXp3KYc44ek00eMAnkk3KerZvAqEft%2b0Ss08gBXXMsnqYNc7%2bqvTJ6p5Sa/rj07rSLIpuLaJ6Ga7I2Hm8Y%2brSVk5erGE1GNg0zsDTICJAOkEGQ6yBiQR61gSJdAvSZOnNiy1S101%2bj4EXoR%2bm%2b/kBeAL45808NjgS1vazeg8FXeK2CnKBomKJsvNHEWFOyIp5hiC6kzinZpSrwxhyO/m5QjDaIpVtWjGO77IK8QOwpAnsvIyNBUICh2RGaDxddVuv8aJBekvyUA6cmOTJkdZAW4kEfyoPVlx9jE83zJnqMsRtfMMlvODLFAEn2DZlaIlgmR/DZpJOmWyNDMzEzrvb2JDVNAfpWUlCQNaVPZYAZLDBRW5WHfjh4Qr7qDZMVDro/kh9poUPoMRPBms0kKtssBcxSGe%2bfu6fS/mEiK3uqWkpJiBUWyRLV6DMgvQWZhrMBrwApV11B0FeV7UJDpp1hckw/4zeT80IqOW7%2bqjq08E259CYZwCewmb0CcGBAC3l3OAyUrWgjaGEgng6Qo17RoyvckyneSVpeVGN47fvz44KRX%2brLLNx9KXSxlGzDvK9Y3giB8iXPERjEL9B6EKlEP6TXU7vEegKEcq0E8HoOlem8IlWDfHm%2bAHzqoGSAkMxQdZhbrvcQbIuwPlp8OWKZFEgRiwXmaCR7A1nkZdYUQ9KKM1O9mmK0EO/p%2bqQvGhmy6Rw%2bhA1ZoWGhYlQ8pJoq9QQasOIsd3lHeDeKcYNlJg0%2bJhNVVBhjkBgEIhKKVxgGp2z8oZIByjzc1tiUmJvKYQDphGv%2bZlfpDQcbL4NFiAWFOfPwjeVfoqm6C4BZgFfUBngXClRfnK06LwUmRt4G7jMtXQS5ka811AWvQQ/cGKTJTGl3MloWNGlDCthK/Mun1zRWKVDdCEBTWtSrO5ZzBawMseREoBAxKXtiL5eZ8yCie1u39FeVtCtufYkqhM1V1h6gNBU58Xab/r%2bYAFHkb%2bVjMWWWIxY8LBvd3GQNQeV4O%2b4LDFJwhunxnWEltrPncVtwweKvZAesDkNESgB9isyERimr94IxAArAqBACc9xdViZYWl81wIXTFWbkGgPcZdJ8E4DTsH/ymFkcpK0gAfo4BUQIQJ3MkFTvRn1LiRZ%2bVI6sCEwBhWQGCc7dY/MCJEXZ4yAyhvGQAuYCvjj9nzg6ttdcGpVsrAGBKfIEpuX%2bWmhpaBEEGQY9/RHBSXC2HpFJRwQapeFD5YBB0fzNBMEq9g11sDzUFOrGGtqTFCMor093y/TZQ6LiZCYSigRClVeUlS7D3F2lwSGumwRaUH5Ae4eLzOHxQ02BlZWULwVCOy/0JShxoViwdMAEJHuNvN1j5IbT%2bJhqX68wFRVBxTasorna3ynUs9roxa6tI9f9vJQhq5xTCBuwBMB06vVQP%2bJZSiQsAAL0FEAGLNHHqY4B0%2bepB4Y7m6pG6TtA6yqt9Aaa/QeZ1tTuii/PM6Bj%2bZxaSsor9KiOKeWQXZa4AA2ODWEnioy5WdhAtv5OV1HSxLKHd0%2brP0hTZZGyj7nZYyKAnCkUKZF2gjpjUXvwB104Jgsa6zpFzgWGg4B/B2tc4GPP2G1TwXOcR3%2b2fqLBIvxedoGptqTy1xmoTNJDY/ZSqvJnuo4CA05UKjA2WlwUnsWuMIBNoXYDGWz1AsZ/AtTEAyItA9z7mb1O3oPKaOXK/gwJIGgL3U6ZMaWke0BUkmSZZHazKm4wePnw4s4yWdWX4mQfiwuYBXmSPNK93wEsz01OZ3bVb56u%2bkbZZ20XgNNcYALRC720prTY46pgsAiOeAHkDJAfkmVsei6kR30Kh74GAnulukCyQZ62TWNwyHeksKSNLHzXVFROXt8zed%2bZ6%2b2Oz34vpWfCBPjS3kjnS01iqI4OlBUdaqkKRRLPOAyNVqTT56YcBHOQtsvggi6HCR2G3OBi1WV40lMAoJHYkUCXZ7VatiTM8VAQbMRxc3u5iBryrM84oaTSP3zINJA1Zir9ZZpdai1ZvaZgQDQgL1UbRxHiWsoiB9PsFyBBcBCFfxGHLAzjSvsl77XRvF5AfoCWpbh9H78khSaV394FnxkRwTS3aqP%2bOI6xCS1uUezvS2sFzIGNBkmgWN50EI/FMOs4jy%2bXQCE5ey1WuZxKY8bQw0keO6lpaGZKp/aZ0v8viwjqv127h/9hp4rT5IRpKIDO6wkd2AmlPk2jbLTwn5L3ym%2b5kXfD/ucJnqcawOrsAAAAASUVORK5CYII=' /%3e%3c/svg%3e"}},"category":"blog","contact":"","date":"30 May 2019","content":"<p>Did you ever feel the need for speed, as in more compute capacity on your Galaxy\ninstance? There are just some days when the local capacity does not cut it and\noffloading some compute jobs would be nice. In this post, we'll take a look at\nhow to use a new package, called GalaxyCloudRunner, that streamlines the process\nof setting up additional compute machines for your Galaxy instance and allows\nuser jobs to be sent to those remote machines. This allows you to, for example,\nuse your laptop for text manipulation steps, but then offload the more compute\nintensive jobs to a remote machine. Another example may be to add additional\nresources to a cluster during a workshop training session.</p>\n<p>The <a href=\"https://gcr.cloudve.org\" target=\"_blank\" rel=\"noopener noreferrer\">GalaxyCloudRunner</a> provides a set of configurable\ndynamic job rules for Galaxy that can be used to route user jobs.\nGalaxyCloudRunner leverages <a href=\"https://pulsar.readthedocs.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Pulsar</a>, Galaxy's\nremote job runner, and <a href=\"https://launch.usegalaxy.org/\" target=\"_blank\" rel=\"noopener noreferrer\">CloudLaunch</a> - an\napplication for creating remote machines and configuring applications on them.\nTogether, GalaxyCloudRunner, Pulsar, and CloudLaunch allow virtual machines to\nbe dynamically created on any of the four most popular cloud providers: Amazon\nWeb Services (AWS), Google Cloud Platform (GCP), Microsoft Azure, and OpenStack.\nThe VMs are automatically configured to start accepting jobs from your Galaxy\ninstance, and user jobs are routed to them following desired rules.</p>\n<h1 id=\"lets-get-started\"><a href=\"#lets-get-started\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Let's get started</h1>\n<p>To make use of the GalaxyCloudRunner in a Galaxy instance you need to be a\nsystem administrator of the given Galaxy server and perform the following steps:</p>\n<ol>\n<li>Configure Galaxy to use GalaxyCloudRunner job destination rules</li>\n<li>Launch as many worker nodes as you need through\n<a href=\"https://launch.usegalaxy.org/catalog/appliance/pulsar-standalone\" target=\"_blank\" rel=\"noopener noreferrer\">CloudLaunch</a></li>\n<li>Submit jobs as usual</li>\n</ol>\n<h2 id=\"1-update-the-job-rules\"><a href=\"#1-update-the-job-rules\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>1. Update the job rules</h2>\n<p>In this step, we need to edit Galaxy's <code>job_conf.xml</code> and make it use the\nGalaxyCloudRunner rules. There are a number of rules available so you can\nprobably experiment with some options over time to determine what makes most\nsense for your needs, but in principle, this step needs to be performed only\nonce. The <em>default</em> rule, which we'll use here, routes all jobs to\nGalaxyCloudRunner workers. If a job fails or no workers are available, the job\nwill be automatically resubmitted to a desired location. In the example below,\nthis is just the <code>local</code> job runner but any other destination can be supplied.\nTo see the other available rules, check out the documentation page:\n<a href=\"http://gcr.cloudve.org/en/latest/topics/configure_galaxy.html\" target=\"_blank\" rel=\"noopener noreferrer\">http://gcr.cloudve.org/en/latest/topics/configure_galaxy.html</a>. Also, note that\nthe instructions we're following here apply to Galaxy versions 19.01 or later.\nSee the documentation if you're running an older version of Galaxy.</p>\n<p>To enable this rule, edit <code>config/job_conf.xml</code> and add the content between the\ncomments:\n`<code></code></p>\n<?xml version=\"1.0\"?>\n<p>&#x3C;job_conf>\n<plugins>\n<plugin id=\"local\" type=\"runner\" load=\"galaxy.jobs.runners.local:LocalJobRunner\" workers=\"4\"/>\n<plugin id=\"pulsar\" type=\"runner\" load=\"galaxy.jobs.runners.pulsar:PulsarRESTJobRunner\"/>\n</plugins></p>\n<pre><code>&#x3C;!-- Add the following section -->\n&#x3C;destinations default=\"galaxycloudrunner\">\n    &#x3C;destination id=\"galaxycloudrunner\" runner=\"dynamic\">\n        &#x3C;param id=\"type\">python&#x3C;/param>\n        &#x3C;param id=\"function\">cloudlaunch_pulsar_burst&#x3C;/param>\n        &#x3C;param id=\"rules_module\">galaxycloudrunner.rules&#x3C;/param>\n        &#x3C;param id=\"cloudlaunch_api_endpoint\">https://launch.usegalaxy.org/cloudlaunch/api/v1&#x3C;/param>\n        &#x3C;!-- Obtain your CloudLaunch token by visiting: https://launch.usegalaxy.org/profile -->\n        &#x3C;param id=\"cloudlaunch_api_token\">37c46c89bcbea797bc7cd76fee10932d2c6a2389&#x3C;/param>\n        &#x3C;!-- id of the PulsarRESTJobRunner plugin. Defaults to \"pulsar\" -->\n        &#x3C;param id=\"pulsar_runner_id\">pulsar&#x3C;/param>\n        &#x3C;!-- Destination to fallback to if no nodes are available -->\n        &#x3C;param id=\"fallback_destination_id\">local&#x3C;/param>\n        &#x3C;!-- Pick next available server and resubmit if an unknown error occurs -->\n        &#x3C;resubmit condition=\"unknown_error and attempt &#x26;lt;= 3\" destination=\"galaxycloudrunner\" />\n    &#x3C;/destination>\n    &#x3C;!-- End of GalaxyCloudRunner destination definition -->\n    &#x3C;destination id=\"local\" runner=\"local\"/>\n&#x3C;/destinations>\n&#x3C;tools>\n    &#x3C;tool id=\"upload1\" destination=\"local\"/>\n&#x3C;/tools>\n</code></pre>\n<p>&#x3C;/job_conf>\n`<code></code></p>\n<p>One extra step here is to update the CloudLaunch API key in the above\nconfiguration. Do so by visiting the \"My Profile\" page on CloudLaunch:\n<a href=\"https://launch.usegalaxy.org/profile\" target=\"_blank\" rel=\"noopener noreferrer\">https://launch.usegalaxy.org/profile</a> and obtaining an API token:</p>\n<div class=\"center\"><a href=\"http://gcr.cloudve.org/en/latest/_images/cloudlaunch_view_api_key.png\">\n    <img src=\"http://gcr.cloudve.org/en/latest/_images/cloudlaunch_view_api_key.png\"\n     alt=\"CloudLaunch key\" width=\"50%\" />\n</a></div>\n<p>Finally, restart your Galaxy process.</p>\n<h2 id=\"2-add-workers\"><a href=\"#2-add-workers\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>2. Add workers</h2>\n<p>Now, whenever you’d like to add more capacity to your Galaxy instance, head\nover to the Cloud Bursting appliance on CloudLaunch:\n<a href=\"https://launch.usegalaxy.org/catalog/appliance/pulsar-standalone\" target=\"_blank\" rel=\"noopener noreferrer\">https://launch.usegalaxy.org/catalog/appliance/pulsar-standalone</a> and launch\nas many machines as you'd like. After the machine(s) come up, usually 3-5\nminutes, Galaxy will automatically discover them by querying CloudLaunch\nand route jobs to them based on the supplied rules. When you no longer need the extra\ncapacity, just delete the machines from CloudLaunch.</p>\n<p>In the following screenshots, we're using the Google Cloud Platform to add a\nmachine. Note that you can also mix which providers you use for your workers.</p>\n<div class=\"center\"><a href=\"/src/blog/2019-05-gcr/cloudlaunch.png\">\n    <img src=\"/src/blog/2019-05-gcr/cloudlaunch.png\"\n     alt=\"Running instance\" width=\"80%\" />\n</a></div>\n<h2 id=\"3-submit-jobs\"><a href=\"#3-submit-jobs\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>3. Submit jobs</h2>\n<p>From the user standpoint, the experience of using Galaxy is no different: jobs\nare submitted as normal and, based on the rules and available resource capacity,\nGalaxy submits the jobs to the available resources. In the background, Pulsar\nwill handle tool installation and data staging for inputs and outputs so all\ndata ultimately ends up at your Galaxy instance. In the following screenshot,\na job submitted on a local laptop was sent to a remote GalaxyCloudRunner\ninstance running on GCP where Pulsar automatically installs the necessary tools\nvia Conda and runs the job via an embedded Slurm job manager.</p>\n<div class=\"center\"><a href=\"/src/blog/2019-05-gcr/job-run.png\">\n    <img src=\"/src/blog/2019-05-gcr/job-run.png\" alt=\"Launch page 1\" width=\"80%\" />\n</a></div>\n<h1 id=\"caveats-known-issues-and-future-directions\"><a href=\"#caveats-known-issues-and-future-directions\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Caveats, known issues, and future directions</h1>\n<p>While, for a large number of tools, the above setup will work nicely, there are\nsituations and requirements that may not work. We've summarized the known limitations\nin the GalaxyCloudRunner documentation:\n<a href=\"http://gcr.cloudve.org/en/latest/topics/additional_notes.html\" target=\"_blank\" rel=\"noopener noreferrer\">http://gcr.cloudve.org/en/latest/topics/additional_notes.html</a></p>\n<p>One topic that is not explicitly discussed there is the use of a small Galaxy\ninstance running on a laptop and bursting to cloud machines. This is a\ngreat use case but keep in mind that in order for everything to work, the local\ninstance will need to have the necessary tools and reference data installed.</p>\n<p>Finally, this is the first released version of GalaxyCloudRunner so please feel\nfree to give it a try, <a href=\"https://gitter.im/galaxyproject/FederatedGalaxy\" target=\"_blank\" rel=\"noopener noreferrer\">reach\nout</a>, and let us know what\nworks and what doesn't. As <a href=\"https://github.com/galaxyproject/cloudman/tree/v2.0\" target=\"_blank\" rel=\"noopener noreferrer\">CloudMan 2.0 is\ndeveloped</a>, we will be\nadding automatic scaling to the launched instances and better resource\nmonitoring. As <a href=\"https://github.com/galaxyproject/pulsar\" target=\"_blank\" rel=\"noopener noreferrer\">Pulsar is developed</a>,\ndata staging and transfers will improve. Also, don't hesitate to jump in and\nstart hacking away to make it better:\n<a href=\"https://github.com/CloudVE/galaxycloudrunner!\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/CloudVE/galaxycloudrunner!</a></p>\n"}},"context":{}}