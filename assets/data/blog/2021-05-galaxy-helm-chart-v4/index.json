{"hash":"ef8aba8bb8a02457efb168ecda8caf9311205534","data":{"article":{"id":"87d0d47d3af27d14abd2278187f4614b","title":"Galaxy Helm chart v4.0","tease":"From dev to testing to production on the same stack.","category":"blog","date":"2021-05-07","days":null,"contact":"","contact_url":"","authors":"Alex Mahmoud, Nuwan Goonasekera, Keith Suderman, Enis Afgan","location":"","location_url":"","source_blog":"","source_blog_url":"","skip_title_render":null,"redirect":"","links":[],"image":"","images":{},"external_url":"","content":"<div class=\"toc-wrapper col-md-3\">\n<ul>\n<li><a href=\"#faster-startup\">Faster startup</a></li>\n<li><a href=\"#improved-long-term-application-management\">Improved long-term application management</a></li>\n<li><a href=\"#increased-robustness-of-the-deployment\">Increased robustness of the deployment</a></li>\n<li><a href=\"#configuration-changes-including-backward-incompatible-changes\">Configuration changes, including backward incompatible changes</a></li>\n<li><a href=\"#software-updates\">Software updates</a></li>\n</ul>\n</div>\n<div class=\"body-wrapper col-md-9\">\n<p>We are happy to announce general availability of a new major version of the\nGalaxy Helm chart: version 4.0. The Galaxy Helm chart automates the mechanics of\ndeploying Galaxy into a single package. The same package can be used to deploy\nGalaxy for development, testing, or production. With v4, the chart also\nintroduces improvements for managing Galaxy over time. Let’s take a look at the\nhighlights!</p>\n<h1 id=\"faster-startup\"><a href=\"#faster-startup\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Faster startup</h1>\n<p>We have changed how Galaxy obtains tool wrappers to make the startup time for\nGalaxy about ~30% faster and more consistent. Traditionally, production\ndeployments would mount Galaxy’s CVMFS repository and load tool wrappers from\nthat file system. Tool wrappers are generally small files but there are many of\nthem, making this a very slow process via CVMFS as each file must be cached\nlocally before Galaxy would start. This also required CVMFS to be locally\navailable, which is not possible on Mac computers due to an issue with CVMFS\ndrivers.</p>\n<p>Version 4 of the Galaxy chart retrieves tool wrappers from object store buckets\ninstead of the CVMFS. As the Galaxy Helm chart is installed, a relevant archive\nis downloaded before the Galaxy process starts, hence eliminating the wait while\nGalaxy is starting up. This process works in three stages: (1) an initial\narchive contains the necessary XML files so Galaxy can load the tool panel. This\narchive is about 1MB in size and it is downloaded before Galaxy starts; (2) a\nsecond archive contains the tool scripts and any tool configuration files that\nare required to run the tools. This archive is about 110MB and it is downloaded\nas part of the startup but Galaxy does not need to wait for it; (3) finally, the\nthird archive contains the tool test data. It is about 770MB in size and can be\ndownloaded in due time. The URLs of the three archives are controlled via chart\nvariables so custom toolsets are readily supported.</p>\n<p>A result is the faster and more consistent startup time (see timing results\nbelow), reduced dependency on the Galaxy-project-managed CVMFS structure,\nincreased opportunities for toolset customization by individual sites, and\nability to load and run the tools without the CVMFS. In the future, it will be\ninteresting to explore options for retrieving reference data using a similar\napproach and entirely eliminate the dependency on CVMFS.</p>\n<div class=\"center\">\n  <a href=\"/blog/2021-05-galaxy-helm-chart-v4/no-cvmfs.png\">\n    <div class=\"img-sizer\" style=\"width: 80%\">\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 2044 1216' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-1c92fa290423c9e7e4ba3d3499ee21d1'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-1c92fa290423c9e7e4ba3d3499ee21d1)' width='2044' height='1216' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAmCAIAAAD7pgrOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAIeUlEQVRYw82Z13MTOxSH%2bf%2bfeeABXuAODDAh1IRQU9xrGmm2497WvZd4V/fTyhHLxsmEJJN7zxjnrKyVzu90iQfCJssm0zThe71eOp1OnFMylVhIJycnqVRqe3t7f3%2b/XC43Go36PRLbZbPZs7OzB8JBYOB7OBwi39bWls/n9wd875d96%2btwPhd5vd5wOLy0tLSystJsNvXr90Bqo1arNQfAc8OmbrfLqGEYk8nEHpezT/ZFsy70o2sV1MArMFjPui9SnoLW5gBmsxn%2bgNZLpVIymcxkMgqAOUNEay9mlfKScUmoVsHZMKgCoL9d%2b2nMCuTdW8D1A3aYW0AKI/ZjolK81AKgvWf/WQzAqdROp%2bN0ocMdUcpfCiCXyxUKBeyG9drtNnhGoxEMi5RtAl6/3x%2bPx%2byHnYvF4n1YYDyWAApZKXQhI1LHlwLI5/NI/%2brVq9evX7979%2b7Dhw/r6%2buPHz9G1o8fP758%2bfL9%2b/ffvn0j4p89e8a079%2b/g%2beWFltsgYsAsinCQ5TzInGoJl1qATIpIRSNRkmsm5ubnz596tl0enpKbsAaCI3u2RL7YA2i7i4twJ8DmxDl6OgIISaTqdRuhjiW/nMFAF759esX%2bZTE%2bubNm6dPn66traFmFmEQlSsjLC8vf/78%2bcmTJ3wzc3d3V0f83VgADr/nm0X5QVkA0ccjUSlIF7pocJ1GcXScnm/choyEvklN%2bBW6Z6lKpcIgEYJhmcycwWBAqbmPGOi0RK0qGjWRT4teZx4GGom2wPHxMd6P4h89eoTfY0MU//btW2ocroX6sQzjDx8%2b/PHjh86zd1zInFlIA%2bi2hVEWrYb0pXZTzM4Wp1EUjLujVyogi06nU%2bXrWABNYxwSEXNisZht2/HdA7jMAhoA6QjmUPqtZP5fdQCtozx8lCyhnBVmYgPod0W1JF2oXJByR/3ibCp2o0LFHlXVBUDX3Su6gLsHQILDiavVKt4MgKJNuIHy%2bGJOlHISCUwsKPo9CWM6WQzgv7EAnqqqo9aQbiVULStmxaAvyxmiAyD2fwOA/5CznZ2WbiUgpEf3ACCOdyMyL0V8YnIXAFx9obOZVbyrvdWPbgAkEBLfZRZAenQ/GopcWiSP5GM8KIaD2wKgErP39XG6dP8HANLc4eEhK5LgcH3VdWkApKCDXRkMxPFOVH4nDuaJ6GYA1DRURkmmYAcCAb6p5SRZOpGNjQ3q9M%2bfP%2blBGPT7/RRvxIvH4/y0t7dHdXcDQFYwEMeUd%2bKY2RRRFcQqk%2bI5kAQQkUmJtgL%2blgAozzs7O2BAaHYEA90eQvOIJAAgGUYiEbobOitSC4Orq6tq8l%2bcByTfEXvRuS%2bd2LoHz%2b0tQNpA00gTsAndUaSDwSC9Bur7%2bvUrgx6PJxQKgQGeftbpcgsq8VUAYrKNq5TE0b4UfScs7XBLAPSwX758IXnQtz5//hzRAYAXsRqDWEB1tYDkaA4SfsXJFwfxxQONEwBtbzwgJmMZuKRRWiMsoA5oNwOgtsCbt7e392xKJpIonv4PR8cmqBxH51fwXLbstY%2bU9rthrxgNZOqMBSQMshAnBOx5s1YCAJwIkBsFcwriOxIN0gj6/QG8HGvgP3R%2bNIIwrNxqtVs2dR3UaXcUAGJ1fqjnOEKg4Jq0u/pQPwfgEcO%2bbB/wHApCNCBrs13LbgKAvQIBv9frCQZDsXjY6w29fhEIhfBzH//QPZknZBPM%2bvrG1tYmHxd5PJsq98wBqDMAJZmaAENb4QSA4nvd%2bfYA2A7JgFatxs3qgGXKnkqtlk6Igx3JY9uFxxtaYHPm8h/qkmVfq1zPhXKnshdSj4QEfTUjZ7cA0Ota6aQ1O7MOd63J2Mpn5J1N1G9VSvPLGzu6rG7bqlWs7ZDVqMlHYljV4unEOjkw3QCc3aKzlbgQPfOaMOjPAaTTmUbj7wCQ2Y73pROqepJJSh3DcwSn7OjrHN9PkToS9er5oPXbJoXs9SzgFNrJsyLrKgDZ7F9YQE1p1oV/Q6aBon1bwzGDVoWuESJDjIbzJrItV5V5r92aa43s16jLCenEnwBUDKB4DlAwtVoNALrHctJshnLMZt3cDpvV8qxuiFjkNJWo06XiGDJZjaVqiZDLPtIJW%2bbWd7NcNI2yXK3VNE8TZikv%2bUrRTJ2YmaSZO5WPiGBUzF5HzmTHZsMs5s1Mysyezv4AQGYgDZODOZhTQeB1K7FQhRzzf8VtU8/E8VGumG/12lQ6Cw2RoFDeFR8SAFkYG6YOpc8oquTFQfz3%2bg1j3rGrc3kmIZq1v6kD6nZaFULXdTQUCPq%2bffWtrvjCEW80ElpeXlpbWyGHXduLzFg8Egh6vqx5l5d8wSDL%2bmjhXvzj8/u9ni25USistvP5A97Pq95Xz33BkM/jlSMej8%2bz5YFBxbjMPI26gphkSibFkTBI5ZzorhgxjGqpVDaMilGrlIqMGBlJ2W63R3kaDIZ8ptMz%2b95kxAem3x9wwla/qhG5arnaaNYNo3S%2bQ7leL7P%2b/KGsPqVq1ajVqloQ/iCYYRgwo9EIxm0BDYYfKGqqUqi7NHUFT7s6nU707RqHIdaChwH20CaaSpaGUVcVrMAcUKoRTrDqRdKXxDYZqzae6GIOGPSOhBwCFArFsZpk78hP9FGDc0LaBQDYg0hA5foCkLVYPZ/Pq/8KULYi%2bVC29Yh6kV6SENKdIy%2bCmWmIrqfRHuOirKZHEEvFns5%2bvMgENiUl6mngYX1AOn31gSsA1PmG1/QkYDCCBZ2dIGpA085LHkTkCOK8uOWbgwv7OddHL%2bBRCDVsGjgc2qlE%2bhpmOm/BeAS22tFJDy42W05BNQbX6c75HxlaPj3NKTHuROuGFwEYRSg8rhedlzFX7HhRsMUutDCfXNHWXn1%2bVVd0KkIw73mTYt1sx4v0L9ySFoV6ejmUAAAAAElFTkSuQmCC' /%3e%3c/svg%3e\" width=\"2044\" data-srcset=\"/assets/static/no-cvmfs.82a2fbd.fe2475e5fc1eea94da03be9de150257a.png 480w, /assets/static/no-cvmfs.cbab2cf.fe2475e5fc1eea94da03be9de150257a.png 1024w, /assets/static/no-cvmfs.4db288d.fe2475e5fc1eea94da03be9de150257a.png 2044w\" data-sizes=\"(max-width: 2044px) 100vw, 2044px\" data-src=\"/assets/static/no-cvmfs.4db288d.fe2475e5fc1eea94da03be9de150257a.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/no-cvmfs.4db288d.fe2475e5fc1eea94da03be9de150257a.png\" width=\"2044\"></noscript></p>\n</div>\n  </a>\n</div>\n<h1 id=\"improved-long-term-application-management\"><a href=\"#improved-long-term-application-management\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Improved long-term application management</h1>\n<p>Installing Galaxy is only the first step towards offering an analysis\nenvironment for users. A medium to large-scale installation of Galaxy can easily\nconsume half of a system administrator’s time. The Galaxy Helm chart is aiming\nto lower this burden by consolidating best-practice deployment strategies into a\nsingle package as well as offering capabilities for streamlining long-term\napplication management.</p>\n<p>With the v4 release, the chart now uses a Postgres Operator for database\nmanagement. <a href=\"https://kubernetes.io/docs/concepts/extend-kubernetes/operator/\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes\nOperators</a>\ncapture highly capable logic and processes for entire application lifecycle\nmanagement that mimic that of a human administrator. This includes daily\napplication operations, healing, upgrades, logging, and more (yes, it would be\ngreat to have a Galaxy Operator one day). With this upgrade to the Galaxy chart,\nmanagement of the database layer supports multiple PostgreSQL versions\n(currently ranging between v9.5 and v13), high-availability mode, custom UI, and\nan eye toward the future.</p>\n<p>In addition to the Postgres Operator, the latest version of the chart offers\nenhanced Galaxy probes for application startup, readiness, and liveness. The\nnewly added startup probes allow administrators of production instances to\nbetter configure their handler health checks for high availability setups and\nmore reliable handler scaling.</p>\n<h1 id=\"increased-robustness-of-the-deployment\"><a href=\"#increased-robustness-of-the-deployment\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Increased robustness of the deployment</h1>\n<p>Automated and ongoing testing are critical capabilities for ensuring robustness\nof code. With v4 of the Galaxy Helm chart, continuous integration capabilities\nhave been added. The chart repository now implements a number of GitHub Actions\nthat (1) lint each commit, (2) perform two end-to-end Galaxy deployment, with\nand without the CVMFS, and (3) package the chart for distribution based on the\nlabel used on a pull request.</p>\n<p>Collectively, this increases the quality of the chart implementation because\neach pull request must adhere to consistent standards. With ongoing deployment\ntests, any regressions will be more readily pinned, and automated packaging\nensures all compatible components make up the released package.</p>\n<p>In addition to the chart testing, the latest chart release is used to\nautomatically and on an ongoing basis test all the tools available in the\ndefault release. Split over the course of a week, each day, 1/7th of the toolset\nis tested and <a href=\"https://github.com/anvilproject/galaxy-ci#tool-testing\" target=\"_blank\" rel=\"noopener noreferrer\">test results\nrecorded</a>. This provides\na new test target for all containerized Galaxy tools as well as a longitudinal\nview into test results.</p>\n<h1 id=\"configuration-changes-including-backward-incompatible-changes\"><a href=\"#configuration-changes-including-backward-incompatible-changes\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Configuration changes, including backward incompatible changes</h1>\n<p>Following the evolution of software used within the chart, version 4 uses latest\navailable configuration options and tool versions, which introduce some backward\nincompatible changes.</p>\n<p>Support for Helm 2 has been dropped. Helm 2 stopped being maintained in November\n2020 so it’s time. And Helm 3 is <a href=\"https://helm.sh/blog/helm-3-released/\" target=\"_blank\" rel=\"noopener noreferrer\">much\nbetter</a>.</p>\n<p>Many Galaxy configurations have gradually transitioned from XML-based files to\nYAML-based files.  Job configuration file is no exception and the chart v4 has\nadopted the YAML-based configuration. A direct benefit for the chart is the\nability to set individual values within the file using the <em>--set</em> option with\nHelm as opposed to having to update the entire file even if only a single value\nis being changed.</p>\n<p>The Galaxy Helm chart has long held an option to specify resource requirements\nfor a tool as well as declare or override which container image is used for a\ngiven tool. Version 4 of the chart introduces an updated format for specifying\nthese values. The new format is based on experience of using the old format and\nprovides a more expressive format that allows individual values to be set. The\nchart remains backwards compatible but we recommend updating the values to use\nthe new format to gain the above-mentioned benefits.</p>\n<h1 id=\"software-updates\"><a href=\"#software-updates\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Software updates</h1>\n<p>This chart update brings along new default versions of the software it wraps.\nThe chart now requires Kubernetes 1.16 or newer due to the introduction of\nstartup probes. Galaxy has also been upgraded to the latest available version,\n21.05. Finally, with the Postgres Operator, new deployments come with PostgreSQL\n13.</p>\n<p>In addition to the core software updates, v4 of the chart introduces a new and\nupdated toolset for Galaxy. The toolset has been streamlined to include relevant\ntools for a number of domains and it includes only the latest versions of the\nincluded tools. The toolset includes just over 200 tools, with a detailed list\n<a href=\"https://github.com/almahmoud/anvil-misc/blob/master/reports/anvil/tools.yaml\" target=\"_blank\" rel=\"noopener noreferrer\">available in the CI\nrepo</a>.\nOn a daily basis, this toolset is automatically copied off the CVMFS,\ncompressed, and pushed to a publicly available bucket. This toolset can thus be\nused either through the traditional CVMFS setup or the new bucket method.</p>\n</div>\n"}},"context":{}}