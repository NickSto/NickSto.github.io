{"hash":"64a9e8afa68c1466f7ef441294c96aecf9a68066","data":{"article":{"id":"77c1c92bce90467ee123444743b6075e","title":"Visualizations Registry Cookbook","tease":"","category":null,"date":null,"days":null,"contact":"","contact_url":"","authors":"","location":"","location_url":"","source_blog":"","source_blog_url":"","skip_title_render":null,"links":[],"image":"","images":{},"external_url":"","content":"<div class=\"toc-wrapper col-md-3\">\n<ul>\n<li>\n<p><a href=\"#configuration\">Configuration</a></p>\n<ul>\n<li><a href=\"#i-want-my-visualization-to-work-on-datasets-of-more-than-one-type\">I want my visualization to work on datasets of more than one type</a></li>\n<li><a href=\"#i-want-my-visualization-to-work-on-any-type-of-a-dataset\">I want my visualization to work on any type of a dataset</a></li>\n<li><a href=\"#i-want-my-visualization-to-work-only-on-datasets-produced-by-a-specific-tool\">I want my visualization to work only on datasets produced by a specific tool</a></li>\n<li><a href=\"#i-want-my-visualization-to-work-only-on-datasets-that-can-use-a-particular-dataprovider\">I want my visualization to work only on datasets that can use a particular DataProvider</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#interaction\">Interaction</a></p>\n<ul>\n<li><a href=\"#how-can-i-use-some-of-the-javascript-ui-elements-galaxy-uses-in-my-visualization\">How can I use some of the JavaScript UI elements Galaxy uses in my visualization?</a></li>\n<li><a href=\"#how-can-i-add-a-way-for-the-user-to-select-a-different-or-additional-datasets\">How can I add a way for the user to select a different (or additional) datasets?</a></li>\n</ul>\n</li>\n</ul>\n</div>\n<div class=\"body-wrapper col-md-9\">\n<h2 id=\"configuration\"><a href=\"#configuration\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Configuration</h2>\n<h3 id=\"i-want-my-visualization-to-work-on-datasets-of-more-than-one-type\"><a href=\"#i-want-my-visualization-to-work-on-datasets-of-more-than-one-type\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>I want my visualization to work on datasets of more than one type</h3>\n<p>You want to have your visualization to only be available for datasets from a history that are either a BED or GFF\ndatatype but no other tabular datatypes.</p>\n<p>You can have as many tests in a data source in your configuration as you may need. In this case, we can define two\ndatatype tests, one for each of the two types:</p>\n<pre><code class=\"language-xml\">    &#x3C;data_sources>\n        &#x3C;data_source>\n            &#x3C;model_class>HistoryDatasetAssociation&#x3C;/model_class>\n            &#x3C;test type=\"isinstance\" test_attr=\"datatype\" result_type=\"datatype\">interval.Bed&#x3C;/test>\n            &#x3C;test type=\"isinstance\" test_attr=\"datatype\" result_type=\"datatype\">tabular.Gff&#x3C;/test>\n            &#x3C;to_param param_attr=\"id\">dataset_id&#x3C;/to_param>\n        &#x3C;/data_source>\n    &#x3C;/data_sources>\n</code></pre>\n<p>Now your visualization will appear for both bed and gff datasets.</p>\n<h3 id=\"i-want-my-visualization-to-work-on-any-type-of-a-dataset\"><a href=\"#i-want-my-visualization-to-work-on-any-type-of-a-dataset\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>I want my visualization to work on any type of a dataset</h3>\n<p>Current implementation of the visualization plugin requires you to specify at least one <em>test</em> tag. In oder to have the plugin apply to every datatype and display the visualization option, it is necessary to specify the lowest common denominator datatype: <em>data.Data</em>.</p>\n<pre><code class=\"language-xml\">    &#x3C;test type=\"isinstance\" test_attr=\"datatype\" result_type=\"datatype\">data.Data&#x3C;/test>\n</code></pre>\n<h3 id=\"i-want-my-visualization-to-work-only-on-datasets-produced-by-a-specific-tool\"><a href=\"#i-want-my-visualization-to-work-only-on-datasets-produced-by-a-specific-tool\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>I want my visualization to work only on datasets produced by a specific tool</h3>\n<p>You want to have your visualization only to use datasets produced from a specific tool: the 'FASTQ Summary Statistics'\nfrom the tool shed.</p>\n<p>You can test the data source's (dataset) attributes using the test type <code>eq</code>. This is the default test type, so you\ndon't have to include the <code>type=\"eq\"</code>. In this case, you'll compare the dataset's <code>creating_job.tool_id</code> to the\nfull id of the 'FASTQ Summary Statistics': <code>toolshed.g2.bx.psu.edu/repos/devteam/fastq_stats/fastq_stats/1.0.0</code>:</p>\n<pre><code class=\"language-xml\">    &#x3C;data_sources>\n        &#x3C;data_source>\n            &#x3C;model_class>HistoryDatasetAssociation&#x3C;/model_class>\n            &#x3C;test test_attr=\"creating_job.tool_id\">\n                toolshed.g2.bx.psu.edu/repos/devteam/fastq_stats/fastq_stats/1.0.0\n            &#x3C;/test>\n            &#x3C;to_param param_attr=\"id\">dataset_id&#x3C;/to_param>\n        &#x3C;/data_source>\n    &#x3C;/data_sources>\n</code></pre>\n<p>Attributes are tested using string comparison - so be aware of how the attribute you're testing is converted to a\nstring.</p>\n<p>This can be done by almost any attribute of a data source accessible by <code>getattr</code>. In this case, the ORM-loaded\nattribute <code>creating_job</code>, then the <code>tool_id</code> attribute of that job.</p>\n<h3 id=\"i-want-my-visualization-to-work-only-on-datasets-that-can-use-a-particular-dataprovider\"><a href=\"#i-want-my-visualization-to-work-only-on-datasets-that-can-use-a-particular-dataprovider\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>I want my visualization to work only on datasets that can use a particular DataProvider</h3>\n<p>You're creating a visualization that uses intervals. No matter what the datatype of dataset is, if each datum\ncontains a 'chrom', 'start', and 'end' entry the visualization can use it.</p>\n<p><a href=\"/data-providers/\">DataProviders</a> yield data in configurable ways and many dataset datatypes have them. One format they can yield is the\n'interval' type of data which yields the three values needed. You can use the <code>type=\"has_dataprovider\"</code> test to see\nif a dataset (or any data source) has this data provider:</p>\n<pre><code class=\"language-xml\">    &#x3C;data_sources>\n        &#x3C;data_source>\n            &#x3C;model_class>HistoryDatasetAssociation&#x3C;/model_class>\n            &#x3C;test type=\"has_dataprovider\" test_attr=\"datatype\">interval&#x3C;/test>\n            &#x3C;to_param param_attr=\"id\">dataset_id&#x3C;/to_param>\n        &#x3C;/data_source>\n    &#x3C;/data_sources>\n</code></pre>\n<p>Note: since dataproviders are attributes of a dataset's datatype we need to set <code>test_attr=\"datatype\"</code> so that\n<code>&#x3C;the target HistoryDatasetAssociation>.datatype.has_dataprovider</code> is called.</p>\n<pre><code>wiki comment\n### I want my visualization to be able to load saved visualizations\n\n## Data and how to get it\n\n### I just want the raw data - I'll parse it myself\n\n### I want to get data into a python list\n\n### I want to get data into javascript\n\n## Constructing a visualization using python\n\n### My visualization will use HTML\n\n### My visualization will use SVG\n\n### My visualization will use an image\n\n## Constructing a visualization using javascript\n</code></pre>\n<h2 id=\"interaction\"><a href=\"#interaction\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Interaction</h2>\n<h3 id=\"how-can-i-use-some-of-the-javascript-ui-elements-galaxy-uses-in-my-visualization\"><a href=\"#how-can-i-use-some-of-the-javascript-ui-elements-galaxy-uses-in-my-visualization\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>How can I use some of the JavaScript UI elements Galaxy uses in my visualization?</h3>\n<p>First you'll need to load the base javascript libraries and CSS stylesheets that Galaxy normally includes on every one\nof it's pages. Load these in the <code>head</code> section of your mako template:</p>\n<pre><code class=\"language-mako\">&#x3C;!DOCTYPE HTML>\n&#x3C;html>\n&#x3C;head>\n\n${h.css( 'base' )}\n${h.stylesheet_link( '/plugins/visualizations/myvis/static/myvis.css' )}\n\n${h.js( 'libs/jquery/jquery',\n        'libs/jquery/jquery.migrate',\n        'libs/jquery/jquery-ui',\n        'libs/bootstrap',\n        'libs/require',\n        'libs/underscore',\n        'libs/backbone/backbone',\n        'mvc/ui'\n)}\n&#x3C;script type=\"text/javascript\" src=\"/plugins/visualizations/myvis/static/myvis.js\">&#x3C;/script>\n\n&#x3C;/head>\n</code></pre>\n<p>Galaxy often uses a <code>module</code> loading system called <a href=\"http://requirejs.org/\" target=\"_blank\" rel=\"noopener noreferrer\">requirejs</a>. Although it can seem complex at\nfirst, the example below is often all you have to do to load a Galaxy component:</p>\n<pre><code class=\"language-javascript\">// (from within a script tag in your mako template)\n\n// point require at Galaxy's script directory:\nrequire.config({\n    baseUrl: \"/static/scripts\"\n});\n// tell it to load the component's file asynchronously\nrequire([\n    'mvc/dataset/dataset-choice'\n], function( DATASET_CHOICE ){\n    // this function is called when the page has loaded the script and\n    //  the module is now loaded under the js namespace/obj DATASET_CHOICE\n\n    // when the page is ready:\n    $(function(){\n    //    ... do something with DATASET_CHOICE\n    });\n});\n</code></pre>\n<h3 id=\"how-can-i-add-a-way-for-the-user-to-select-a-different-or-additional-datasets\"><a href=\"#how-can-i-add-a-way-for-the-user-to-select-a-different-or-additional-datasets\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>How can I add a way for the user to select a different (or additional) datasets?</h3>\n<p>The javascript libraries for Galaxy have code to create a javascript control to do this. See the section\n<a href=\"/visualizations-registry/cookbook/#how-can-i-use-some-of-the-javascript-ui-elements-galaxy-uses-in-my-visualization\">above</a>\nfor information on how to include Galaxy UI components. From within your mako template or scripts, you can\nthen use this to allow a user dataset choice from datasets in the user's current history:</p>\n<pre><code class=\"language-javascript\">require.config({\n    baseUrl: \"/static/scripts\"\n});\nrequire([\n    'mvc/dataset/dataset-choice'\n], function( DATASET_CHOICE ){\n    $(function(){\n        // this ajax call will return the full detailed json for all datasets and collections in the current history\n        //  it may be useful to cache this if you're adding more than one dataset choice control\n        var historyContentsFetch = jQuery.ajax( '/api/histories/'\n            + '${ trans.security.encode_id( trans.history.id ) }/contents?details=all' );\n\n        // when the ajax completes successfully, ...\n        historyContentsFetch.done( function( datasetJSON ){\n            // ... create the controls and add them to the page\n            $( '.my-controls' ).append([\n\n                // for a single dataset choice\n                new DATASET_CHOICE.DatasetChoice({\n                    datasetJSON : datasetJSON,\n                    label       : 'Input dataset',\n                    // pass in the ids of any datasets you want previously/already selected\n                    selected    : [ 'df7a1f0c02a5b08e' ]\n                }).render().$el,\n\n                // or to allow selection of multiple datasets\n                new DATASET_CHOICE.MultiDatasetChoice({\n                    datasetJSON : datasetJSON,\n                    label       : 'Input datasets',\n                    selected    : [ 'df7a1f0c02a5b08e'  ]\n                }).render().$el\n            ]);\n        });\n    });\n});\n</code></pre>\n<p>See: <a href=\"https://bitbucket.org/carlfeberhard/galaxy-visualization-dataset-choice\" target=\"_blank\" rel=\"noopener noreferrer\">this example repository</a> for more info.</p>\n<pre><code class=\"language-wiki\">### How can I allow user interaction without knowing or using javascript?\n\n### How can I add a way for the user to save a visualization using python?\n\n### How can I add a way for the user to save visualization over the API or with javascript?\n</code></pre>\n</div>\n"}},"context":{}}