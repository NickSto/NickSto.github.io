{"hash":"c32ecfdb33b075b0057598b5b9118f3554a398cf","data":{"article":{"id":"a63ff785348b84b95f19fc2359c4d9c3","title":"Finding and quantifying new transcripts","tease":"","image":"","images":{},"category":null,"contact":"","date":null,"content":"<blockquote class=\"blockquote\">\n<small>\nThis tutorial is built upon efforts of [Mo Heydarian](https://galaxyproject.org/people/mo-heydarian/) and [Mallory Freeberg](https://github.com/malloryfreeberg) and tools wrapped by [Björn Grüning](https://github.com/bgruening), [Marius van den Beek](https://github.com/mvdbeek) and other [IUC](https://galaxyproject.org/iuc/) members.\n</small>\n</blockquote>\n<h1 id=\"introduction\"><a href=\"#introduction\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Introduction</h1>\n<div class=\"alert alert-success\" role=\"alert\">\n**Objective**: To compare RNAseq data from two distinct cell types in order to identify and quantify differentially expressed transcripts.\n</div>\n<p>We will use RNA-seq data from a study published by <em>Wu et al.</em> in 2014 <a href=\"http://genome.cshlp.org/content/early/2014/10/12/gr.164830.113.abstract\" target=\"_blank\" rel=\"noopener noreferrer\">DOI:10.1101/gr.164830.113</a>. The goal of this study was to investigate \"<em>the dynamics of occupancy and the role in gene regulation of the transcription factor Tal1, a critical regulator of hematopoiesis, at multiple stages of hematopoietic differentiation.</em>\" To this end, RNA-seq libraries were constructed from multiple mouse cell types including G1E - a GATA-null immortalized cell line derived from targeted disruption of GATA-1 in mouse embryonic stem cells - and megakaryocytes. This RNA-seq data was used to determine differential gene expression between G1E and megakaryocytes and later correlated with Tal1 occupancy. This dataset (GEO Accession: <a href=\"https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE51338\" target=\"_blank\" rel=\"noopener noreferrer\">GSE51338</a>) consists of biological replicate, paired-end, poly(A) selected, stranded (dUTP) RNA-seq libraries. Because of the long processing time for the large original files, we have down-sampled the original raw data files to include only reads that align to chromosome 19 and a subset of interesting genomic loci identified by Wu <em>et al</em>.</p>\n<h2 id=\"key-fact-about-this-study\"><a href=\"#key-fact-about-this-study\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Key fact about this study:</h2>\n<ul>\n<li>TAL1 is a transcription factor essential for hematopoesis. It is critically needed for establishing hematopoetic stem cells during embryonic development and to differentiate between <a href=\"https://en.wikipedia.org/wiki/Red_blood_cell\" target=\"_blank\" rel=\"noopener noreferrer\">erythroid</a> and <a href=\"https://en.wikipedia.org/wiki/Myeloid\" target=\"_blank\" rel=\"noopener noreferrer\">myeloid</a> cell lineages, including those leading to megakaryocytes, mast cells, and eosinophils.</li>\n<li>Some of the TAL1 molecules are components of multiprotein complexes that also include other transcriptional factors such as GATA-1.</li>\n<li>By contrasting RNA from GATA-null G1E cells with that of megakaryocytes we can identify transcripts regulated by GATA-1 dependent TAL1.</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"https://upload.wikimedia.org/wikipedia/commons/f/f0/Hematopoiesis_simple.svg\"></td>\n</tr>\n<tr>\n<td><small><strong>Schematic representation of hematopoesis</strong> (from <a href=\"https://en.wikipedia.org/wiki/Haematopoiesis\" target=\"_blank\" rel=\"noopener noreferrer\">Wikipedia</a>)</small></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"analysis-strategy\"><a href=\"#analysis-strategy\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Analysis strategy</h2>\n<p>The goal of this exercise is to:</p>\n<ol>\n<li>Identify what transcripts are present in the G1E and megakaryocyte cellular states</li>\n<li>\n<p>Which transcripts are differentially expressed between the two states. </p>\n<p>We will use a <em>de novo</em> transcript reconstruction strategy (not to be confused with the <em>de novo</em> RNAseq when reference genome is not known) to infer transcript structures from the mapped reads in the absence of the actual annotated transcript structures. This will allow us to identify novel transcripts and novel isoforms of known transcripts, as well as identify differentially expressed transcripts. </p>\n</li>\n</ol>\n<h2 id=\"tutorial-agenda\"><a href=\"#tutorial-agenda\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Tutorial Agenda</h2>\n<p>In this tutorial, we will address:</p>\n<ol>\n<li>Data upload</li>\n<li>Read QC and pre-processing</li>\n<li>Read mapping</li>\n<li><em>De novo</em> transcript reconstruction</li>\n<li>Transcriptome assembly</li>\n<li>Read counting and differential expression analysis</li>\n<li>Visualization</li>\n</ol>\n<h1 id=\"the-data\"><a href=\"#the-data\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>The Data</h1>\n<p>Due to the large size of this dataset, we have down-sampled it to only include reads mapping to chromosome 19 and certain loci with relevance to hematopoeisis. This data is available from two sources:</p>\n<ul>\n<li><a href=\"https://zenodo.org/record/254485\" target=\"_blank\" rel=\"noopener noreferrer\">Zenodo</a> (use these data on <strong>any</strong> Galaxy instance)</li>\n<li><a href=\"https://usegalaxy.org/library/list#folders/F3481856ea042c39d\" target=\"_blank\" rel=\"noopener noreferrer\">Galaxy data library</a> (use these data on <strong>main</strong> Galaxy server at <a href=\"http://usegalaxy.org\" target=\"_blank\" rel=\"noopener noreferrer\">http://usegalaxy.org</a>).</li>\n</ul>\n<h2 id=\"data-organization-and-naming\"><a href=\"#data-organization-and-naming\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Data organization and naming</h2>\n<p>The data is structured in the following way:</p>\n<ul>\n<li>There are two samples: G1E cells and megakaryocytes (<code>G1E</code> and <code>Mk</code>)</li>\n<li>There are two <em>biological</em> replicates per sample: <code>R1</code> and <code>R2</code></li>\n<li>Each replicate has forward and reverse reads (<code>f</code> and <code>r</code>)</li>\n<li>Thus, there are eight (8) fastq files</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/lib.png\"></td>\n</tr>\n<tr>\n<td><small><strong>Galaxy data library containing the reads</strong>. Here you can see two cell types (<code>G1E</code> and <code>Mk</code>) with two replicates for each cell type (<code>R1</code> and <code>R2</code>). Each replicate is requested with paired-end reads (<code>f</code> and <code>r</code>).</small></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"how-to-upload-the-data-into-galaxy\"><a href=\"#how-to-upload-the-data-into-galaxy\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>How to upload the data into Galaxy</h2>\n<div class=\"panel-group\" id=\"accordion\" role=\"tablist\" aria-multiselectable=\"true\">\n  \t<div class=\"panel panel-default\">\n    \t<div class=\"panel-heading\" role=\"tab\" id=\"headingOne\">\n      \t\t<h4 class=\"panel-title\">\n        \t\t<a role=\"button\" data-toggle=\"collapse\" data-parent=\"#accordion\" href=\"#collapseOne\" aria-expanded=\"true\" aria-controls=\"collapseOne\">\n          \t\t\tData upload from Galaxy Library (**recommended** if using http://usegalaxy.org)\n        \t\t</a>\n      \t\t</h4>\n    \t</div>\n    \t<div id=\"collapseOne\" class=\"panel-collapse collapse in\" role=\"tabpanel\" aria-labelledby=\"headingOne\">\n    \t\t<div class=\"panel-body\">\n        \t\t1. Right click on [this link](https://usegalaxy.org/library/list#folders/F3481856ea042c39d) and use \"Open link in a new tab\" option<br>\n \t\t\t\t2. Select `reads` folder by clicking on it<br>\n \t\t\t\t3. Click checkboxes for all datasets<br>\n \t\t\t\t4. Click **to History button**<br>\n \t\t\t\t5. Select an existing history or create a new one by naming it.<br><br>\n \t\t\t\t![](/src/tutorials/nt_rnaseq/toHist.png)<br>\n    \t\t</div>\n  \t\t</div>\n  \t</div>\t\n  \t<div class=\"panel panel-default\">\n   \t\t<div class=\"panel-heading\" role=\"tab\" id=\"headingTwo\">\n      \t\t<h4 class=\"panel-title\">\n        \t\t<a class=\"collapsed\" role=\"button\" data-toggle=\"collapse\" data-parent=\"#accordion\" href=\"#collapseTwo\" aria-expanded=\"false\" aria-controls=\"collapseTwo\">\n          \t\t\tData upload from Zenodo\n        \t\t</a>\n      \t\t</h4>\n    \t</div>\n    \t<div id=\"collapseTwo\" class=\"panel-collapse collapse\" role=\"tabpanel\" aria-labelledby=\"headingTwo\">\n      \t\t<div class=\"panel-body\">\n        \t\t1. Create a new history for this RNA-seq exercise<br>\n \t\t\t\t2. Open the data upload manager (Get Data -> Upload file)<br>\n \t\t\t\t3. Copy and paste the links for the reads and annotation file <br>\n \t\t\t\t4. Select **Paste/Fetch Data**<br>\n \t\t\t\t5. Paste the link(s) into the text field<br>\n \t\t\t\t6. Change the datatype of the read files to **fastqsanger**<br>\n \t\t\t\t7. Change the datatype of the annotation file to **gtf** and assign the Genome as **mm10**<br>\n \t\t\t\t8. Press **Start**<br>\n \t\t\t\t9. Rename the files in your history to retain just the necessary information (*e.g.* \"G1E R1 forward reads\")\n      \t\t</div>\n    \t</div>\n \t</div>\n</div>\n<p>Once you upload data into a new history you Galaxy interface should look like this:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/afterUpload.png\"></td>\n</tr>\n<tr>\n<td><small><strong>Datasets are uploaded into a new history</strong>. Here the history was named <code>Novel transcripts</code>. You can name history as well by clicking on its name. For more info on histories see this <a href=\"/tutorials/histories\">tutorial</a>.</small></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"exploring-the-data\"><a href=\"#exploring-the-data\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Exploring the data</h1>\n<p>To lean more about the data we will be using let's look at just one set of reads. This will give us an idea on how good the data is and what we might need to do with it before proceeding with the analysis.</p>\n<h2 id=\"assess-data-quality\"><a href=\"#assess-data-quality\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Assess data quality</h2>\n<p>For quality control, we use similar tools as described in <a href=\"/tutorials/ngs/\">NGS-QC tutorial</a>: <a href=\"http://www.bioinformatics.babraham.ac.uk/projects/fastqc/\" target=\"_blank\" rel=\"noopener noreferrer\">FastQC</a> and <a href=\"http://www.usadellab.org/cms/?page=trimmomatic\" target=\"_blank\" rel=\"noopener noreferrer\">Trimmomatic</a>.</p>\n<p>Let's start by processing the smaller set of reads from G1E set: <code>G1E_R1_f_ds_SRR549355</code> and its reverse set of mates <code>G1E_R1_r_ds_SRR549355</code> using <strong>NGS: QC and manipulation -> FastQC</strong>: </p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/g1e_qc.png\"></td>\n</tr>\n<tr>\n<td><small><strong>QC'ing reads with FastQC</strong>. Note we've pressed the <i class=\"far fa-copy\" aria-hidden=\"true\"></i> button to enable selection of multiple datasets within the <strong>Short read data from your current history</strong> box.</small></td>\n</tr>\n</tbody>\n</table>\n<p>This will generate the following quality value distributions:</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\"></th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\"><img src=\"/src/tutorials/nt_rnaseq/f_qc.png\"></td>\n<td align=\"center\"><img src=\"/src/tutorials/nt_rnaseq/r_qc.png\"></td>\n</tr>\n<tr>\n<td align=\"center\"><code>G1E_R1_f_ds_SRR549355</code></td>\n<td align=\"center\"><code>G1E_R1_r_ds_SRR549355</code></td>\n</tr>\n</tbody>\n</table>\n<div class=\"panel panel-info\">\n\t<div class=\"panel-heading\">\n  \t\t<a data-toggle=\"collapse\" href=\"#qc\" aria-expanded=\"false\" aria-controls=\"collapseExample\">\n     \t\t<i class=\"fa fa-question-circle\" aria-hidden=\"true\"></i> What can you tell about these data?\n    \t</a>\n  \t</div>\n  \t<div class=\"panel-body collapse\" id=\"qc\">\n        - The read length is 99 bp<br>\n        - The quality of base calls declines throughout a sequencing run.\n  \t</div>\n</div>\n<h2 id=\"dynamically-trim-low-quality-bases-from-reads-ends\"><a href=\"#dynamically-trim-low-quality-bases-from-reads-ends\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Dynamically trim low quality bases from reads` ends</h2>\n<p>The quality score distributions we seen above for one sample are characteristic of all reads in our dataset (you can run FastQC on remaining reads to see if this is true). To increase mapping efficiency we can trim off the low quality bases from the ends of the reads using <strong>NGS: QC and manipulation -> Trimmomatic</strong>:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/trimmomatic.png\"></td>\n</tr>\n<tr>\n<td><small><strong>Running <code>trimmomatic</code></strong> on G1E_R1 read pair.</small></td>\n</tr>\n</tbody>\n</table>\n<p>Trimmomatic will produce four outputs as a result:</p>\n<ul>\n<li><code>Trimmomatic on G1E_R1_f_ds_SRR549355 (R1 paired)</code></li>\n<li><code>Trimmomatic on G1E_R1_f_ds_SRR549355 (R2 paired)</code></li>\n<li><code>Trimmomatic on G1E_R1_f_ds_SRR549355 (R1 unpaired)</code></li>\n<li><code>Trimmomatic on G1E_R1_f_ds_SRR549355 (R2 uppaired)</code></li>\n</ul>\n<p>The <code>unpaired</code> datasets we will no longer need in our analysis. </p>\n<p>Now that we've ran <code>trimmomatic</code> let's see if it had any effect on our data. We can do this by rerunning <code>FastQC</code> on <code>G1E_R1_f_ds_SRR549355</code> and <code>G1E_R1_r_ds_SRR549355</code> datasets after they have been trimmed. This will generate the following quality value distributions:</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\"></th>\n<th align=\"center\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\"><img src=\"/src/tutorials/nt_rnaseq/f_qc_trimmed.png\"></td>\n<td align=\"center\"><img src=\"/src/tutorials/nt_rnaseq/r_qc_trimmed.png\"></td>\n</tr>\n<tr>\n<td align=\"center\"><code>G1E_R1_f_ds_SRR549355</code></td>\n<td align=\"center\"><code>G1E_R1_r_ds_SRR549355</code></td>\n</tr>\n</tbody>\n</table>\n<div class=\"panel panel-info\">\n\t<div class=\"panel-heading\">\n  \t\t<a data-toggle=\"collapse\" href=\"#qc_after_trim\" aria-expanded=\"false\" aria-controls=\"collapseExample\">\n     \t\t<i class=\"fa fa-question-circle\" aria-hidden=\"true\"></i> What is the effect of trimming on the data?\n    \t</a>\n  \t</div>\n  \t<div class=\"panel-body collapse\" id=\"qc_after_trim\">\n        The average quality of base calls does not drop off as sharply at the 3' ends of reads.\n  \t</div>\n</div>\n<h2 id=\"is-this-a-stranded-rnaseq-experiment\"><a href=\"#is-this-a-stranded-rnaseq-experiment\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Is this a stranded RNAseq experiment?</h2>\n<p>RNAseq data is often <a href=\"/tutorials/rb-rnaseq/#strand-specific-rnaseq\">stranded</a> as it significantly increases its utility. But how do you know you have a stranded data? Moreover, if data is indeed stranded is it derived from first or second cDNA strand? To answer this question we can map the data and analyze mapping properties. Let's do that on the same set of forward and reverse <code>G1E_R1</code> datasets. </p>\n<h3 id=\"map-subset-of-data\"><a href=\"#map-subset-of-data\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Map subset of data</h3>\n<p>Here we will use <strong>NGS: RNA analysis -> HISAT</strong> to map the reads against the mouse genome:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/hisat_def.png\"></td>\n</tr>\n<tr>\n<td><small><strong>Running <code>HISAT</code> with default parameters on trimmed data.</strong> Select <code>Individual paired reads</code> from <strong>Single or paired reads?</strong> dropdown to be able to select individual fastq datasets. Make sure you select correct inputs (do not select <code>unpaired</code> trimmomatic outputs by accident).</small></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"filter-and-restrict-to-a-small-region-of-interest\"><a href=\"#filter-and-restrict-to-a-small-region-of-interest\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Filter and restrict to a small region of interest</h3>\n<p>All we need is to look at read mapping around some known gene (pick any well expressed gene you like). To do this we will filter BAM dataset using <strong>NGS: SAMtools -> Filter SAM or BAM</strong>:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/hisat_filter_intro.png\"></td>\n</tr>\n</tbody>\n</table>\n<p>|<small><strong>Filter BAM data</strong> to retain only well mapped reads (<strong>Minimum MAPQ quality score</strong> is <code>20</code>) that are in proper pairs and mapped around position <code>chr11:96192361-96198599</code>.</small></p>\n<h3 id=\"display-at-igv\"><a href=\"#display-at-igv\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Display at IGV</h3>\n<p>Now let's display results of this experiment in IGV. For this expand the latest dataset by clicking on it and choose link highlighted below:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/igv_test1.png\"></td>\n</tr>\n<tr>\n<td><small>Expand dataset and click highlighted link (on Linux systems you may need to install IGV separately and use <code>local</code> link).</small></td>\n</tr>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/igv_test2.png\"></td>\n</tr>\n<tr>\n<td><small>Once IGV starts, focus it on the gene of interest by typing its name into the location box (in the image above the location box is on top of IGV interface and has coordinates <code>chr11:96,192,361-96,198,599</code> in it) . In this case the gene is <em>Hoxb13</em>.</small></td>\n</tr>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/igv_test3.png\"></td>\n</tr>\n<tr>\n<td><small>Right click on the lift side of interface to (1) color, group, and sort alignments by <code>first-of-pair strand</code> and (2) set view to <code>collapsed</code>.</small></td>\n</tr>\n</tbody>\n</table>\n<p>In the picture above you will see that the absolute majority of read pairs have their first read mapping on the negative strand (they are blue). At the same time the gene in the picture, <em>Hoxb13</em>, is on the positive strand (its arrows point from left to right). This this is a stranded RNA seq data were first cDNA strand is being sequenced. This implies that when we start actual analysis of this data we will use <code>First Strand (R/RF)</code> setting of <code>HISAT</code>.</p>\n<h1 id=\"preparing-dataset-collections\"><a href=\"#preparing-dataset-collections\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Preparing dataset collections</h1>\n<p>Now we know that we are dealing with a stranded RNAseq experiment and that it may benefit from trimming the reads. Let's begin actual analysis. Instead of running a single tool multiple times on all your data, would you rather run a single tool on multiple datasets at once? To do this we will use <a href=\"/tutorials/collections/\">dataset collections</a> feature of Galaxy!</p>\n<h2 id=\"copy-datasets-to-a-new-history\"><a href=\"#copy-datasets-to-a-new-history\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Copy datasets to a new history</h2>\n<p>We want to create a new clean history by moving the original sequence data. To do this we click on the cog (<i class=\"fa fa-cog\" aria-hidden=\"true\"></i>) above the history pane and choose <strong>copy datasets</strong> and follow the instructions in the figure below:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>A.</strong> Click on the cog (<i class=\"fa fa-cog\" aria-hidden=\"true\"></i>)<br>Choose \"<strong>Copy Datasets</strong>\" option: <br><img src=\"/src/tutorials/nt_rnaseq/copy_datasets.png\"></td>\n<td><strong>B.</strong> Choose which datasets you need to copy:<br><img src=\"/src/tutorials/nt_rnaseq/copy_datasets2.png\"><br><strong>C.</strong> Click on the name of the newly created history:<br><img src=\"/src/tutorials/nt_rnaseq/datasets_copied.png\"></td>\n</tr>\n<tr>\n<td><small><strong>Copying datasets into a new history</strong></small></td>\n<td><small><strong>A</strong>: Use history options dropdown. <strong>B</strong>: Select datasets to copy and type a new for the new history (<code>Novel Transcripts (RNAseq)</code> in this case). <strong>C</strong>: Go to the new history by clicking on the link with its name.</small></td>\n</tr>\n</tbody>\n</table>\n<p>Once all datasets are copied it will look something like this:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/galaxy_after_copy.png\"></td>\n</tr>\n<tr>\n<td><small><strong>New history with copied datasets</strong></small></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"create-two-dataset-collections\"><a href=\"#create-two-dataset-collections\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Create two dataset collections</h2>\n<p>We will create two dataset collections: one containing data for G1E cells and the other for megakaryocytes (you may want to review features of Galaxy's history system explained in this <a href=\"/tutorials/histories\">tutorial</a>):</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/create_col_1.png\"></td>\n</tr>\n<tr>\n<td><small>Make history items selectable by clicking checkbox (<i class=\"far fa-check-square\" aria-hidden=\"true\"></i>) icon. This will allow individual datasets to be selected.</small></td>\n</tr>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/create_col_2.png\"></td>\n</tr>\n<tr>\n<td><small>Show only G1E data by typing <code>G1E</code> in the search box.</small></td>\n</tr>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/create_col_3.png\"></td>\n</tr>\n<tr>\n<td><small>Select all shown datasets by clicking <code>All</code>.</small></td>\n</tr>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/create_col_4.png\"></td>\n</tr>\n</tbody>\n</table>\n<p>|<small>Use <code>For all selected</code> dropdown and select option <code>Build List of Dataset Pairs</code> to start collection builder.</small>\n|<img src=\"/src/tutorials/nt_rnaseq/create_col_5.png\">|\n|<small>In the collection builder enter <code>_f_</code> and <code>_r_</code> in the two search boxes. Because datasets in out history are named as, for example, <code>G1E_R1_f_ds_SRR549355</code>, the <code>_f_</code> and <code>_r_</code> diffrentiate forward and reverse reads. Click <code>Pair these datasets</code> button.</small>|\n|<img src=\"/src/tutorials/nt_rnaseq/create_col_6.png\">|\n|<small>Datasets will become paired.</small>|\n|<img src=\"/src/tutorials/nt_rnaseq/create_col_7.png\">|\n|<small>Scroll down, name the collection <code>G1E</code> and click <code>Create list</code>.</small>\n|<img src=\"/src/tutorials/nt_rnaseq/create_col_8.png\">|\n|<small>You will get a new item in the history representing that collectio.n</small>|\n|<img src=\"/src/tutorials/nt_rnaseq/create_col_9.png\">|\n|<small>Repeat these steps for Megakarycytes datasets and you should get a history that looks like the one above.</small></p>\n<h1 id=\"pre-processing-mapping-and-post-processing\"><a href=\"#pre-processing-mapping-and-post-processing\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Pre-processing, mapping, and post-processing</h1>\n<p>Here we will trim all reads in our dataset, map them, and filter mapped data.</p>\n<h2 id=\"pre-processing-trimming-all-datasets\"><a href=\"#pre-processing-trimming-all-datasets\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Pre-processing: Trimming all datasets</h2>\n<p>Now that we have collections let's use <code>Trimmomatic</code> to trim all datasets in our analysis at once. We can do this directly on collections:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/trim_col.png\"></td>\n</tr>\n<tr>\n<td><small><strong>Trimming an entire collection</strong>. Note that <code>Single-end or paired-end reads?</code> is set to <code>Paired-end (as collection)</code>. This allows select collections (such <code>G1E</code>) as inputs.</small></td>\n</tr>\n</tbody>\n</table>\n<div class=\"alert alert-warning\" role=\"alert\"><i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i> Repeat this on `Mk` collection as well.</div>\n<p>This should be repeated for <code>Mk</code> collection as well (do it on your own). Note that <code>Trimmomatic</code> produces two output collection: one contained paired reads (labeled as <code>paired</code>; the one we want) and the one containing singletons (labeled as <code>unpaired</code>; the one we do not want in this case). We can simply delete collections that have <code>unpaired</code> in their names.\nIt will be easier down the line if we rename collections to make easier to identify as analysis is progressing (collection tagging, which is currently in development, will alleviate this need in the near future). To rename a collection:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/col_rename1.png\"></td>\n<td><img src=\"/src/tutorials/nt_rnaseq/col_rename2.png\"></td>\n</tr>\n<tr>\n<td>Click on collection to see this interface</td>\n<td>Simply edit its name (from <code>Trimmomatic on collection...</code> to <code>G1E Trimmed</code> and hit Enter</td>\n</tr>\n</tbody>\n</table>\n<p>To make sense of the reads, their positions within mouse genome must be determined. This process is known as aligning or 'mapping' the reads to the reference genome. In the case of a eukaryotic transcriptome, most reads originate from processed mRNAs lacking introns. Therefore, they cannot be simply mapped back to the genome as we normally do for reads derived from DNA sequences. Instead, the reads must be separated into two categories:</p>\n<ul>\n<li>Reads contained within mature exons - these align perfectly to the reference genome</li>\n<li>Reads that span splice junctions in the mature mRNA - these align with gaps to the reference genome</li>\n</ul>\n<p>Spliced mappers have been developed to efficiently map transcript-derived reads against genomes. <a href=\"https://ccb.jhu.edu/software/HISAT2/index.shtml\" target=\"_blank\" rel=\"noopener noreferrer\"><code>HISAT</code></a> is an accurate and fast tool for mapping spliced reads to a genome. Another popular spliced aligner is <a href=\"https://ccb.jhu.edu/software/tophat/index.shtml\" target=\"_blank\" rel=\"noopener noreferrer\"><code>TopHat</code></a>, but we will be using <code>HISAT</code> in this tutorial. For more details on these tools see our introductory <a href=\"/tutorials/rb-rnaseq/\">RNAseq tutorial</a>. </p>\n<h2 id=\"spliced-mapping-with-hisat\"><a href=\"#spliced-mapping-with-hisat\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Spliced mapping with HISAT</h2>\n<p>We will run HISAT with the following settings:</p>\n<ul>\n<li><strong>Single end or paired reads?</strong>: <code>Collection of paired reads</code></li>\n<li><strong>Source for the reference genome to align against</strong>: <code>Use a built-in genome</code> > <code>Mouse (Mus Musculus): mm10</code></li>\n<li><strong>Spliced alignment parameters</strong>: <code>Specify spliced alignment parameters</code></li>\n<li><strong>Specify strand-specific information</strong>: <code>First Strand (R/RF)</code></li>\n<li><strong>Transcriptome assembly reporting</strong>: <code>Report alignments tailored for transcript assemblers including StringTie.</code></li>\n</ul>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/hisat1.png\"></td>\n</tr>\n<tr>\n<td><small><strong>HISAT settings</strong>. Upper part of HISAT interface showing that it is being run on a collection <code>G1E</code> against <code>mm10</code> genome build. Do not forget to scroll down and set <strong>Spliced alignment parameters</strong> as explained above.</small></td>\n</tr>\n</tbody>\n</table>\n<div class=\"alert alert-warning\" role=\"alert\"><i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i> Run `HISAT` on the **Mk** collection as well.  Rename collections generated by `HISAT` as `HISAT on G1E` and `HISAT on Mk`, respectively.</div>\n<h2 id=\"post-processing-cleaning-the-bam\"><a href=\"#post-processing-cleaning-the-bam\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Post-processing: cleaning the BAM</h2>\n<p>After reads have been mapped it would make sense to restrict mapped reads to those than map in correct pairs and do not map to multiple locations. This can be done with <strong>SAMools -> Filter SAM or BAM</strong> tool:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/filter_bam.png\"></td>\n</tr>\n</tbody>\n</table>\n<p>|<small><strong>BAMTools Filter</strong>. Here we are filtering results of HISAT run (a dataset collection called <code>HISAT on G1E</code>) by retaining only reads with high <a href=\"http://genome.sph.umich.edu/wiki/Mapping_Quality_Scores\" target=\"_blank\" rel=\"noopener noreferrer\">mapping quality</a> that are paired and mapped in a proper pair.</small></p>\n<div class=\"alert alert-warning\" role=\"alert\"><i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i> Repeat this on `HISAT on Mk` collection as well. Rename results as shown below.</div>\n<p>We will again rename collections to <code>HISAT on G1E filtered</code> and <code>HISAT on Mk filtered</code>:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/filtered_collection.png\"></td>\n</tr>\n<tr>\n<td><small><strong>HISAT results after filtering</strong>. Keeping names clear is important for smooth sailing!</small></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"de-novo-transcript-reconstruction\"><a href=\"#de-novo-transcript-reconstruction\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a><em>De novo</em> transcript reconstruction</h1>\n<h2 id=\"assembling-transcripts-in-individual-sampled-with-stringtie\"><a href=\"#assembling-transcripts-in-individual-sampled-with-stringtie\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Assembling transcripts in individual sampled with Stringtie</h2>\n<p>Now that we have mapped our reads to the mouse genome with <code>HISAT</code>, we want to determine transcript structures that are represented by the aligned reads. This is called <em>de novo</em> transcriptome reconstruction. This unbiased approach permits the comprehensive identification of all transcripts present in a sample, including annotated genes, novel isoforms of annotated genes, and novel genes. While common gene/transcript databases are quite large, they are not comprehensive, and the <em>de novo</em> transcriptome reconstruction approach ensures complete transcriptome(s) identification from the experimental samples. The leading tool for transcript reconstruction is <code>Stringtie</code>. Here, we will use <code>Stringtie</code> to predict transcript structures based on the reads aligned by <code>HISAT</code> and filtered as described above:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/stringtie_col.png\"></td>\n</tr>\n</tbody>\n</table>\n<p>|<small>Running <code>Stringtie</code> on filtered mapped reads. Here it is run on collection <code>G1E</code> and we set <code>Name prefix for output transcripts</code> to <code>G1E</code>. When running <code>Stringtie</code> on collection <code>Mk</code> set this accordingly. </small></p>\n<div class=\"alert alert-warning\" role=\"alert\"><i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i> Run `Stringtie` on `HISAT on Mk filtered` collection as well. Rename output collections accordingly!</div>\n<p><code>Stringtie</code> generates assembled transcripts in <a href=\"https://ccb.jhu.edu/software/stringtie/index.shtml?t=manual#output\" target=\"_blank\" rel=\"noopener noreferrer\">GFF format</a>. Below is an example of its output:</p>\n<pre><code>chr1 StringTie transcript 160938184 160940158 1000 + . gene_id \"G1E.1\"; transcript_id \"G1E.1.1\"; cov \"12.347418\"; FPKM \"18.040417\"; TPM \"25.133554\";\nchr1 StringTie exon       160938184 160938232 1000 + . gene_id \"G1E.1\"; transcript_id \"G1E.1.1\"; exon_number \"1\"; cov \"7.510204\";\n</code></pre>\n<p>for description of fields in this dataset see <a href=\"https://ccb.jhu.edu/software/stringtie/index.shtml?t=manual#output\" target=\"_blank\" rel=\"noopener noreferrer\">Stringtie manual</a>.</p>\n<h2 id=\"creating-unified-transcriptome-assembly\"><a href=\"#creating-unified-transcriptome-assembly\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Creating unified transcriptome assembly</h2>\n<p>We just generated four transcriptomes with <code>Stringtie</code> representing each of the four RNA-seq libraries we are analyzing. Since these were generated in the absence of a reference transcriptome, and we ultimately would like to know what transcript structure corresponds to which annotated transcript (if any), we have to make a <strong>transcriptome database</strong>. We will use the tool <code>Stringtie merge</code> to combine redundant transcript structures across the four samples, provide non-redundant identifiers, and with the help of a reference annotation file annotate the nature/origin of each transcript (reference, novel isoform, intergenic transcript, antisense, etc.).</p>\n<p>However, since we have ran <code>Stringtie</code> on each collection (<code>G1E</code> and <code>Mk</code>) independently it, in turn, has produced two collections each containing transcript assemblies for each replicate. Before we run <code>Strigtie merge</code> we need to merge the collections. This is done using <strong>Collection Operations -> Merge Collections</strong> tool:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/merge_col.png\"></td>\n</tr>\n<tr>\n<td><small><strong>Merging collection</strong> into a single collection. This assumes that you have renamed collections produced by <code>Stringtie</code> as <code>Stringtie on G1E</code> and <code>Stringtie on Mk</code>.</small></td>\n</tr>\n</tbody>\n</table>\n<p>Now that the two collections are merged we will rename resulting collection <code>Transcriptome</code>. We are almost ready to run <code>Stringtie merge</code> on it. But in order to distinguish between novel and existing transcripts we will need provide <code>Stringtie merge</code> with a list of known annotated transcripts. For mouse genome version used in this tutorial (<code>mm10</code>) such a list can be downloaded from a <a href=\"https://usegalaxy.org/library/list#folders/F59bc5dbe6dfc6d4c\" target=\"_blank\" rel=\"noopener noreferrer\">Galaxy Library</a> as was <a href=\"/tutorials/nt_rnaseq/#how-to-upload-the-data-into-galaxy\">described above</a>. Now we can finally run <code>Stringtie merge</code>:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/stringtie_merge.png\"></td>\n</tr>\n<tr>\n<td><small><strong>Merging transcripts</strong> from <code>G1E</code> and <code>Mk</code> replicates into a single unified GFF dataset.</small></td>\n</tr>\n</tbody>\n</table>\n<p>We will rename output of <code>Stringtie merge</code> as <code>Merged transcriptome</code>.</p>\n<h1 id=\"analysis-of-the-differential-gene-expression\"><a href=\"#analysis-of-the-differential-gene-expression\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Analysis of the differential gene expression</h1>\n<p>We just generated a transcriptome database (a GFF output of <code>Stringtie merge</code>) that represents the transcripts present in the G1E and megakaryocytes samples. This database provides the location of our transcripts with non-redundant identifiers, as well as information regarding the origin of the transcript. </p>\n<p>We now want to identify which transcripts are differentially expressed between the G1E and megakaryocyte cellular states. To do this we will implement a counting approach using <code>FeatureCounts</code> to count reads per transcript. Then we will provide this information to <code>DESeq2</code> to generate normalized transcript counts (abundance estimates) and significance testing for differential expression.</p>\n<h2 id=\"count-the-number-of-reads-per-transcript\"><a href=\"#count-the-number-of-reads-per-transcript\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Count the number of reads per transcript</h2>\n<p>To compare the abundance of transcripts between different cellular states, the first essential step is to quantify the number of reads per transcript. <a href=\"http://bioinf.wehi.edu.au/featureCounts/\" target=\"_blank\" rel=\"noopener noreferrer\"><code>FeatureCounts</code></a> is one of the most popular tools for counting reads in genomic features. In our case, we'll be using <strong>NGS: RNA Analysis -> FeatureCounts</strong> to count reads aligning in exons of our <code>Stringtie merge</code> generated transcriptome database.</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/fCount1.png\"></td>\n</tr>\n<tr>\n<td><small>Set input collection. In this case this is filtered <code>HISAT</code> output for <code>G1E</code> replicates (You will have to repeat <code>featureCount</code> calculation on <code>Mk</code> collection as well.)</small></td>\n</tr>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/fCount2.png\"></td>\n</tr>\n<tr>\n<td><small>Expand <strong>Options for paired-end reads</strong>, enable <strong>Count fragments instead of reads</strong> and set <strong>Orientation of the two read from the same pair</strong> to <code>Reverse, Forward (rf)</code>.</small></td>\n</tr>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/fCount3.png\"></td>\n</tr>\n<tr>\n<td><small>Finally expand <strong>Advanced options</strong>, set <strong>GFF gene identifier</strong> to <code>transcript_id</code>, Strand specificity of the protocol to <code>Stranded (reverse)</code> and hit Enter.</small></td>\n</tr>\n</tbody>\n</table>\n<div class=\"alert alert-warning\" role=\"alert\"><i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i> Do not forget to run `featureCounts` on `HISAT on Mk filtered` collection as well. Rename output collections as shown below.</div>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/fCount5.png\"></td>\n</tr>\n<tr>\n<td><small><strong>Rename collection</strong> generated by <code>featureCount</code> as <code>featureCounts on G1E</code> and <code>featureCounts on Mk</code>.</small></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"perform-differential-gene-expression-testing\"><a href=\"#perform-differential-gene-expression-testing\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Perform differential gene expression testing</h2>\n<p>Transcript expression is estimated from read counts, and attempts are made to correct for variability in measurements using replicates. This is absolutely essential to obtaining accurate results. We recommend having at least two biological replicates (although you should <em>really</em> have three or even more). </p>\n<p><a href=\"https://bioconductor.org/packages/release/bioc/html/DESeq2.html\" target=\"_blank\" rel=\"noopener noreferrer\"><code>DESeq2</code></a> is a proven and widely used tool for differential gene expression analysis. It takes read counts produced by <code>FeatureCounts</code> and applies size factor normalization:</p>\n<ul>\n<li>Computation for each gene of the geometric mean of read counts across all samples</li>\n<li>Division of every gene count by the geometric mean</li>\n<li>Use of the median of these ratios as sample's size factor for normalization</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/deseq.png\"></td>\n</tr>\n</tbody>\n</table>\n<p>|<small><strong>Running <code>DeSeq2</code></strong> on <code>G1E</code> and <code>Mk</code> counts. Note how Factor Levels are set. <strong>Output normalized counts table</strong> parameter is set to <code>Yes</code>.</small></p>\n<p>The first output of <code>DESeq2</code> is a tabular file. That looks like this (only three decimal points are shown):</p>\n<pre><code>1            2       3        4     5      6         7\n--------------------------------------------------------------\nMSTRG.977.1  697.447 -10.030  1.062 -9.444 3.583e-21 1.974e-18\nMSTRG.78.1   645.022  10.656  1.195  8.915 4.873e-19 1.342e-16\nMSTRG.129.1  368.102  -8.846  1.055 -8.379 5.328e-17 9.787e-15\nMSTRG.1498.1 252.670   6.152  0.815  7.544 4.556e-14 6.277e-12\nMSTRG.1434.1 372.478   4.855  0.666  7.288 3.125e-13 3.444e-11\nNM_133804    257.129 -10.262  1.509 -6.798 1.060e-11 9.737e-10\n</code></pre>\n<p>where:</p>\n<ol>\n<li>Gene identifiers</li>\n<li>Mean normalized counts, averaged over all samples from both conditions</li>\n<li>log<sub>2</sub> of the fold change (the values correspond to up- or downregulation relative to the condition listed as Factor level 1)</li>\n<li>Standard error estimate for the log2 fold change estimate</li>\n<li><a href=\"https://en.wikipedia.org/wiki/Wald_test\" target=\"_blank\" rel=\"noopener noreferrer\">Wald</a> statistic</li>\n<li><em>p</em>-value for the statistical significance of this change</li>\n<li><em>p</em>-value adjusted for multiple testing with the Benjamini-Hochberg procedure which controls false discovery rate (<a href=\"https://en.wikipedia.org/wiki/False_discovery_rate\" target=\"_blank\" rel=\"noopener noreferrer\">FDR</a>)</li>\n</ol>\n<h2 id=\"making-sense-of-the-results\"><a href=\"#making-sense-of-the-results\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Making sense of the results</h2>\n<p>The output of <code>DeSeq2</code> contain over 35,000 rows. Let's select transcripts with the most significant expression differences. For this we will filter <code>DeSeq2</code> output on adjusted <em>p</em>-value using <strong>Filter and Sort -> Filter</strong> tool:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/deseq_filter.png\"></td>\n</tr>\n<tr>\n<td><small><strong>Filtering</strong> to retain only genes with adjusted <em>p</em>-value above <code>0.05</code>.</small></td>\n</tr>\n</tbody>\n</table>\n<p>This retains 128 transcripts. You can see that in some cases log<sub>2</sub> fold change is positive and in some cases it is negative. To give you an idea on what this means let's look at normalized counts for genes with negative and positive change. One way to do this is to join the dataset we have just generated with <strong>Filter</strong> tool with normalized counts generated by <code>DeSeq2</code>. For this we will use <strong>Join, Subtract and Group -> Join two Datasets</strong> tool:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/norm_count_join.png\"></td>\n</tr>\n<tr>\n<td><small><strong>Joining</strong> filtered <code>DeSeq2</code> output with normalized counts.</small></td>\n</tr>\n</tbody>\n</table>\n<p>Let's look at two first entries:</p>\n<pre><code>Last four columns are normalized counts for:                    Mk_1     Mk_2     G1E_1    G1E_2\n--------------------------------------------------------------------------------------------------\nMSTRG.977.1  697.447 -10.030  1.062 -9.444 3.583e-21 1.974e-18  2081.714 706.074    1.665    0.333\nMSTRG.78.1   645.022  10.656  1.195  8.915 4.873e-19 1.342e-160    0.000   0.000 1311.325 1268.763\n</code></pre>\n<p>The last four columns are normalized reads counts for two megakarycyte and two G1E replicates, respectively. You can see that for <code>MSTRG.977.1</code>  log<sub>2</sub> fold change is <code>-10.030</code> and there are practically no G1E reads. Conversely, in the case of <code>MSTRG.78.1</code> log<sub>2</sub> fold change is <code>10.656</code> and there are no megakaryocyte reads. This is this case because we set <code>G1E</code> as the Factor level 1 while running <code>DeSeq2</code> and positive change implies <em>downregulation</em> in megakaryocytes compared to G1E cells and vice versa. So to find all genes upregulated in Mk, for example, one would need to filter <code>DeSeq2</code> output for fold change below 0. </p>\n<div class=\"panel panel-info\">\n\t<div class=\"panel-heading\">\n  \t\t<a data-toggle=\"collapse\" href=\"#upreg\" aria-expanded=\"false\" aria-controls=\"collapseExample\">\n     \t\t<i class=\"fa fa-question-circle\" aria-hidden=\"true\"></i> How many transcripts are upregulated in megakaryocytes at 1% significance level?\n    \t</a>\n  \t</div>\n  \t<div class=\"panel-body collapse\" id=\"upreg\">\n        - Filter `DeSeq2` output using `c3 < 0 and c7 < 0.01` expression.<br>\n        - There will be around 40 genes.\n  \t</div>\n</div>\n<p>In addition to the list of genes, <code>DESeq2</code> outputs a graphical summary of the results, useful to evaluate the quality of the experiment:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/deseq_hist.png\"></td>\n</tr>\n<tr>\n<td><small>Histogram of <em>p</em>-values for all tests.</small></td>\n</tr>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/deseq_ma.png\"></td>\n</tr>\n<tr>\n<td><small><a href=\"https://en.wikipedia.org/wiki/MA_plot\" target=\"_blank\" rel=\"noopener noreferrer\">MA plot</a>: global view of the relationship between the expression change of conditions (log ratios, M), the average expression strength of the genes (average mean, A), and the ability of the algorithm to detect differential gene expression. The genes that passed the significance threshold (adjusted p-value &#x3C; 0.1) are colored in red.</small></td>\n</tr>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/deseq_pca.png\"></td>\n</tr>\n<tr>\n<td><small>Principal Component Analysis (<a href=\"https://en.wikipedia.org/wiki/Principal_component_analysis\" target=\"_blank\" rel=\"noopener noreferrer\">PCA</a>) and the first two axes. Each replicate is plotted as an individual data point. This type of plot is useful for visualizing the overall effect of experimental covariates and batch effects.</small></td>\n</tr>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/deseq_samp_to_samp.png\"></td>\n</tr>\n<tr>\n<td><small>Heatmap of sample-to-sample distance matrix: overview over similarities and dissimilarities between samples.</small></td>\n</tr>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/deseq_disp.png\"></td>\n</tr>\n<tr>\n<td><small>Dispersion estimates: gene-wise estimates (black), the fitted values (red), and the final maximum a posteriori estimates used in testing (blue). This dispersion plot is typical, with the final estimates shrunk from the gene-wise estimates towards the fitted estimates. Some gene-wise estimates are flagged as outliers and not shrunk towards the fitted value. The amount of shrinkage can be more or less than seen here, depending on the sample size, the number of coefficients, the row mean and the variability of the gene-wise estimates.</small></td>\n</tr>\n</tbody>\n</table>\n<p>For more information about <code>DESeq2</code> and its outputs, you can have a look at <a href=\"https://www.bioconductor.org/packages/release/bioc/manuals/DESeq2/man/DESeq2.pdf\" target=\"_blank\" rel=\"noopener noreferrer\"><code>DESeq2</code> documentation</a>.</p>\n<h1 id=\"visualization\"><a href=\"#visualization\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Visualization</h1>\n<p>Now that we have a list of transcript expression levels and their differential expression levels, it is time to visually inspect our transcript structures and the reads they were predicted from. It is a good practice to visually inspect (and present) loci with transcripts of interest. As we've seen above, Galaxy integrates well with the IGV browser.</p>\n<h2 id=\"prepare-bam-files\"><a href=\"#prepare-bam-files\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Prepare BAM files</h2>\n<p>When looking at results it will helpful to see read coverage at the regions of interest. But we have four datasets corresponding to four replicates and in your own experiment there may be even more datasets. So let's first merge all HISAT BAM outputs into a single BAM file. However, to keep the relationship between individual reads and samples we need to add <a href=\"/tutorials/ngs/#read-groups\">readgroup tags</a> to each BAM file before merging. For this we will use a combination of tools:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/merge_hisat_col.png\"></td>\n</tr>\n<tr>\n<td><small><strong>First</strong>, merge filtered <code>HISAT</code> outputs into a single collection. This is done using <strong>Collection Operations -> Merge Collections</strong> tool. Rename this collection <code>HISAT merged</code>.</small></td>\n</tr>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/addRG.png\"></td>\n</tr>\n<tr>\n<td><small><strong>Second</strong>, use <strong>NGS: Picard -> AddOrReplaceReadGroup</strong> to add readgroups as shown above. This will automatically set readgroups based on dataset names.</small></td>\n</tr>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/mergeBAM.png\"></td>\n</tr>\n<tr>\n<td><small><strong>Finally</strong>, use  <strong>NGS: Picard -> MergeSamFiles</strong> to collapse the entire collection you've just produced at the previous step into a single BAM dataset. Name this dataset <code>HISAT single BAM</code>. We will use this dataset for visualization.</small></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"starting-and-using-igv\"><a href=\"#starting-and-using-igv\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Starting and using IGV</h2>\n<p>To start IGV expand the merged dataset we have just generated:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/startIGV.png\"></td>\n</tr>\n<tr>\n<td><small>Click on <code>Mouse mm10</code> link (on Linux systems you may need to install IGV separately and use <code>local</code> link). This action will download and start IGV.</small></td>\n</tr>\n</tbody>\n</table>\n<p>After IGV has started we will add to GTF files containing merged transcripts (the one produced <a href=\"/tutorials/nt_rnaseq/#creating-unified-transcriptome-assembly\">here</a>):</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/gffToIgv.png\"></td>\n</tr>\n</tbody>\n</table>\n<p>|<small>To display GFF with merged transcripts click on <code>local</code> IGV link.</small></p>\n<p>Finally, direct IGV to the locus of interest by typing <code>MSTRG.78.1</code> in the IGV's location box. <code>MSTRG.78.1</code> is novel transcript which significantly overexpressed in G1E according to <a href=\"/tutorials/nt_rnaseq/#making-sense-of-the-results\">our <code>DeSeq2</code> analysis</a>:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img src=\"/src/tutorials/nt_rnaseq/igv1.png\"></td>\n</tr>\n</tbody>\n</table>\n<p>|<small>IGV view of the <code>MSTRG.78.1</code> locus.</small>\n|<img src=\"/src/tutorials/nt_rnaseq/igv2.png\">|\n|<small>Grouping and coloring alignments by readgroup will show that only <code>G1E</code> replicates contain any read data.</small></p>\n<h1 id=\"conclusion\"><a href=\"#conclusion\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Conclusion</h1>\n<p>In this tutorial, we have analyzed real RNA sequencing data to extract useful information, such as which genes are up- or down-regulated by depletion of the Pasilla gene and which genes are regulated by the Pasilla gene. To answer these questions, we analyzed RNA sequence datasets using a reference-based RNA-seq data analysis approach. This approach can be sum up with the following scheme:</p>\n<p><img src=\"/src/tutorials/nt_rnaseq/schematic_for_RNAseq_de_novo_tutorial.png\"></p>\n"}},"context":{}}