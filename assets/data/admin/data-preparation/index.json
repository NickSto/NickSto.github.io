{"hash":"8532f9dede357a757ee182f7a5f5306dccf4d8d2","data":{"article":{"id":"11d4f6900c2dba39ce10cefe7d2c2e3c","title":"","tease":"","image":"","images":{},"category":null,"contact":"","date":null,"content":"<h1 id=\"data-preparation\"><a href=\"#data-preparation\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Data Preparation</h1>\n<p><strong>Please note that \"built-in\" or \"cached\" data can now be managed directly from within the Galaxy admin interface. For details, see <a href=\"/admin/tools/data-managers/\">Data Managers Overview</a></strong> and our <strong><a href=\"https://github.com/galaxyproject/dagobah-training/blob/2017-montpellier/sessions/05-reference-genomes/ex1-reference-genomes.md\" target=\"_blank\" rel=\"noopener noreferrer\">Data Managers Tutorial</a></strong>.</p>\n<p><strong>NOTE: Be aware that that as of early 2014, builds are incorporated into the Galaxy schema in tables. <a href=\"/admin/tools/data-managers/\">Data Managers</a> are recommended to index new genomes (these are found in the <a href=\"/toolshed/\">ToolShed</a>. <em>This wiki is considered legacy and provided as a reference.</em></strong></p>\n<h1 id=\"builds-list-changes\"><a href=\"#builds-list-changes\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Builds list changes</h1>\n<p>If you still choose to do this manually, follow the instructions at <a href=\"/admin/data-integration/\">Data Integration</a> to start, (<strong>impact</strong>: more than just a builds.txt file is needed to establish a new reference genome), making certain that your server has the necessary changes/additions to the <a href=\"/admin/tools/Data%20Tables.md\">Data Tables</a> model or use the alternate configuration file, then follow the guide here for the organization and execution of <strong>data preparation</strong> tasks in a local or cloud instance.</p>\n<h1 id=\"data-and-indexes-hosted-at-httpusegalaxyorg\"><a href=\"#data-and-indexes-hosted-at-httpusegalaxyorg\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Data and indexes hosted at <a href=\"http://usegalaxy.org\" target=\"_blank\" rel=\"noopener noreferrer\">http://usegalaxy.org</a></h1>\n<p>Using the Galaxy team's version of reference genomes and indexes can often be a good strategy for those working with both a local and the public <strong><a href=\"/main/\">Main</a></strong> instance. All options are described here <a href=\"http://datacache.galaxyproject.org/\" target=\"_blank\" rel=\"noopener noreferrer\">http://datacache.galaxyproject.org/</a>. More details about the rsync server and the contents is at <strong><a href=\"/admin/use-galaxy-rsync/\">Usegalaxy.org Rsync</a></strong>.</p>\n<h2 id=\"whats-in-this-wiki-\"><a href=\"#whats-in-this-wiki-\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>What's in this wiki ?</h2>\n<p><strong>This wiki shows you how to organize, index, and link in your local built-in data for the most commonly used tools.</strong>\nGalaxy's web tool forms are each a web-accessible input wrapper that interacts with one or more underlying tools. Many require that reference data be indexed in a specific way as an one of the inputs, whether specifically selected on the form by the user or interpreted from the other input's metadata (specifically, the \"database\" attribute, or <strong>dbkey</strong>).</p>\n<p>Although a reference genome can be used from the history with most tools (see <a href=\"/learn/custom-genomes/\">Custom Genomes</a>), this is a resource intensive process, and local built-in indexes mean quicker job execution and reduced server load.</p>\n<p>The link between a tool and built-in data is a configurable <code>\".loc\"</code> file.</p>\n<h2 id=\"setting-up-tools-and-reference-data\"><a href=\"#setting-up-tools-and-reference-data\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Setting up Tools and Reference Data</h2>\n<h4 id=\"1-determine-the-tools-versions-needed-the-source-and-any-dependencies\"><a href=\"#1-determine-the-tools-versions-needed-the-source-and-any-dependencies\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>1. Determine the tools versions needed, the source, and any dependencies.</h4>\n<h4 id=\"2-decide-how-you-will-organize-your-tools\"><a href=\"#2-decide-how-you-will-organize-your-tools\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>2. Decide how you will organize your tools.</h4>\n<h4 id=\"3-install-tools\"><a href=\"#3-install-tools\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>3. Install tools.</h4>\n<h4 id=\"4-decide-how-you-will-organize-your-data\"><a href=\"#4-decide-how-you-will-organize-your-data\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>4. Decide how you will organize your data.</h4>\n<h4 id=\"5-install-data\"><a href=\"#5-install-data\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>5. Install data.</h4>\n<h4 id=\"6-restart-your-server\"><a href=\"#6-restart-your-server\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>6. Restart your server!</h4>\n<h4 id=\"7-repeat-3-5-6-as-needed\"><a href=\"#7-repeat-3-5-6-as-needed\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>7. Repeat 3, 5, 6 as needed.</h4>\n<hr>\n<h2 id=\"tips-for-installing-tools\"><a href=\"#tips-for-installing-tools\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Tips for Installing Tools</h2>\n<p>The how-to is below, but this section gives a quick overview by tool or tool group.</p>\n<h4 id=\"general\"><a href=\"#general\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>General</h4>\n<p>For tools from the \"Fastx Toolkit\", go to the <a href=\"http://hannonlab.cshl.edu/fastx_toolkit\" target=\"_blank\" rel=\"noopener noreferrer\">http://hannonlab.cshl.edu/fastx_toolkit</a> web site for the current download and instructions.</p>\n<p>Two other common dependencies are \"rpy\" (a Python library) and \"R\". Start with rpy first. Check if R was built with the <code>--enable-R-shlib</code> option if you run into problems (unlikely, this is default in pre-compiled binaries). Go to <a href=\"http://rpy.sourceforge.net\" target=\"_blank\" rel=\"noopener noreferrer\">http://rpy.sourceforge.net</a> and <a href=\"http://www.r-project.org\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.r-project.org</a> for the current download and instructions.</p>\n<h4 id=\"bowtiebowtie2-installation\"><a href=\"#bowtiebowtie2-installation\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Bowtie/Bowtie2 installation</h4>\n<p>To install Bowtie and/or Bowtie2, go to the <a href=\"http://bowtie-bio.sourceforge.net/index.shtml\" target=\"_blank\" rel=\"noopener noreferrer\">http://bowtie-bio.sourceforge.net/index.shtml</a> or <a href=\"http://sourceforge.net/projects/bowtie-bio/files/bowtie2\" target=\"_blank\" rel=\"noopener noreferrer\">http://sourceforge.net/projects/bowtie-bio/files/bowtie2</a>. Download (source or binary) and follow the instructions per tool.</p>\n<h4 id=\"bwa-installation\"><a href=\"#bwa-installation\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>BWA installation</h4>\n<p>To install BWA, download the source from <a href=\"http://bio-bwa.sourceforge.net\" target=\"_blank\" rel=\"noopener noreferrer\">http://bio-bwa.sourceforge.net</a>. To install, open the archive and run <code>make</code> in the new BWA directory.</p>\n<h4 id=\"lastz-installation\"><a href=\"#lastz-installation\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>LASTZ installation</h4>\n<p>LASTZ is downloaded from <a href=\"http://www.bx.psu.edu/miller_lab/dist\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.bx.psu.edu/miller_lab/dist</a> (e.g. <code>lastz-X.0n.m.tar.gz</code>). Installation help is at <a href=\"http://www.bx.psu.edu/miller_lab/dist/README.lastz-X.0X.X0/README.lastz-X.0X.X0.html\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.bx.psu.edu/miller_lab/dist/README.lastz-X.0X.X0/README.lastz-X.0X.X0.html</a>.</p>\n<h4 id=\"extract-genomic-dna-installation\"><a href=\"#extract-genomic-dna-installation\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Extract Genomic DNA installation</h4>\n<p>The Extract tool is downloaded from <a href=\"http://genome.ucsc.edu\" target=\"_blank\" rel=\"noopener noreferrer\">http://genome.ucsc.edu</a>. It uses the same reference index as LASTZ and the instructions for the data prep is merged below.</p>\n<h4 id=\"megablast-installation\"><a href=\"#megablast-installation\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Megablast installation</h4>\n<p>Megablast in Galaxy was updated to use <a href=\"http://blast.ncbi.nlm.nih.gov\" target=\"_blank\" rel=\"noopener noreferrer\">NCBI BLAST+</a> (<code>BLASTN</code>) in April 2012 (changeset <a href=\"https://bitbucket.org/galaxy/galaxy-central/changeset/0b5cb60e4810#chg-tools/metag_tools/megablast_wrapper.xml\" target=\"_blank\" rel=\"noopener noreferrer\">0b5cb60e4810</a>). See <a href=\"/admin/tools/ToolDependencies/\">dependencies wiki</a> for current version then <a href=\"http://blast.ncbi.nlm.nih.gov/Blast.cgi?CMD=Web%5C&#x26;PAGE_TYPE=BlastDocs%5C&#x26;DOC_TYPE=Download\" target=\"_blank\" rel=\"noopener noreferrer\">download blast+</a>. Many data indexes are available directly at NCBI from <a href=\"ftp://ftp.ncbi.nlm.nih.gov/blast/db/\" target=\"_blank\" rel=\"noopener noreferrer\">ftp://ftp.ncbi.nlm.nih.gov/blast/db/</a></p>\n<h4 id=\"picardsrma-installation\"><a href=\"#picardsrma-installation\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Picard/SRMA installation</h4>\n<p>SRMA is a Java program that relies on Picard, a Java implementation of C Samtools. SRMA is available from the <a href=\"https://sourceforge.net/projects/srma/files/\" target=\"_blank\" rel=\"noopener noreferrer\">Sourceforge SRMA project</a>. The SRMA jar file should be named <code>srma.jar</code> and placed in <code>$GALAXY_PATH/tool-data/shared/jars</code>. If you want to compile SRMA from source, you will also need to install Picard (<a href=\"http://sourceforge.net/projects/picard/files/\" target=\"_blank\" rel=\"noopener noreferrer\">Sourceforge Picard project</a>) and extract it into the lib directory of the SRMA directory. You can get more info on SRMA from <a href=\"http://sourceforge.net/apps/mediawiki/srma/index.php?title=Main_Page\" target=\"_blank\" rel=\"noopener noreferrer\">its wiki</a>.</p>\n<p>(Note that there also is a C version of SRMA, but the Galaxy team does not use it as of the last page edit.)</p>\n<h3 id=\"ngs-sam-tools\"><a href=\"#ngs-sam-tools\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>NGS: SAM Tools</h3>\n<p>SAM Tools is highly recommended, if not actually considered required, for every local instance running any other tools in the \"NGS:\" tool groups. SAM Tools is available at <a href=\"http://samtools.sourceforge.net\" target=\"_blank\" rel=\"noopener noreferrer\">http://samtools.sourceforge.net</a>. To install: unpack the archive in a new <code>/samtools</code> directory and then run <code>make</code>.</p>\n<hr>\n<h2 id=\"setting-up-the-reference-genomes-for-ngs-tools\"><a href=\"#setting-up-the-reference-genomes-for-ngs-tools\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Setting Up the Reference Genomes for NGS Tools</h2>\n<p>There are three key steps:</p>\n<ol>\n<li>Obtain the data</li>\n<li>Index or prepare it</li>\n<li>Modify the associate .loc file (this tells Galaxy how to find/use it)</li>\n</ol>\n<h3 id=\"build-names\"><a href=\"#build-names\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Build Names</h3>\n<p>Build names need to exactly match existing build names in <code>$GALAXY_PATH/tool-data/shared/ucsc/builds.txt</code>. Each is unique.</p>\n<h3 id=\"tools-and-their-corresponding-loc-files\"><a href=\"#tools-and-their-corresponding-loc-files\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Tools and Their Corresponding loc Files</h3>\n<p>The following table shows the name of the loc file associated with each tool.</p>\n<table>\n  <tr>\n    <th> Tool      </th>\n    <th> XML File                                                    </th>\n    <th> loc File                                       </th>\n  </tr>\n  <tr>\n    <td> Bowtie, Tophat     </td>\n    <td> $GALAXY_PATH/tools/sr_mapping/bowtie_wrapper.xml             </td>\n    <td> $GALAXY_PATH/tool-data/bowtie_indices.loc       </td>\n  </tr>\n  <tr>\n    <td> </td>\n    <td> $GALAXY_PATH/tools/sr_mapping/bowtie_wrapper_color.xml       </td>\n    <td> $GALAXY_PATH/tool-data/bowtie_indices_color.loc </td>\n  </tr>\n  <tr>\n    <td> Bowtie2, Tophat2     </td>\n    <td> $GALAXY_PATH/tools/sr_mapping/bowtie2_wrapper.xml             </td>\n    <td> $GALAXY_PATH/tool-data/bowtie2_indices.loc       </td>\n  </tr>\n  <tr>\n    <td> BWA        </td>\n    <td> $GALAXY_PATH/tools/sr_mapping/bwa_wrapper.xml                </td>\n    <td> $GALAXY_PATH/tool-data/bwa_index.loc            </td>\n  </tr>\n  <tr>\n    <td> SAM Tools  </td>\n    <td> $GALAXY_PATH/tools/samtools/sam_to_bam.xml                   </td>\n    <td> $GALAXY_PATH/tool-data/sam_fa_indices.loc       </td>\n  </tr>\n  <tr>\n    <td> </td>\n    <td> $GALAXY_PATH/tools/samtools/sam_merge.xml                    </td>\n    <td> $GALAXY_PATH/tool-data/sam_fa_indices.loc       </td>\n  </tr>\n  <tr>\n    <td> </td>\n    <td> $GALAXY_PATH/tools/samtools/sam_pileup.xml                   </td>\n    <td> $GALAXY_PATH/tool-data/sam_fa_indices.loc       </td>\n  </tr>\n  <tr>\n    <td> LASTZ      </td>\n    <td> $GALAXY_PATH/tools/sr_mapping/lastz_wrapper.xml              </td>\n    <td> $GALAXY_PATH/tool-data/lastz_seqs.loc           </td>\n  </tr>\n  <tr>\n    <td> </td>\n    <td> $GALAXY_PATH/tools/sr_mapping/lastz_paired_reads_wrapper.xml </td>\n    <td> $GALAXY_PATH/tool-data/lastz_seqs.loc           </td>\n  </tr>\n  <tr>\n    <td> Megablast  </td>\n    <td> $GALAXY_PATH/tools/metag_tools/megablast_wrapper.xml         </td>\n    <td> $GALAXY_PATH/tool-data/blastdb.loc              </td>\n  </tr>\n  <tr>\n    <td> SRMA       </td>\n    <td> $GALAXY_PATH/tools/sr_mapping/srma_wrapper.xml               </td>\n    <td> $GALAXY_PATH/tool-data/srma_index.loc           </td>\n  </tr>\n</table>\n<p>There is a sample file for each of these files, with <code>.sample</code> appended to the filename. This file explains the necessary format of the loc file.</p>\n<h3 id=\"organizing-index-files\"><a href=\"#organizing-index-files\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Organizing Index Files</h3>\n<p>The best way to organize the various index files is to have dedicated directories for each build that contains a directory for each NGS tool, which then contains the actual index files.</p>\n<p>A structure like this is recommended:</p>\n<pre><code>$BASE_PATH/\n    hg18/\n        bowtie_path/\n            base/\n                hg18.1.ebwt\n                hg18.2.ebwt\n                hg18.3.ebwt\n                hg18.4.ebwt\n                hg18.rev.1.ebwt\n                hg18.rev.2.ebwt\n            color/\n                hg18.1.ebwt\n                hg18.2.ebwt\n                hg18.3.ebwt\n                hg18.4.ebwt\n                hg18.rev.1.ebwt\n                hg18.rev.2.ebwt\n        bwa_path/\n            hg18.amb\n            hg18.ann\n            hg18.bwt\n            hg18.pac\n            hg18.rbwt\n            hg18.rpac\n            hg18.rsa\n            hg18.sa\n        sam_index/\n            hg18.fasta\n            hga8.fasta.fai\n</code></pre>\n<hr>\n<h3 id=\"bowtie-and-tophat\"><a href=\"#bowtie-and-tophat\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Bowtie and Tophat</h3>\n<h4 id=\"generating-indices\"><a href=\"#generating-indices\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Generating Indices</h4>\n<p>Instructions are for both Bowtie/Tophat and Bowtie2/Tophat2.</p>\n<p><em>Bowtie and Tophat use the same index set, and Bowtie2 and Tophat2 use the same index set, <strong>but</strong> Bowtie/Tophat and Bowtie2/Tophat2 <strong>do not</strong> use the same index set.</em></p>\n<p>Know what tools are you evoking and which indexes are being accessed by that tool based on the <code>.loc</code> file contents. If your tools are giving errors after a data update or at first usage, <em>review the wrapper and tool versions against the indexes used in the error message to verify!</em></p>\n<p>Have Bowtie and/or Bowtie2 installed and in your <code>$PATH</code>.\nAlso have Tophat and/or Tophat2 installed and in your <code>$PATH</code> so that you can test the tools on the command-line for simple installation checks or for use later on in Galaxy.</p>\n<p>Usage: <code>bowtie-build [option] index_basename.fa index_basename</code>\n(where <code>index_basename.fa</code> is your input reference genome in fasta format)</p>\n<p>The Galaxy team uses the <code>[option]</code> <strong>-f</strong> to create indexes, for example:</p>\n<pre><code>bowtie-build -f hg19.fa hg19\n</code></pre>\n<p>or</p>\n<pre><code>bowtie2-build -f hg19.fa hg19\n</code></pre>\n<p>The <code>[option]</code> <strong>-C</strong> would be used instead to create color indexes for Bowtie/Tophat. <em>Please note that Bowtie2/Tophat2 <a href=\"http://bowtie-bio.sourceforge.net/bowtie2/faq.shtml\" target=\"_blank\" rel=\"noopener noreferrer\">do not support colorspace reads</a>.</em> Confused? Type <code>bowtie-build</code> or <code>bowtie2-build</code> at the command prompt to view the usage and see the manual:\nBowtie: <a href=\"http://bowtie-bio.sourceforge.net/manual.shtml\" target=\"_blank\" rel=\"noopener noreferrer\">http://bowtie-bio.sourceforge.net/manual.shtml</a>\nBowtie2: <a href=\"http://bowtie-bio.sourceforge.net/bowtie2/manual.shtml\" target=\"_blank\" rel=\"noopener noreferrer\">http://bowtie-bio.sourceforge.net/bowtie2/manual.shtml</a></p>\n<p>Put Bowtie/Bowtie2 indexes and color/non-color indexes in <em>distinct directories</em>. That means up to <strong>*3</strong> distinct directories* for a full set per reference genome version. But you may only need <strong>1</strong> or <strong>2</strong>.</p>\n<p>The index files that will be created for Bowtie are:</p>\n<ul>\n<li><code>index_basename.1.ebwt</code></li>\n<li><code>index_basename.2.ebwt</code></li>\n<li><code>index_basename.3.ebwt</code></li>\n<li><code>index_basename.4.ebwt</code></li>\n<li><code>index_basename.rev.1.ebwt</code></li>\n<li><code>index_basename.rev.2.ebwt</code></li>\n</ul>\n<p>The index files that will be creates for Bowtie2 are:</p>\n<ul>\n<li><code>index_basename.1.bt2</code></li>\n<li><code>index_basename.2.bt2</code></li>\n<li><code>index_basename.3.bt2</code></li>\n<li><code>index_basename.4.bt2</code></li>\n<li><code>index_basename.rev.1.bt2</code></li>\n<li><code>index_basename.rev.2.bt2</code></li>\n</ul>\n<h4 id=\"setting-up-loc-files\"><a href=\"#setting-up-loc-files\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Setting Up loc Files</h4>\n<ul>\n<li>Know where the data is</li>\n<li>\n<p>Know where the <code>bowtie_index.loc</code>, <code>bowtie_index_color.loc</code>, and <code>bowtie2_index.loc</code> files comes from and where they should be placed to be used</p>\n<ul>\n<li>initially are named <code>/galaxy-dist/tool-data/bowtie_index.loc.sample</code>, (<code>/galaxy-dist/tool-data/bowtie_index_color.loc.sample</code>, and <code>/galaxy-dist/tool-data/bowtie2_index.loc.sample</code></li>\n<li>from the Tool Shed repository</li>\n<li>to your Galaxy instance</li>\n</ul>\n</li>\n<li>Follow instructions in sample file to add in rows for each database. One row per database.</li>\n<li>Remove the \".sample\" from the file name if this is the first time you are using it</li>\n<li>Remove any rows for databases that you no longer want to host if you are altering an existing .loc</li>\n<li>You can make sure the file was created correctly by restarting the server and opening up the Bowtie/Bowtie2, Bowtie_color, or Tophat/Tophat2 tool, and checking the dropdown menu of genomes. These tools are found in the tool groups <strong>NGS: Mapping</strong> and <strong>NGS: RNA Analysis</strong>, unless you custom installed them elsewhere.</li>\n<li>Test the new database(s) by running a few sequences that you expect to have hits with default parameters.</li>\n</ul>\n<h3 id=\"bwa\"><a href=\"#bwa\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>BWA</h3>\n<h4 id=\"generating-indices-1\"><a href=\"#generating-indices-1\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Generating Indices</h4>\n<p>Have BWA installed in your <code>$PATH</code>.</p>\n<p>Usage: <code>bwa index [options] &#x3C;reference_in></code></p>\n<p>The Galaxy team uses the option <code>-a bwtsw</code> to create indexes.</p>\n<p>The manual is here: <a href=\"http://bio-bwa.sourceforge.net/bwa.shtml\" target=\"_blank\" rel=\"noopener noreferrer\">BWA manual</a>.</p>\n<p>The following index files will be created for the FASTA file <code>name.fasta</code>:</p>\n<ul>\n<li><code>reference_in.fasta.amb</code></li>\n<li><code>reference_in.fasta.ann</code></li>\n<li><code>reference_in.fasta.bwt</code></li>\n<li><code>reference_in.fasta.pac</code></li>\n<li><code>reference_in.fasta.sa</code></li>\n</ul>\n<p>Note: that if using BWA version earlier than 5.10, you will also see the following <em>reverse</em> index files:</p>\n<ul>\n<li><code>reference_in.fasta.rbwt</code></li>\n<li><code>reference_in.fasta.rpac</code></li>\n<li><code>reference_in.fasta.rsa</code></li>\n</ul>\n<h4 id=\"setting-up-loc-file\"><a href=\"#setting-up-loc-file\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Setting Up loc File</h4>\n<ul>\n<li>Know where the data is</li>\n<li>\n<p>Know where the <code>bwa_index.loc</code> file comes from and where it should be placed to be used</p>\n<ul>\n<li>initially are named (<code>/galaxy-dist/tool-data/bwa_index.loc.sample</code> and (<code>/galaxy-dist/tool-data/bwa_index_color.loc.sample</code></li>\n<li>from the Tool Shed repository</li>\n<li>to your Galaxy instance</li>\n</ul>\n</li>\n<li>Follow instructions in sample file to add in rows for each database. One row per database.</li>\n<li>Remove the \".sample\" from the file name if this is the first time you are using it</li>\n<li>Remove any rows for databases that you no longer want to host if you are altering an existing .loc</li>\n<li>You can make sure the file was created correctly by restarting the server and opening up the BWA tool, and checking the dropdown menu of genomes.</li>\n<li>Test the new database(s) by running a few sequences that you expect to have hits with default parameters.</li>\n</ul>\n<h3 id=\"sam-tools\"><a href=\"#sam-tools\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>SAM Tools</h3>\n<h4 id=\"generating-indices-2\"><a href=\"#generating-indices-2\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Generating Indices</h4>\n<p>Have SAMTools installed in your <code>$PATH</code>.</p>\n<p>Usage: <code>samtools faidx &#x3C;ref.fasta> [region1 [...]]</code></p>\n<p>No special options are needed.</p>\n<p>The following index files will be created for the FASTA file <code>name.fasta</code>:</p>\n<ul>\n<li><code>ref.fasta.fai</code></li>\n</ul>\n<p>Place a relative symbolic link to the original FASTA file in the same location as the sam index (or the original file), making sure the original FASTA file can be read by the Galaxy user. The Galaxy team uses a symbolic link to both organize files (placing the FASTA in a distinct directory) and to reduce data duplication. Creating a structure like:</p>\n<pre><code>/ref/bowtie\n/ref/bwa\n/ref/sam/ref.fasta (relative symbolic link to ../seq/database.fasta)\n/ref/sam/ref.fasta.fai\n/ref/seq/ref.fasta \n</code></pre>\n<h4 id=\"setting-up-loc-files-1\"><a href=\"#setting-up-loc-files-1\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Setting Up loc Files</h4>\n<ul>\n<li>Know where the data is</li>\n<li>\n<p>Know where the <code>sam_fa_index.loc</code> file comes from and where it should be placed to be used</p>\n<ul>\n<li>initially is named (<code>/galaxy-dist/tool-data/sam_fa_index.loc.sample</code></li>\n<li>from the distribution</li>\n<li>to your Galaxy instance</li>\n</ul>\n</li>\n<li>Follow instructions in sample file to add in rows for each database. One row per database.</li>\n<li>Remove the \".sample\" from the file name if this is the first time you are using it</li>\n<li>Remove any rows for databases that you no longer want to host if you are altering an existing .loc</li>\n<li>You can make sure the file was created correctly by restarting the server and a tool from the <strong>SAM Tools</strong> tool set. Input datasets should have a database assigned that corresponds to a database having a sam index.</li>\n<li>Test the new database(s) by running a few datasets through tools. Change dataset database assignments using the \"Edit Attributes\" form (<a href=\"/learn/managing-datasets/#dataset-icons-text\">pencil icon</a>).</li>\n</ul>\n<h3 id=\"lastz-and-extract-genomic-dna\"><a href=\"#lastz-and-extract-genomic-dna\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>LASTZ and EXTRACT Genomic DNA</h3>\n<p>Have LASTZ installed in your <code>$PATH</code>, although it is not needed for creating indexes, you will need it for testing/using the tool.\nThe LASTZ and 'Extract Genomic DNA' tools both use a .2bit compressed file representing a reference genome. If the data is sourced from <a href=\"http://genome.ucsc.edu/\" target=\"_blank\" rel=\"noopener noreferrer\">UCSC</a>, this can often just be downloaded.\nIf from another source, use the FASTA file as input and have twoBitToFa installed in your <code>$PATH</code>.\ntwoBitToFa is available from <a href=\"http://genome.ucsc.edu/\" target=\"_blank\" rel=\"noopener noreferrer\">UCSC</a> as a precompiled binary if needed, see the <em>Downloads</em> link on left side bar.\nUsage: twoBitToFa ref.2bit ref.fasta\nType tool at command prompt for more usage details.</p>\n<p>The following index files will be created for the FASTA file <code>name.fasta</code>:</p>\n<ul>\n<li><code>ref.2bit</code></li>\n</ul>\n<p>The Galaxy team places the .2bit file in the same location as the original fasta FASTA file to stay organized, such as:</p>\n<pre><code>/ref/seq/ref.2bit \n/ref/seq/ref.fasta \n</code></pre>\n<h4 id=\"setting-up-loc-files-2\"><a href=\"#setting-up-loc-files-2\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Setting Up loc Files</h4>\n<ul>\n<li>Know where the data is</li>\n<li>\n<p>Know where the <code>lastz_seqs.loc</code> and <code>alignseq.loc</code> files comes from and where they should be placed to be used</p>\n<ul>\n<li>initially are named (<code>/galaxy-dist/tool-data/lastz_seqs.loc.sample</code> and (<code>/galaxy-dist/tool-data/alignseq.loc.sample</code></li>\n<li>lastz comes from the Tool Shed and <code>alignseq.loc</code> is one of the key configuration files from the distribution (used for many purposes)</li>\n<li>to your Galaxy instance</li>\n</ul>\n</li>\n<li>Follow instructions in sample file to add in rows for each database. One row per database.</li>\n<li>Remove the \".sample\" from the file name if this is the first time you are using it</li>\n<li>Remove any rows for databases that you no longer want to host if you are altering an existing .loc</li>\n<li>Restarting the server</li>\n<li>You can make sure the <code>lastz_seqs.loc</code> is correct by opening up the LASTZ tool, and checking the dropdown menu of genomes. Test the new database(s) by running a few sequences that you expect to have hits with default parameters.</li>\n<li>You can make sure the <code>alignseq.loc</code> is correct by loading a simple <a href=\"/learn/datatypes/#bed\">BED</a> file of coordinates that you know will pull regions from the target genome as a dataset, assigning the database as the reference genome that you are testing, and running the tool. Change dataset database assignments using the \"Edit Attributes\" form (<a href=\"/learn/managing-datasets/#dataset-icons-text\">pencil icon</a>).</li>\n</ul>\n<h3 id=\"megablast\"><a href=\"#megablast\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Megablast</h3>\n<p>Have Megablast installed in your <code>$PATH</code>, although it is not needed for creating indexes, you will need it for testing/using the tool.\nMegablast in Galaxy was updated to use <a href=\"http://blast.ncbi.nlm.nih.gov\" target=\"_blank\" rel=\"noopener noreferrer\">NCBI BLAST+</a> (<code>BLASTN</code>) in April 2012 (changeset <a href=\"https://bitbucket.org/galaxy/galaxy-central/changeset/0b5cb60e4810#chg-tools/metag_tools/megablast_wrapper.xml\" target=\"_blank\" rel=\"noopener noreferrer\">0b5cb60e4810</a>).\nGet the indexes: download directly at NCBI from <a href=\"ftp://ftp.ncbi.nlm.nih.gov/blast/db/\" target=\"_blank\" rel=\"noopener noreferrer\">ftp://ftp.ncbi.nlm.nih.gov/blast/db/</a>.\nCreate your own, Usage: <code>formatdb -i &#x3C;database>.fa -p F -n \"&#x3C;database>\" -v 2000</code></p>\n<p>The Galaxy <a href=\"/main/\">Main</a> public instance uses htgs, wgs, and nt from NCBI.</p>\n<p>Put the data files in an organized hierarchy such as:\n<code>/galaxy-dist/tool-data/blast/&#x3C;div>/&#x3C;date>/&#x3C;date_div>.*</code>\nor\n<code>/galaxy-dist/tool-data/blast/&#x3C;date_db>.*</code></p>\n<h4 id=\"setting-up-loc-files-3\"><a href=\"#setting-up-loc-files-3\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Setting Up loc Files</h4>\n<ul>\n<li>Know where the data is</li>\n<li>Know where the <code>blastdb.loc</code> file is located (<code>/galaxy-dist/tool-data/blastdb.loc.sample</code> is default)</li>\n<li>Follow instructions in sample file to add in rows for each database. One row per database.</li>\n<li>Remove the \".sample\" from the file name if this is the first time you are using it</li>\n<li>Remove any rows for databases that you no longer want to host</li>\n<li>You can make sure the file was created correctly by restarting the server and opening up the Megablast page, where you should see the list of databases you added.</li>\n<li>Test the databases by running a few of the sequence from the same database against themselves through the UI (self-hits) with simple filtering set to \"no\" (-F F). (Load a few .fa sequences as a dataset -> run tool).</li>\n</ul>\n<h3 id=\"srma\"><a href=\"#srma\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>SRMA</h3>\n<h4 id=\"generating-indices-3\"><a href=\"#generating-indices-3\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Generating Indices</h4>\n<p>SRMA needs three files in the same directory for each genome, named in a specific way. There are two \"index\" files required: one is the SRMA <code>.dict</code> file and the other is the Samtools <code>.fai</code> index file. To create the <code>.dict</code> file, run the Picard CreateSequenceDictionary command:</p>\n<p>Usage: <code>java -cp \"../path/to/srma.jar\" net.sf.picard.sam.CreateSequenceDictionary R=&#x3C;ref.fa> O=&#x3C;ref.dict></code></p>\n<p>Note that the <code>.fa</code> extension is replaced with the <code>.dict</code> extension. If you haven't already created the Samtools index, you will need to do that:</p>\n<p>Usage: <code>samtools faidx &#x3C;ref.fa> [region1 [...]]</code></p>\n<p>Note that the resulting file should have the extension <code>.fa.fai</code>. Finally, the fasta file (<code>&#x3C;ref.fa></code>) also needs to be available in the same directory (a relative symbolic link is fine).</p>\n<h4 id=\"setting-up-loc-files-4\"><a href=\"#setting-up-loc-files-4\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Setting Up loc Files</h4>\n<p>The process for establishing the SRMA loc file is pretty much like the others.</p>\n<ul>\n<li>You need to make sure the files are accessible</li>\n<li>Modify the file <code>srma_index.loc.sample</code> in the Galaxy <code>tool-data</code> directory following instructions within the file itself</li>\n<li>Remove the .sample from the file before using</li>\n<li>Restart the server and test</li>\n</ul>\n"}},"context":{}}