{"hash":"c32ecfdb33b075b0057598b5b9118f3554a398cf","data":{"article":{"id":"fef9c879bb774b015b199db6db6cfb42","title":"Adding custom tools to Galaxy","tease":"","image":"","images":{},"category":null,"contact":"","date":null,"content":"<p>A vast number of well-implemented tools are available for Galaxy through the <a href=\"/src/toolshed/index.md\">Galaxy Tool Shed</a>. Users with admin privileges can freely install any tools from the Tool Shed to their Galaxy instance via the <a href=\"/src/admin/index.md\">admin interface</a>. A short tutorial describing how to install tools from the Tool Shed is available <a href=\"/src/admin/tools/add-tool-from-toolshed-tutorial/index.md\">here</a>.</p>\n<p>The list of available tools in the Tool Shed can be found <a href=\"http://toolshed.g2.bx.psu.edu\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>. If a tool is not currently in the Tool Shed, it can be wrapped and added to Galaxy and later shared in the Tool Shed with the rest of the world. The steps outlined below will guide users through the creation of a custom tool in Galaxy. There are also helpful instructions in this <a href=\"/src/admin/tools/adding-tools/index.md\">tutorial for Creating a Histogram Tool</a>.</p>\n<h3 id=\"1-write-and-test-the-tool-outside-galaxy\"><a href=\"#1-write-and-test-the-tool-outside-galaxy\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>1. Write and test the tool outside Galaxy.</h3>\n<p>In this example we have written a simple Perl script called <code>toolExample.pl</code> for computing the GC content of a sequence in FASTA format.</p>\n<pre><code class=\"language-perl\">#!/usr/bin/perl -w\n\n# usage : perl toolExample.pl &#x3C;FASTA file> &#x3C;output file>\n\nopen (IN, \"&#x3C;$ARGV[0]\");\nopen (OUT, \">$ARGV[1]\");\nwhile (&#x3C;IN>) {\n    chop;\n    if (m/^>/) {\n        s/^>//;\n        if ($. > 1) {\n            print OUT sprintf(\"%.3f\", $gc/$length) . \"\\n\";\n        }\n        $gc = 0;\n        $length = 0;\n    } else {\n        ++$gc while m/[gc]/ig;\n        $length += length $_;\n    }\n}\nprint OUT sprintf(\"%.3f\", $gc/$length) . \"\\n\";\nclose( IN );\nclose( OUT );\n</code></pre>\n<p>This tool has been tested outside of Galaxy and functions as expected.</p>\n<h3 id=\"2-put-the-tool-into-galaxys-tools-directory\"><a href=\"#2-put-the-tool-into-galaxys-tools-directory\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>2. Put the tool into Galaxy's tools directory.</h3>\n<p>To begin the tool integration process, we need to add our Perl script to the <code>tools/</code> directory, where all tool-related files are stored, within our Galaxy installation. In this example we have create a new subdirectory called <code>myTools</code> within <code>tools/</code> and then moved to this subdirectory.</p>\n<pre><code class=\"language-sh\">cd tools\nmkdir myTools\ncd myTools\n</code></pre>\n<p>Next, we need to copy the Perl script to our new subdirectory so that Galaxy can recognize it. In this example we have copied <code>toolExample.pl</code> to the <code>tools/myTools/</code> directory.</p>\n<h3 id=\"3-create-the-tool-definition-file\"><a href=\"#3-create-the-tool-definition-file\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>3. Create the tool definition file.</h3>\n<p>Although <code>toolExample.pl</code> now resides within the <code>tools/myTools/</code> directory, Galaxy does not know how to execute this tool. To inform Galaxy of the execution details of this tool, we need to generate a tool definition file. In this example we have created the tool definition file <code>toolExample.xml</code> within the <code>tools/myTools</code> directory.</p>\n<pre><code class=\"language-xml\" id=\"fa_gc_content_1\">&#x3C;tool id=\"fa_gc_content_1\" name=\"Compute GC content\" version=\"0.1.0\">\n  &#x3C;description>for each sequence in a file&#x3C;/description>\n  &#x3C;command>perl '${__tool_directory__}/toolExample.pl' '$input' '$output'&#x3C;/command>\n  &#x3C;inputs>\n    &#x3C;param format=\"fasta\" name=\"input\" type=\"data\" label=\"Source file\"/>\n  &#x3C;/inputs>\n  &#x3C;outputs>\n    &#x3C;data format=\"tabular\" name=\"output\" />\n  &#x3C;/outputs>\n\n  &#x3C;tests>\n    &#x3C;test>\n      &#x3C;param name=\"input\" value=\"fa_gc_content_input.fa\"/>\n      &#x3C;output name=\"out_file1\" file=\"fa_gc_content_output.txt\"/>\n    &#x3C;/test>\n  &#x3C;/tests>\n\n  &#x3C;help>\nThis tool computes GC content from a FASTA file.\n  &#x3C;/help>\n\n&#x3C;/tool>\n</code></pre>\n<p>The tool definition file specifies command line parameters, links them to input and output, and provides help information using the restructured text format. The <code>tools/myTools</code> directory now contains two files: <code>toolExample.pl</code> and <code>toolExample.xml</code>. More information on how to write tool definition files can be found <a href=\"https://docs.galaxyproject.org/en/latest/dev/schema.html\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>.</p>\n<h3 id=\"4-make-galaxy-aware-of-the-new-tool\"><a href=\"#4-make-galaxy-aware-of-the-new-tool\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>4. Make Galaxy aware of the new tool.</h3>\n<p>Now that the tool and its definition file are ready, the final step is to make Galaxy aware of the new files. Galaxy recognizes installed tools by reading the <code>tool_conf.xml</code> tool configuration file. Thus, letting Galaxy know about the new tool is as easy as adding a few lines to the <code>tool_conf.xml</code> file located in the <code>config/</code> directory of the Galaxy installation. New tools can either be added to existing sections or added to new sections defined in the following way:</p>\n<pre><code class=\"language-xml\" id=\"mTools\"> &#x3C;section name=\"MyTools\" id=\"mTools\">\n    &#x3C;tool file=\"myTools/toolExample.xml\" />\n &#x3C;/section>\n</code></pre>\n<h3 id=\"5-start-galaxy\"><a href=\"#5-start-galaxy\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>5. Start Galaxy.</h3>\n<p>To test the newly integrated tool, start Galaxy by typing <code>sh run.sh</code> from within Galaxy's root directory and point your browser to <a href=\"http://localhost:8080\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:8080</a>. If the tool has successfully been integrated, the Galaxy interface should look similar to:</p>\n<p><img src=\"/src/admin/tools/add-tool-tutorial/toolExample.png\"></p>\n<p>Note the correspondence between elements of the tool definition file (Step 3) and the interface elements shown above. The \"Compute GC for\" dropdown reads \"no data has the proper type\" because the history pane contains no data in the FASTA format.</p>\n<h3 id=\"6-optional-upload-the-tool-to-galaxys-tool-shed\"><a href=\"#6-optional-upload-the-tool-to-galaxys-tool-shed\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>6. (optional) Upload the tool to Galaxy's Tool Shed.</h3>\n<p>To share the tool with the Galaxy community, upload it to the <a href=\"/src/toolshed/index.md\">Galaxy Tool Shed</a>. Users can now install the tool into their Galaxies seamlessly via the <a href=\"/src/admin/index.md\">Admin interface</a>. If the tool is well-written and tested it can even make it to the <a href=\"/src/main/index.md\">Main Galaxy instance</a> or other <a href=\"/src/use/index.md\">Public Galaxy Servers</a>!</p>\n<p>To get started sharing and publishing your tool, check out the <a href=\"/src/toolshed/publish-tool/index.md\">How to publish a tool in the Tool Shed</a> tutorial.</p>\n"}},"context":{}}