{"hash":"f696d459c27618375ae9beff9077a6039192ee4e","data":{"article":{"id":"35201db4330e3e2fdf5aaaacf4cd3892","title":"Configuration of User Authentication Methods","tease":"","category":null,"date":null,"days":null,"contact":"","contact_url":"","fileInfo":{"path":"build/content-md/authnz/config/index.md"},"authors":"","location":"","location_url":"","source_blog":"","source_blog_url":"","skip_title_render":null,"redirect":"","autotoc":null,"links":[],"image":"","images":{},"external_url":"","content":"<div class=\"toc-wrapper col-md-3\">\n<ul>\n<li><a href=\"#galaxy-authentication-configuration-options\">Galaxy Authentication Configuration Options</a></li>\n<li>\n<p><a href=\"#the-internal-process-for-authenticating-a-user\">The Internal Process for Authenticating a User</a></p>\n<ul>\n<li><a href=\"#authentication-related-source-code\">Authentication Related Source Code</a></li>\n<li><a href=\"#database-tables\">Database Tables</a></li>\n</ul>\n</li>\n</ul>\n</div>\n<div class=\"body-wrapper col-md-9\">\n<p><em>This page explains how to configure this feature as an administrator,\nfor user-specific docs, please refer to the <a href=\"/authnz/use/\">Use page</a>.</em></p>\n<h1 id=\"galaxy-authentication-configuration-options\"><a href=\"#galaxy-authentication-configuration-options\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Galaxy Authentication Configuration Options</h1>\n<p>Galaxy offers <a href=\"/authnz/#user-authentication-and-authorization\">various methods for user authentication</a>\n(aka login). All the methods share some common concepts, which are explained on\nthis page. The method-specific configurations are explained at the following\npages:</p>\n<ul>\n<li><a href=\"/authnz/config/gxy/\">Galaxy Username and Password</a></li>\n<li><a href=\"/authnz/config/oidc/\">Using 3rd party identity</a> (i.e., social login)</li>\n</ul>\n<h1 id=\"the-internal-process-for-authenticating-a-user\"><a href=\"#the-internal-process-for-authenticating-a-user\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>The Internal Process for Authenticating a User</h1>\n<p>The following steps are followed in any code that seeks to recognize a\nuser within Galaxy and allow access to the application:</p>\n<ol>\n<li>The identity credential, currently the e-mail address of the user,\nis used to find any previously-registered user in the database.</li>\n<li>Where no user exists and the login mechanism requires explicit\nregistration, authentication fails at this point. Otherwise, a user\nis automatically created for previously unknown identities.</li>\n<li>For conventional accounts requiring a password, authentication\nfails at this point if a valid password is not specified. Otherwise,\nan alternative mechanism for completing authentication may be invoked.</li>\n<li>Upon completion of the authentication of a userâ€™s identity,\nany association of that identity with the Galaxy user instance may\nbe performed. For example, an OpenID identity may be associated\nwith a user created for that identity.</li>\n<li>Finally, the login is handled using the handle_user_login method\non the GalaxyWebTransaction object, associating the user with a new session.</li>\n</ol>\n<h2 id=\"authentication-related-source-code\"><a href=\"#authentication-related-source-code\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Authentication Related Source Code</h2>\n<p>The main <strong>controllers</strong> for user authentication are:</p>\n<ul>\n<li><code>User</code> controller: <a href=\"https://github.com/galaxyproject/galaxy/blob/95d9bfb021bd088cd4adfb950e87a2c6deb6a8ec/lib/galaxy/webapps/galaxy/controllers/user.py#L35\" target=\"_blank\" rel=\"noopener noreferrer\">lib/galaxy/webapps/galaxy/controllers/user.py</a>;</li>\n<li><code>OIDC</code> controller: <a href=\"https://github.com/galaxyproject/galaxy/blob/95d9bfb021bd088cd4adfb950e87a2c6deb6a8ec/lib/galaxy/webapps/galaxy/controllers/authnz.py#L17\" target=\"_blank\" rel=\"noopener noreferrer\">lib/galaxy/webapps/galaxy/controllers/authnz.py</a></li>\n</ul>\n<p>The related <strong>managers</strong> are:</p>\n<ul>\n<li><a href=\"https://github.com/galaxyproject/galaxy/blob/95d9bfb021bd088cd4adfb950e87a2c6deb6a8ec/lib/galaxy/managers/users.py#L41\" target=\"_blank\" rel=\"noopener noreferrer\">UserManager</a>;</li>\n<li><a href=\"https://github.com/galaxyproject/galaxy/blob/95d9bfb021bd088cd4adfb950e87a2c6deb6a8ec/lib/galaxy/auth/__init__.py#L13\" target=\"_blank\" rel=\"noopener noreferrer\">AuthManager</a> (relates to authentication agains local database, LDAP, and PAM);</li>\n<li><a href=\"https://github.com/galaxyproject/galaxy/blob/95d9bfb021bd088cd4adfb950e87a2c6deb6a8ec/lib/galaxy/authnz/managers.py#L31\" target=\"_blank\" rel=\"noopener noreferrer\">AuthnzManager</a> (relates to OIDC-based authentication).</li>\n</ul>\n<p>And the primary related <strong>models</strong> are:</p>\n<ul>\n<li><a href=\"https://github.com/galaxyproject/galaxy/blob/95d9bfb021bd088cd4adfb950e87a2c6deb6a8ec/lib/galaxy/model/__init__.py#L294\" target=\"_blank\" rel=\"noopener noreferrer\">User</a>;</li>\n<li>\n<p>OIDC:</p>\n<ul>\n<li><a href=\"https://github.com/galaxyproject/galaxy/blob/95d9bfb021bd088cd4adfb950e87a2c6deb6a8ec/lib/galaxy/model/__init__.py#L5040\" target=\"_blank\" rel=\"noopener noreferrer\">UserAuthnzToken</a>;</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"database-tables\"><a href=\"#database-tables\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Database Tables</h2>\n<p>The database employs a <a href=\"https://github.com/galaxyproject/galaxy/blob/95d9bfb021bd088cd4adfb950e87a2c6deb6a8ec/lib/galaxy/model/mapping.py#L58-L73\" target=\"_blank\" rel=\"noopener noreferrer\">galaxy_user</a>\ntable which records the details of all registered users, and this table\nis exposed to the code through the <a href=\"https://github.com/galaxyproject/galaxy/blob/95d9bfb021bd088cd4adfb950e87a2c6deb6a8ec/lib/galaxy/model/__init__.py#L294\" target=\"_blank\" rel=\"noopener noreferrer\">User</a>\nabstraction found in <a href=\"https://github.com/galaxyproject/galaxy/blob/95d9bfb021bd088cd4adfb950e87a2c6deb6a8ec/lib/galaxy/model/mapping.py#L1796-L1830\" target=\"_blank\" rel=\"noopener noreferrer\">lib/galaxy/model/mapping.py</a>.\nEach logged-in user is assigned a session which references the user\nin the galaxy_session table (exposed via GalaxySession).</p>\n<p>User information from external sources, such as OIDC, is found in\nperipheral tables such as:</p>\n<ul>\n<li>Tokens are stored in <a href=\"https://github.com/galaxyproject/galaxy/blob/95d9bfb021bd088cd4adfb950e87a2c6deb6a8ec/lib/galaxy/model/mapping.py#L124-L132\" target=\"_blank\" rel=\"noopener noreferrer\">UserAuthnzToken</a> table;</li>\n<li>implementation-specific (transient) information are stored in peripheral tables such as:\n<a href=\"https://github.com/galaxyproject/galaxy/blob/95d9bfb021bd088cd4adfb950e87a2c6deb6a8ec/lib/galaxy/model/mapping.py#L93-L101\" target=\"_blank\" rel=\"noopener noreferrer\">PSAAssociation</a>,\n<a href=\"https://github.com/galaxyproject/galaxy/blob/95d9bfb021bd088cd4adfb950e87a2c6deb6a8ec/lib/galaxy/model/mapping.py#L103-L107\" target=\"_blank\" rel=\"noopener noreferrer\">PSACode</a>,\n<a href=\"https://github.com/galaxyproject/galaxy/blob/95d9bfb021bd088cd4adfb950e87a2c6deb6a8ec/lib/galaxy/model/mapping.py#L109-L114\" target=\"_blank\" rel=\"noopener noreferrer\">PSANonce</a>, and\n<a href=\"https://github.com/galaxyproject/galaxy/blob/95d9bfb021bd088cd4adfb950e87a2c6deb6a8ec/lib/galaxy/model/mapping.py#L116-L122\" target=\"_blank\" rel=\"noopener noreferrer\">PSAPartial</a>.</li>\n</ul>\n</div>\n"}},"context":{}}