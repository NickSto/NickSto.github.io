{"hash":"c32ecfdb33b075b0057598b5b9118f3554a398cf","data":{"article":{"id":"0c3026ee71b65d07282a8ba6b5fd3b2c","title":"Configure Your Galaxy Instance as a Google OIDC Client","tease":"","image":"","images":{},"category":null,"contact":"","date":null,"content":"<p><em>This page explains how to configure this feature, for user-specific docs, please refer to <a href=\"/src/authnz/use/oidc/idps/google/index.md\">this</a> page.</em></p>\n<p>Leveraging OpenID Connect (OIDC) protocol, users can login to Galaxy with their\nGoogle account, without having to (explicitly) create a Galaxy user account. To\nenable this feature on your Galaxy instance, you would need to first register\nyou Galaxy instance as an OIDC relying party (RP, or client) with Google, then\nuse your registration information to configure Galaxy. These steps are described\nin details in the following sections.</p>\n<h1 id=\"client-registration\"><a href=\"#client-registration\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Client Registration</h1>\n<p>Take the following steps in order to register your Galaxy instance as an OIDC RP\non Google's OAuth2.0 authorization server:</p>\n<ol>\n<li>\n<p>Visit the <a href=\"https://console.developers.google.com/apis/dashboard\" target=\"_blank\" rel=\"noopener noreferrer\">Google Developers Dashboard</a>\nand either create a new project or select an exising project to use for this registration:</p>\n<pre><code>1. If this is your first time visiting this page, you’ll see a prompt to\n   create a new project. Click on the _Create_ button to create a project.\n\n![image](/src/authnz/config/oidc/idps/google/gdc-create-project-1.png)\n\n2. If you already have existing projects, click the drop down in the top\n   menu and select a desired project or create a new project by clicking the\n   _New Project_ button.\n\n![image](/src/authnz/config/oidc/idps/google/gdc-create-project-2.png)\n![image](/src/authnz/config/oidc/idps/google/gdc-create-project-3.png)\n\n3. On the _New Project_ page, enter desired project name and click _Create_.\n\n![image](/src/authnz/config/oidc/idps/google/gdc-create-project-4.png)\n</code></pre>\n</li>\n</ol>\n<ol start=\"2\">\n<li>\n<p>Go to <em>Library</em> section of the <a href=\"https://console.developers.google.com/apis/library\" target=\"_blank\" rel=\"noopener noreferrer\">APIs &#x26; Services</a>\nconsole and enable the <a href=\"https://console.developers.google.com/apis/library/plus.googleapis.com\" target=\"_blank\" rel=\"noopener noreferrer\">Google+ API</a>;</p>\n<pre><code>![image](/src/authnz/config/oidc/idps/google/gdc-library.png)\n![image](/src/authnz/config/oidc/idps/google/gdc-enable-google-plus-api.png)\n</code></pre>\n</li>\n<li>\n<p>Next, we'll add the details about our Galaxy instance and create a set of\nclient credentials for use in the Galaxy configuration so click on the\n<em>Credentials</em> page in the developers console.</p>\n<pre><code>1. Select the _OAuth consent screen_ tab and Fill the fields according to\n   your Galaxy instance, then save the changes.\n\n![image](/src/authnz/config/oidc/idps/google/gdc-consent-config.png)\n\n2. Select the _Create credentials_ on the _Credentials_ tab and choose\n_OAuth client ID_ from the popup window.\n\n![image](/src/authnz/config/oidc/idps/google/gdc-create-oauth-client-creds.png)\n\n3. Choose _Web application_ from the list and provide a name (e.g.,\n   _Galaxy Client_). For the _Authorized redirect URIs_ field, you need to enter\n   your instance’s OIDC redirect URI, which is in the following template:\n\n   ```\n   &#x3C;Host URI>/authnz/google/callback\n   ```\n\n   For instance:\n\n   ```\n   http://localhost:8080/authnz/google/callback\n   ```\n\n   See [this section](/src/authnz/config/oidc/index.md#redirect-uri) for details.\n\n   Then hit the _Create_ button.\n\n   ![image](/src/authnz/config/oidc/idps/google/gdc-create-client.png)\n\n4. A window pops-up showing your OAuth `Client ID` and `Client Secret`; note this info!\n\n![image](/src/authnz/config/oidc/idps/google/gdc-result.png)\n</code></pre>\n</li>\n</ol>\n<h1 id=\"galaxy-configuration\"><a href=\"#galaxy-configuration\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Galaxy Configuration</h1>\n<p>You would need to setup you Galaxy instance to leverage OIDC protocol.\nThis setup is common for all OIDC IdPs, and is\n<a href=\"/src/authnz/config/oidc/index.md#configure-oidc-backends\">documented at this page</a>.\nThen you would need to add Google-specific setters to the <code>config/oidc_backends_config.xml</code> file as the\nthe following:</p>\n<pre><code class=\"language-xml\">&#x3C;?xml version=\"1.0\"?>\n&#x3C;OIDC>\n    &#x3C;provider name=\"Google\">\n        &#x3C;client_id> ... &#x3C;/client_id>\n        &#x3C;client_secret> ... &#x3C;/client_secret>\n        &#x3C;redirect_uri>http://localhost:8080/authnz/google/callback&#x3C;/redirect_uri>\n        &#x3C;prompt>consent&#x3C;/prompt>\n    &#x3C;/provider>\n&#x3C;/OIDC>\n</code></pre>\n<p>See <a href=\"/src/authnz/config/oidc/index.md#supported-oidc-idps\">this section</a>\nfor more details.</p>\n<p>Having set this configuration, restart Galaxy to have the option of login to\nGalaxy with a Google account enabled.</p>\n<p><img src=\"/src/authnz/config/oidc/idps/google/gdc-google-login-button.png\" alt=\"image\"></p>\n"}},"context":{}}