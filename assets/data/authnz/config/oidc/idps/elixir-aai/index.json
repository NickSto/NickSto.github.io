{"hash":"c32ecfdb33b075b0057598b5b9118f3554a398cf","data":{"article":{"id":"487a9d94a9bd1628275b124921f6d4e0","title":"Configure Your Galaxy Instance as an OIDC Client of ELIXIR Authentication and Authorisation Infrastructure","tease":"","image":"","images":{},"category":null,"contact":"","date":null,"content":"<p><em>This page explains how to configure this feature, for user-specific docs, please refer to <a href=\"/src/authnz/use/oidc/idps/elixir-aai/index.md\">this</a> page.</em></p>\n<p>Leveraging OpenID Connect (OIDC) protocol, users can login to Galaxy using their\nidentity on <a href=\"https://elixir-europe.org/services/compute/aai\" target=\"_blank\" rel=\"noopener noreferrer\">ELIXIR Authentication and Authorisation Infrastructure (AAI)</a>,\nwithout having to (explicitly) create a Galaxy user account. To\nenable this feature on your Galaxy instance, you would need to first register\nyou Galaxy instance as an OIDC relying party (RP, or client) with ELIXIR AAI, and then\nuse your registration information to configure Galaxy. These steps are described\nin details in the following sections.</p>\n<h1 id=\"client-registration\"><a href=\"#client-registration\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Client Registration</h1>\n<p>Take the following steps to register your Galaxy instance (RP) to the ELIXIR AAI <strong>test environment</strong>:</p>\n<ol>\n<li><a href=\"https://elixir-europe.org/register\" target=\"_blank\" rel=\"noopener noreferrer\">Create an ELIXIR identity</a>, if you do not already have it.</li>\n<li>\n<p><a href=\"https://spreg.aai.elixir-czech.cz/spreg/auth\" target=\"_blank\" rel=\"noopener noreferrer\">Click here to start register your client</a>\nand you'll see a dashboard as the following: </p>\n<pre><code>![image](/src/authnz/config/oidc/idps/elixir-aai/register-a-new-client-1.png)\n</code></pre>\n</li>\n<li>\n<p>Click the green \"New Client\" button:</p>\n<p><img src=\"/src/authnz/config/oidc/idps/elixir-aai/register-a-new-client-2.png\" alt=\"image\"></p>\n</li>\n<li>\n<p>Fill in the \"Client name\" and \"Redirect URI\" fields, and all the other fields\nare optional. </p>\n<pre><code>![image](/src/authnz/config/oidc/idps/elixir-aai/register-a-new-client-3.png)\n</code></pre>\n</li>\n<li>\n<p>Click the green \"Save\" button at the bottom (or at the top) and make a note of all\nthe generated credentials that is made available to you. The <code>Client ID</code> and\n<code>Client Secret</code> fields will be used to configure Galaxy, and <code>Client Configuration URL</code>\nand <code>Registration Access Token</code> will be needed to access the client registration in future.</p>\n<pre><code>![image](/src/authnz/config/oidc/idps/elixir-aai/register-a-new-client-4.png)\n</code></pre>\n</li>\n<li>\n<p>Drop the following information by e-mail to aai-contact@elixir-europe.org: </p>\n<ul>\n<li>Name of your service</li>\n<li>Description of your service</li>\n<li>Your serviceâ€™s Client_id</li>\n</ul>\n</li>\n<li>Wait for a reply from ELIXIR AAI with a form for you to complete. It includes\nrequesting which attribute scopes should be returned to Galaxy when users authenticate.\nWe recommend to only request <strong>openid</strong> and <strong>email</strong> scopes, as this is the minimum\nthat is needed and will be utilized by Galaxy.</li>\n<li>Return the pre-filled form and when accepted, the ELIXIR AAI service is ready to\nreceive authentication requests from your Galaxy server! Of course you also need to\nconfigure your Galaxy first, so read on under <a href=\"#galaxy-configuration\">Galaxy Configuration</a>.</li>\n</ol>\n<div class=\"alert alert-warning\" role=\"alert\">\n    **Note:**\n    \n    Without the complition of steps **7** and **8**, your Galaxy instances can NOT verify users \n    authentication based on the information it receives from ELIXIR AAI, because this \n    provider does not provide a client with all information required as per OIDC \n    specifications (e.g., `id_token`) by default.   \n</div>\n<p>The <a href=\"https://docs.google.com/document/d/1ihb0hH2YJqSCPZS0syVpvAOeQP1HTxdf_XMsZZLe_W0/edit\" target=\"_blank\" rel=\"noopener noreferrer\">ELIXIR AAI - Manual for Service Providers</a>\nprovides more details on the client registration process. The steps discussed here\nleads to registering a Galaxy instance to the ELIXIR AAI <strong>test environment</strong>.\nHowever, for <strong>production deployment</strong>, you would need to promote your service from the\ntest environment to the prod environment following the described administrative\nprocedures in Step 3 of the\n<a href=\"https://docs.google.com/document/d/1ihb0hH2YJqSCPZS0syVpvAOeQP1HTxdf_XMsZZLe_W0/edit\" target=\"_blank\" rel=\"noopener noreferrer\">ELIXIR AAI - Manual for Service Providers</a>.</p>\n<h1 id=\"galaxy-configuration\"><a href=\"#galaxy-configuration\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Galaxy Configuration</h1>\n<p>You would need to setup your Galaxy instance to leverage OIDC protocol.\nThis setup is common for all OIDC IdPs, and is\n<a href=\"/src/authnz/config/oidc/index.md#configure-oidc-backends\">documented at this page</a>.\nThen you would need to add ELIXIR AAI-specific setters to the <code>config/oidc_backends_config.xml</code>\nmatching the values you got from the client registration process, as well as the exact same\n<code>redirect_uri</code> you specified (depending on your setup):</p>\n<pre><code class=\"language-xml\">&#x3C;?xml version=\"1.0\"?>\n&#x3C;OIDC>\n    &#x3C;provider name=\"Elixir\">\n        &#x3C;client_id> ... &#x3C;/client_id>\n        &#x3C;client_secret> ... &#x3C;/client_secret>\n        &#x3C;redirect_uri>http://localhost:8080/authnz/elixir/callback&#x3C;/redirect_uri>\n        &#x3C;prompt>consent&#x3C;/prompt>\n    &#x3C;/provider>\n&#x3C;/OIDC>\n</code></pre>\n<p>Having set this configuration, restart Galaxy to have the option of login to\nGalaxy with ELIXIR AAI identity:</p>\n<p><img src=\"/src/authnz/config/oidc/idps/elixir-aai/login-including-elixir.png\" alt=\"image\"></p>\n"}},"context":{}}