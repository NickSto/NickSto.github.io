{"hash":"413b95c96e3c2a1187afbfe2a34414202ea5b44f","data":{"article":{"id":"a99a01a2f368220acfa8cfd1b6d88433","title":"User Authentication Using Social and Institutional Identities","tease":"","category":null,"date":null,"days":null,"contact":"","contact_url":"","authors":"","location":"","location_url":"","source_blog":"","source_blog_url":"","skip_title_render":null,"links":[],"image":"","images":{},"external_url":"","content":"<div class=\"toc-wrapper col-md-3\">\n<ul>\n<li><a href=\"#supported-identity-providers\">Supported Identity Providers</a></li>\n<li><a href=\"#enable-oidc-based-login\">Enable OIDC-based Login</a></li>\n<li><a href=\"#global-oidc-configuration\">Global OIDC Configuration</a></li>\n<li>\n<p><a href=\"#oidc-configuration-options-for-identity-providers\">OIDC configuration options for Identity Providers</a></p>\n<ul>\n<li><a href=\"#client-id\">Client ID</a></li>\n<li><a href=\"#client-secret\">Client Secret</a></li>\n<li><a href=\"#redirect-uri\">Redirect URI</a></li>\n</ul>\n</li>\n</ul>\n</div>\n<div class=\"body-wrapper col-md-9\">\n<p><em>This page explains how to configure this feature as an administrator,\nfor user-specific docs, please refer to the <a href=\"/authnz/use/oidc/\">Use page</a>.</em></p>\n<p>Leveraging the <a href=\"https://developer.okta.com/blog/2019/10/21/illustrated-guide-to-oauth-and-oidc\" target=\"_blank\" rel=\"noopener noreferrer\">OpenID Connect (OIDC)\nprotocol</a>\nusers can login to Galaxy using their social and institutional identities\n(e.g., their University or Google account). This method allows for new user\nregistration or linking of an existing Galaxy user account with external\nidentities.</p>\n<p><strong>Related publications:</strong></p>\n<ul>\n<li>Jalili, Vahid, et al. <a href=\"https://doi.org/10.1093/bioinformatics/btz472\" target=\"_blank\" rel=\"noopener noreferrer\">\"Cloud bursting galaxy: federated identity and access management.\"</a> Bioinformatics 36.1 (2020): 1-9.</li>\n</ul>\n<h1 id=\"supported-identity-providers\"><a href=\"#supported-identity-providers\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Supported Identity Providers</h1>\n<p>Before using OIDC-based login, it is necessary for a Galaxy system\nadministrator to configure their Galaxy instance (see below) as well as obtain\nthe necessary registrations from the Identity Providers (IdP).The IdP needs to\nsupport the OIDC protocol and Galaxy currently supports the following OIDC\nIdPs:</p>\n<ul>\n<li><a href=\"/authnz/config/oidc/idps/cilogon/\">CILogon</a></li>\n<li><a href=\"/authnz/config/oidc/idps/custos/\">Custos</a></li>\n<li><a href=\"/authnz/config/oidc/idps/elixir-aai/\">Elixir AAI</a></li>\n<li><a href=\"/authnz/config/oidc/idps/globus/\">Globus</a></li>\n<li><a href=\"/authnz/config/oidc/idps/google/\">Google</a></li>\n<li><a href=\"/authnz/config/oidc/idps/okta/\">Okta</a></li>\n</ul>\n<h1 id=\"enable-oidc-based-login\"><a href=\"#enable-oidc-based-login\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Enable OIDC-based Login</h1>\n<p>The OIDC-based login in Galaxy is disabled by default, and to enable it take\nthe following steps:</p>\n<ol>\n<li>In your Galaxy home directory, go to the <code>config</code> folder and create a copy\nof <code>galaxy.yml.sample</code> and name it <code>galaxy.yml</code> if you have not done that yet.</li>\n<li>\n<p>Open the <code>config/galaxy.yml</code> file, and uncomment <code>enable_oidc</code>,\n<code>oidc_config_file</code>, and <code>oidc_backends_config_file</code> attributes and set them\nas follows:</p>\n<pre><code># Enables and disables OpenID Connect (OIDC) support.\nenable_oidc: true\n\n# Sets the path to OIDC configuration file.\noidc_config_file: config/oidc_config.xml\n\n# Sets the path to OIDC backends configuration file.\noidc_backends_config_file: config/oidc_backends_config.xml\n</code></pre>\n</li>\n<li>Create the <code>config/oidc_config.xml</code> and <code>config/oidc_backends_config.xml</code>\nfiles by copying their <code>.sample</code> files. The following sections describe the\nattributes of those files while the IdP-specific pages listed above provide\ndetails on setting up the specific provider. Make sure to refer to the\nprovider-specific documentation because each provider requires and supports\na slightly different set of attributes.</li>\n</ol>\n<h1 id=\"global-oidc-configuration\"><a href=\"#global-oidc-configuration\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Global OIDC Configuration</h1>\n<p>Some configurations are common between all the IdPs. These configurations are\nset in the <code>config/oidc_config.xml</code> file. Currently, the following properties\nare set via this file:</p>\n<ul>\n<li><strong>Verify SSL</strong>: sets whether the hosts SSL certificates for HTTPS requests\nshall be verified or not. See <a href=\"http://docs.python-requests.org/en/v1.0.4/user/advanced/#ssl-cert-verification\" target=\"_blank\" rel=\"noopener noreferrer\">this\ndocumentation</a>\nfor details.</li>\n<li><strong>Requests Timeout</strong>: sets the maximum number of seconds Galaxy should wait\nfor a response from the IdP. See <a href=\"http://docs.python-requests.org/en/master/user/advanced/#timeouts\" target=\"_blank\" rel=\"noopener noreferrer\">this\ndocumentation</a>\nfor details.</li>\n<li><strong>ID Token Max Age</strong>: sets the duration of time, in seconds, starting from\nthe token issue time, during which the token must be valid. This number will\nbe sent to IdP, requesting the token to be valid for the number of given\nseconds. Note that this number set the <strong>maximum</strong> duration for token\nvalidity. A token may be invalidated by an IdP upon the resource owner's\nrequest, even before the expiration time has reached.</li>\n</ul>\n<p>To configure OIDC IdPs with these attributes, you would need to add a <code>Setter</code>\ntag in the <code>oidc_config.xml</code> file. The <code>Setter</code> tag takes <code>Property</code> (e.g.,\n<code>VERIFY_SSL</code>), <code>Value</code>, and <code>Type</code> attributes that define the desired property.\nFor instance:</p>\n<pre><code class=\"language-xml\">&#x3C;Setter Property=\"VERIFY_SSL\" Value=\"False\" Type=\"bool\"/>\n</code></pre>\n<p>See the following table for the currently supported values for each attribute:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Property</th>\n<th>Default Value</th>\n<th>Type</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td><code>VERIFY_SSL</code></td>\n<td>False</td>\n<td>bool</td>\n</tr>\n<tr>\n<td>2</td>\n<td><code>REQUESTS_TIMEOUT</code></td>\n<td>3600</td>\n<td>float</td>\n</tr>\n<tr>\n<td>3</td>\n<td><code>ID_TOKEN_MAX_AGE</code></td>\n<td>3600</td>\n<td>float</td>\n</tr>\n</tbody>\n</table>\n<p>The following is an example on how to setup this file:</p>\n<pre><code class=\"language-xml\">&#x3C;?xml version=\"1.0\"?>\n&#x3C;OIDC>\n    &#x3C;Setter Property=\"VERIFY_SSL\" Value=\"False\" Type=\"bool\"/>\n    &#x3C;Setter Property=\"REQUESTS_TIMEOUT\" Value=\"3600\" Type=\"float\"/>\n    &#x3C;Setter Property=\"ID_TOKEN_MAX_AGE\" Value=\"3600\" Type=\"float\"/>\n&#x3C;/OIDC>\n</code></pre>\n<h1 id=\"oidc-configuration-options-for-identity-providers\"><a href=\"#oidc-configuration-options-for-identity-providers\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>OIDC configuration options for Identity Providers</h1>\n<p>Which OIDC IdPs are enabled and configured is defined in the\n<code>config/oidc_backends_config.xml</code> file. Each <code>provider</code> block enables and\ndefines an IdP. There could be multiple providers defined in this file and each\nprovider needs to be configured with settings specific to that IdP. Note that you may\ndefine multiple <strong>different</strong> IdPs, but you cannot define multiple instances of\nsame IdP (e.g., you cannot have multiple <code>Google</code> configurations).</p>\n<p>The following is a sample configuration for a provider. Configuration\nattributes required by all providers are described below. Each provider\nsupports additional attributes, some required and some optional so make sure to\nlook at the provider-specific pages for how to configure it.</p>\n<pre><code class=\"language-xml\">&#x3C;?xml version=\"1.0\"?>\n&#x3C;OIDC>\n    &#x3C;provider name=\"Custos\">\n        &#x3C;client_id>custos-xmn3092m8tkh7546hv76-10000001&#x3C;/client_id>\n        &#x3C;client_secret>15Ur37stVGwvONALNjjq89ezRXxoKuunFzvEeTDY&#x3C;/client_secret>\n        &#x3C;redirect_uri>http://localhost:8000/authnz/custos/callback&#x3C;/redirect_uri>\n        &#x3C;url>https://custos.scigap.org/apiserver/identity-management/v1.0.0/&#x3C;/url>\n    &#x3C;/provider>\n&#x3C;/OIDC>\n</code></pre>\n<h2 id=\"client-id\"><a href=\"#client-id\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Client ID</h2>\n<p>The <code>client_id</code> is a required string attribute that identifies your Galaxy\ninstance to the IdP. It is obtained from the IdP and it is unique to the IdP.\nThe <a href=\"https://tools.ietf.org/html/rfc6749#section-2.2\" target=\"_blank\" rel=\"noopener noreferrer\">client identifier</a> is not\na secret; it is exposed to the resource owner and must not be used alone for\nclient authentication.</p>\n<p>You need to obtain this ID by registering your Galaxy instance with an IdP. See\nthe aforementioned links on how to register your Galaxy instance (aka client)\nwith the specific providers. Having obtained the ID, set it using the following\nattribute:</p>\n<pre><code class=\"language-xml\" class=\"..\">&#x3C;client_id> ... &#x3C;/client_id>\n</code></pre>\n<h2 id=\"client-secret\"><a href=\"#client-secret\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Client Secret</h2>\n<p>The <code>client_secret</code> is a required string attribute generated by IdP for your\nGalaxy client upon its registration with the IdP. You may use the following\nconfiguration option for client secret:</p>\n<pre><code class=\"language-xml\" class=\"..\">&#x3C;client_secret> ... &#x3C;/client_secret>\n</code></pre>\n<h2 id=\"redirect-uri\"><a href=\"#redirect-uri\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Redirect URI</h2>\n<p>The <code>redirect_uri</code> is a required attribute representing the absolute endpoint\nof your Galaxy instance. You provide the <a href=\"https://tools.ietf.org/html/rfc6749#section-3.1.2\" target=\"_blank\" rel=\"noopener noreferrer\">redirect\nURI</a> to the IdP when\nregistering your Galaxy instance and the IdP will call back your Galaxy\ninstance at that URI upon successful user authentication.</p>\n<p>In the case of Galaxy, this redirect URI has the following structure:</p>\n<pre><code>&#x3C;Host URI>/authnz/&#x3C;provider>/callback\n</code></pre>\n<p>where the <code>Host URI</code> is the domain name of your Galaxy server and the\n<code>provider</code> is one of the OIDC provider names supported by Galaxy, as listed\nabove. For instance:</p>\n<ul>\n<li>\n<p>When using <code>localhost</code> to authenticate with Google:</p>\n<pre><code>http://localhost:8080/authnz/google/callback\n</code></pre>\n</li>\n<li>\n<p>When using <code>localhost</code> to authenticate with Globus:</p>\n<pre><code>http://localhost:8080/authnz/globus/callback\n</code></pre>\n</li>\n<li>\n<p>When using an instance hosted at <code>https://usegalaxy.org</code> with Google:</p>\n<pre><code>https://usegalaxy.org/authnz/google/callback\n</code></pre>\n</li>\n</ul>\n<p>Please mind <code>http</code> and <code>https</code>.</p>\n<p>Having defined your instance URI for an IdP following the aforementioned\ntemplate, set it as the following configuration attribute and use the same URI\nfor when registering your Galaxy as a client with an IdP.</p>\n<pre><code class=\"language-xml\" class=\"..\">&#x3C;redirect_uri> ... &#x3C;/redirect_uri>\n</code></pre>\n<p>For instance:</p>\n<pre><code class=\"language-xml\">&#x3C;redirect_uri>http://localhost:8080/authnz/google/callback&#x3C;/redirect_uri>\n</code></pre>\n<p>As mentioned, each provider supports additional attributes, some required and\nsome optional so make sure to look at the provider-specific pages for how to\nconfigure the specific provider.</p>\n</div>\n"}},"context":{}}