{"hash":"c32ecfdb33b075b0057598b5b9118f3554a398cf","data":{"article":{"id":"19afbdccbcae3ab26c58f5e965868180","title":"Configure Cloud Authorization for Azure","tease":"","image":"","images":{},"category":null,"contact":"","date":null,"content":"<p>On this page we explain how to setup a <em>service principal</em> on Azure, and how to configure Galaxy to assume\nthat <em>service principal</em>. </p>\n<h2 id=\"step-1-create-an-azure-service-principal\"><a href=\"#step-1-create-an-azure-service-principal\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Step 1: Create an Azure Service Principal</h2>\n<ol>\n<li>Goto <a href=\"https://portal.azure.com\" target=\"_blank\" rel=\"noopener noreferrer\">portal.azure.com</a> and login with your Azure credentials. </li>\n<li>\n<p>Select <strong>Azure Active Directory > App registrations</strong>, then click <strong>New registration</strong>\n(as shown on the following figure).</p>\n<p>  <img src=\"/src/authnz/cloud/azure/01.png\" alt=\"image\"></p>\n</li>\n<li>\n<p>Enter a name for the application, and click on the <strong>Register</strong> button (see the following figure).  </p>\n<p><img src=\"/src/authnz/cloud/azure/02.png\" alt=\"image\"></p>\n</li>\n<li>\n<p>On the application <strong>Overview</strong> window, take note of <strong>Application (client) ID</strong> and <strong>Directory (tenant) ID</strong>\n(see the following figure).</p>\n<p>  <img src=\"/src/authnz/cloud/azure/03.png\" alt=\"image\"></p>\n</li>\n<li>\n<p>Select <strong>Certificates &#x26; secrets</strong>, then click on the <strong>New client secret*</strong> button, and take note of the value\n(see the following figure).</p>\n<p>  <img src=\"/src/authnz/cloud/azure/04.png\" alt=\"image\">\n</p>\n</li>\n</ol>\n<h2 id=\"step-2-setup-galaxy-to-use-an-azure-service-principal\"><a href=\"#step-2-setup-galaxy-to-use-an-azure-service-principal\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Step 2: Setup Galaxy to Use an Azure Service Principal</h2>\n<p>To setup Galaxy to use a service principal, you need to <code>POST</code> a payload as the following to\n<code>/api/cloud/authz</code> API of Galaxy: </p>\n<pre><code>{\n  \"provider\": \"azure\",\n  \"authn_id\":\"...\",\n  \"config\": {\n    \"tenant_id\": \"...\",\n    \"client_id\": \"...\",\n    \"client_secret\": \"...\"\n  }\n}\n</code></pre>\n<p>You may send the API request using <code>curl</code> as the following: </p>\n<pre><code class=\"language-shell\"> curl --header \"Content-Type: application/json\" \\\n --request POST \\\n --data '{\"provider\": \"azure\", \"config\": {\"tenant_id\": \"...\",\"client_id\": \"...\",\"client_secret\": \"...\"}}' \\\n https://usegalaxy.org/api/cloud/authz?key=...\n</code></pre>\n<p>This API call with respond with the created Azure authnz record as the following: </p>\n<pre><code class=\"language-json\">{\n    \"model_class\": \"CloudAuthz\",\n    \"config\": {\n    \"client_id\": \"...\",\n    \"client_secret\": \"...\",\n    \"tenant_id\": \"...\"\n    },\n    \"user_id\": \"...\",\n    \"last_activity\": \"2020-12-15 15:37:56.123303\",\n    \"create_time\": \"2020-12-15 21:37:56.125248\",\n    \"description\": \"\",\n    \"last_update\": \"2020-12-15 15:37:56.123284\",\n    \"id\": \"...\",\n    \"provider\": \"azure\",\n    \"authn_id\": null\n}\n</code></pre>\n"}},"context":{}}