{"hash":"c32ecfdb33b075b0057598b5b9118f3554a398cf","data":{"article":{"id":"e79ae905c5852a49e6ae6ecb78c93a7e","title":"Configure Cloud Authorization for AWS","tease":"","image":"","images":{},"category":null,"contact":"","date":null,"content":"<p>On this page we explain how to setup a <em>role</em> on AWS, and how to setup Galaxy to assume that <em>role</em>. </p>\n<h2 id=\"step-1-create-an-aws-role\"><a href=\"#step-1-create-an-aws-role\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Step 1: Create an AWS Role</h2>\n<ol>\n<li>Goto <a href=\"https://aws.amazon.com/iam/\" target=\"_blank\" rel=\"noopener noreferrer\">aws.amazon.com/iam/</a> and login with your AWS credentials. </li>\n<li>\n<p>If not on IAM page, click on <code>Services</code> button and type <code>IAM</code> in the search textbox, and choose the shown\noption (see the following figure).</p>\n<p>  <img src=\"/src/authnz/cloud/aws/aws_01.png\" alt=\"image\"></p>\n</li>\n<li>\n<p>On the AWS IAM page, goto <code>Roles</code> tab and hit <code>Creat role</code> button (see the following figure).</p>\n<p><img src=\"/src/authnz/cloud/aws/aws_02.png\" alt=\"image\"></p>\n</li>\n<li>\n<p>Then click on the <code>Web identity</code> button, and then choose <code>Google</code> from the dropdown of the\n<code>Identity provider</code>, then enter <code>Audience</code> (the <code>client id</code> as issued by Google when registering\nthe Galaxy instance; see <a href=\"/src/authnz/config/oidc/idps/google/index.md\">this page</a>), and then click on\nthe <code>Next: Permissions</code> button (see the following figure).</p>\n<p>  <img src=\"/src/authnz/cloud/aws/aws_03.png\" alt=\"image\"></p>\n</li>\n<li>\n<p>Type <code>s3</code> in the <code>Filter policies</code> search textbox, and choose <code>AmazonS3FullAccess</code>, then\nclick on <code>Next: Tags</code> button. (see the following figure). Alternatively, you can click on the\n<code>Create policy</code> button and define a custom policy for Galaxy.</p>\n<p>  <img src=\"/src/authnz/cloud/aws/aws_04.png\" alt=\"image\"></p>\n</li>\n<li>You may optionally add descriptive tags, then click on the <code>Next: Review</code> button.</li>\n<li>On the review page, enter a name for the role on the <code>Role name</code> textbox, then\nclick on the <code>Create role</code> button.</li>\n<li>Once the role is create, AWS shows the IAM roles page, click on the newly created role.</li>\n<li>Copy <code>Role ARN</code>.</li>\n</ol>\n<p>(You may also refer to AWS documentation <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-idp.html\" target=\"_blank\" rel=\"noopener noreferrer\">on creating roles</a>.)</p>\n<h2 id=\"step-2-setup-galaxy-to-use-an-aws-role\"><a href=\"#step-2-setup-galaxy-to-use-an-aws-role\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Step 2: Setup Galaxy to Use an AWS Role</h2>\n<p>To setup Galaxy to use a role, you need to <code>POST</code> a payload as the following to\n<code>/api/cloud/authz</code> API of Galaxy: </p>\n<pre><code class=\"language-json\">{\n    \"authn_id\": \"...\",\n    \"provider\": \"aws\",\n    \"config\": {\n        \"role_arn\": \"arn:aws:iam::347162595075:role/test\"\n    },\n    \"description\": \"...\"\n}\n</code></pre>\n<p>You can obtain <code>authn_id</code> by submitting a <code>GET</code> request to the <code>/api/authnz/</code> API. </p>\n<div class=\"alert alert-info\" role=\"alert\">\n    **NOTE** that the \"provider\" of authentication referred to by the \"authn_id\" you choose, must be \n    Google (or any provider you chose when creating AWS role) and the audience ID of Galaxy instance \n    on which you are using this feature, must equal with audience you entered when creating the role.\n</div.\n"}},"context":{}}