{"hash":"c32ecfdb33b075b0057598b5b9118f3554a398cf","data":{"article":{"id":"da00dcbc36084cee86adf1baf4408536","title":"User Defined Toolbox Filters","tease":"","image":"","images":{},"category":null,"contact":"","date":null,"content":"<p><a href=\"/src/ToolBox/index.md\">ToolBox</a> filters can be applied by an admin and/or by an user dynamically to filter the large list of tools.</p>\n<div class=\"alert alert-info\" role=\"alert\">\nFilters will only hide Tools from the User Interface, they are still available and can be made visible by means of HTML manipulation. That said this is not a security feature, it is intended to separate multiple groups of Tools and simplify the ToolBox. \n</div>\n<h2 id=\"for-users\"><a href=\"#for-users\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>For Users</h2>\n<p>Users can find ToolBox filters under \"User preferences\" (Top Panel -> Users -> Preferences).</p>\n<div class='center'> <a href='/src/user-defined-toolbox-filters/user_preferences.png'><img src=\"/src/user-defined-toolbox-filters/user_preferences.png\" alt=\"User Preferences\" /></a> </div>\n<p>If you do not see any filters to choose (like in the following image) your administrator has not configured any filter for you. Otherwise you will see something like the following. Choose your filters, apply the changes and reload Galaxy. Done!</p>\n<div class='center'> <a href='/src/user-defined-toolbox-filters/toolbox_filter_ui.png'><img src=\"/src/user-defined-toolbox-filters/toolbox_filter_ui.png\" alt=\"User Interface\" /></a> </div>\n<h2 id=\"for-administrators\"><a href=\"#for-administrators\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>For Administrators</h2>\n<p>Two types of filters exist:</p>\n<ol>\n<li><code>tool_*</code> filters will be applied for all users and can not be changed by users. Useful for example to hide some tools for some users/groups</li>\n<li><code>user_tool_*</code> filters will be shown under user preferences and can be toggled on and off by runtime from all users. Useful to offer specialized sets of tools for separate analysis.</li>\n</ol>\n<p>Every filter is a small python function under lib/galaxy/tools/filters/. Each function needs to be added to the config/galaxy.ini file (examples are already listed).</p>\n<p>A typical filter function looks like the following. It will check if a tool ID is a certain string and return False if that is the case.\nReturning False means to not display the tool on the left ToolBox, returning True means the opposite.\nPlease note that the python doc string is crucial and the first paragraph will be used as explanation in the User Interface.</p>\n<pre><code class=\"language-python\">def restrict_encode( content, tool ):\n    \"\"\"\n    Disable the random interval ENCODE tool\n\n    This tool filter will disable all the ENCODE tool when enabled.\n    \"\"\"\n    if tool.id == 'random_intervals1':\n        return False\n    return True\n</code></pre>\n<p>You can not only filter for tools ID's, you can also filter for everything that is associate with a Tool, for example the Toolname or the requirements.</p>\n<pre><code class=\"language-python\">def disable_gatk( context, tool ):\n    \"\"\"\n    This tool filter will disable all gatk tools when enabled.\n\n    This can be enabled by renaming this file to examples.py and adding the following to the\n     ``app:main`` section of ``config/galaxy.ini``:\n\n        tool_filters = examples:disable_gatk\n    \"\"\"\n    return not any( [ requirement.name == \"gatk\" for requirement in tool.requirements ] )\n</code></pre>\n<p>An other very powerful feature is, that you can access the Galaxy context to have access for the username or the admin status.\nHere is an example that hides the upload Utility for all users that are not admin users.</p>\n<pre><code class=\"language-python\">def restrict_upload_to_admins( context, tool ):\n    \"\"\"\n    Disable Upload tool for all non-admin users.\n\n    This tool filter will hide the upload tool from all users except admin\n    users.\n\n    This can be enabled by renaming this file to examples.py and adding\n    the following to the ``app:main`` section of ``config/galaxy.ini``:\n\n        tool_filters = examples:restrict_upload_to_admins\n    \"\"\"\n    if tool.name == \"Upload File\":\n        return context.trans.user_is_admin\n    return True\n</code></pre>\n<p>And here you have a list with an explicit User-Tool mapping.</p>\n<pre><code class=\"language-python\">def explicit_user_mapping( context, section ):\n    \"\"\"\n    This tool section filter uses an explicit mapping to describe what users can view\n    which tool sections. Anonymous users will only be able to view the \"Get Data\"\n    tool section (with id getext). This can be enabled by renaming this file to\n    examples.py and adding the following to the ``app:main`` section of\n    ``config/galaxy.ini``:\n\n        tool_section_filters = examples:explicit_user_mapping\n    \"\"\"\n    users_sections = {\n        None: [ \"getext\" ],\n        \"bob@example.com\": [ \"getext\", \"textutil\", \"filter\" ],\n        \"mary@example.com\": [ \"getext\", \"textutil\", \"filter\", \"ngs\" ],\n    }\n    user = context.trans.user\n    email = user and user.email\n    valid_sections = users_sections.get( email, [] )\n    return section.id in valid_sections\n</code></pre>\n<p>Displaying all 'in-development' Tools only to Developers? Here you go ...</p>\n<pre><code class=\"language-python\">DEVELOPERS = [ \"mary@example.com\" ]\n\ndef restrict_development_tools( context, tool ):\n    \"\"\"\n    This tool filter will disable all tools with the string alpha appearing in\n    the version for all users except those explicitly appearing in the DEVELOPERS list\n    defined above. This can be enabled by renaming this file to examples.py and\n    adding the following to the ``app:main`` section of ``config/galaxy.ini``:\n\n        tool_filters = examples:restrict_development_tools\n    \"\"\"\n    version = tool.version\n    user = context.trans.user\n    email = user and user.email\n    return \"alpha\" not in version or email in DEVELOPERS\n</code></pre>\n<p>Want to host the ChemicalToolBox (ctb.my-galaxy.edu) in the same Galaxy instance (galaxy.my-galaxy.edu)\nbut with a different set of default Tools -- dependend on the accessed URL?\nPossible! Just access context.trans.request.host and filter your Tools.</p>\n<pre><code class=\"language-python\">def per_host_tool_sections( context, section ):\n    \"\"\"\n    This tool section filter results in different sections being display based on\n    the URL the user is making the request to. This could allow a single Galaxy instance\n    to seem like several different instances hosting different tools based on the URL used\n    to access the Galxy. This can be enabled by renaming this file to examples.py and adding\n    the following to the ``app:main`` section of ``config/galaxy.ini``:\n\n        tool_section_filters = examples:per_host_tool_sections\n    \"\"\"\n    host = context.trans.request.host\n    # Core tools used by all virtual hosts.\n    valid_sections = [ \"getext\", \"textutil\", \"filter\" ]\n    if \"ngs.galaxy.example.com\" in host:\n        valid_sections += [ \"ngs\" ]\n    elif \"microarray.galaxy.example.com\" in host:\n        valid_sections += [ \"microarray\" ]\n    elif \"proteomics.galaxy.example.com\" in host:\n        valid_sections += [ \"proteomics\" ]\n    return section.id in valid_sections\n</code></pre>\n<p>Restrict tools to certain groups.</p>\n<pre><code class=\"language-python\">def restrict_prims_metabolomics( context, tool ):\n    \"\"\"\n    This tool filter will hide MsClust for non-metabolomics users.\n    \"\"\"\n    user = context.trans.user\n    metabolomics_tools = [\"MsClust\",\"textutil\",\"filter\" ]\n    if tool.namein metabolomics_tools:\n        for user_role in user.roles:\n           if user_role.role.name == \"PRIMS_METABOLOMICS\":\n               returnTrue\n        # not found to have the role, return false:\n        return False\n    else:\n        # return true for any other tool\n        return True\n</code></pre>\n<h3 id=\"note\"><a href=\"#note\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Note</h3>\n<p>This feature is available as of the November 2013 Galaxy distribution, being originally incorporated from Pull Request <a href=\"https://bitbucket.org/galaxy/galaxy-central/pull-request/179/implement-the-ability-to-change-the-tool\" target=\"_blank\" rel=\"noopener noreferrer\">#179</a></p>\n"}},"context":{}}