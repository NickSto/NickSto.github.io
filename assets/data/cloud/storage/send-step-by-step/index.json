{"hash":"c32ecfdb33b075b0057598b5b9118f3554a398cf","data":{"article":{"id":"0318e2d021deae782cf067dbbc39b35c","title":"Send Data to Cloud","tease":"","image":"","images":{},"category":null,"contact":"","date":null,"content":"<p>The <code>send</code> API allows a user to copy data from a Galaxy <code>history</code> to a cloud-based storage (e.g., Amazon S3, and\nMicrosoft Azure BLOB).</p>\n<p>You may use the following steps to use this API:</p>\n<ol>\n<li>Login to Galaxy using your Google account (<a href=\"/src/authnz/config/oidc/index.md\">read how</a>);</li>\n<li>Define a <em>cloud authzorization</em> configuration (<a href=\"/src/authnz/cloud/index.md\">read how</a>);</li>\n<li>Get a Galaxy API key by going to <code>User -> Manage API key</code> On Galaxy's webpage and clicking on the\n<code>Create a new key</code> button;</li>\n<li>\n<p>Make the API call as it follows:</p>\n<p>4.1. Open <a href=\"https://www.getpostman.com\" target=\"_blank\" rel=\"noopener noreferrer\">Postman</a>;</p>\n<p>4.2. Choose <code>POST</code> and enter the following in the fields highlighted in the following figure:</p>\n<pre><code>http://localhost:8080/api/cloud/storage/send?key=1234567890\n</code></pre>\n<p>Replace <code>http://localhost:8080</code> with the IP address of the Galaxy instance you're using, and\nreplace <code>1234567890</code> with the your API key.</p>\n<p><img src=\"/src/cloud/storage/send_01.png\" alt=\"image\"></p>\n<p>4.3. Get the ID of Galaxy <code>history</code> from which you want to copy data, by going to the following\naddress on your browser:</p>\n<pre><code>http://localhost:8080/api/histories\n</code></pre>\n<p>This will display a JSON object similar to the following, note the value of <code>id</code> field:</p>\n<pre><code class=\"language-json\">[\n   {\n      \"name\":\"Unnamed history\",\n      \"tags\":[\n      ],\n      \"deleted\": false,\n      \"purged\": false,\n      \"annotation\": null,\n      \"url\": \"/api/histories/df7a1f0c02a5b08e\",\n      \"published\": false,\n      \"model_class\": \"History\",\n      \"id\": \"df7a1f0c02a5b08e\"\n   }\n]\n</code></pre>\n<p>4.4. Get the ID of authorization defined in step #2, which you want to use to write to the\ncloud-based storage, by going to following address: </p>\n<pre><code>http://localhost:8080/api/cloud/authz\n</code></pre>\n<p>This will display a JSON object similar to the following, note the value of <code>id</code> field:</p>\n<pre><code class=\"language-json\">[\n   {\n      \"authn_id\": \"f2db41e1fa331b3e\",\n      \"user_id\": \"f2db41e1fa331b3e\",\n      \"last_update\": \"2018-12-07 17:53:55.714802\",\n      \"last_activity\": \"2018-12-07 17:53:55.714818\",\n      \"provider\": \"aws\",\n      \"model_class\": \"CloudAuthz\",\n      \"config\": \"{u'role_arn': u'arn:aws:iam:: ...'}\",\n      \"id\": \"f2db41e1fa331b3e\"\n   }\n]\n</code></pre>\n<p>4.5. On Postman, goto <code>Body</code> tab as shown in the following figure and enter the\nfollowing API payload:</p>\n<p><img src=\"/src/cloud/storage/send_02.png\" alt=\"image\"></p>\n<pre><code class=\"language-json\">{\n    \"history_id\": \"03501d7626bd192f\",\n    \"authz_id\": \"f2db41e1fa331b3e\",\n    \"bucket\": \"vahid-objectstore\"\n}\n</code></pre>\n<p>Replace <code>vahid-objectstore</code> with a bucket name to which you want to <code>send</code> data.</p>\n<p>4.6. Click on the <code>Send</code> button; Postman will submit a request to Galaxy to <code>send</code> data\nand will shows a result as the following. </p>\n<pre><code class=\"language-json\">{\n    \"sent_dataset_labels\": [\n        \"{\\\"object\\\": \\\"rep1.bed\\\", \\\"job_id\\\": \\\"3f5830403180d620\\\"}\",\n        \"{\\\"object\\\": \\\"rep2.bed\\\", \\\"job_id\\\": \\\"e85a3be143d5905b\\\"}\"\n    ],\n    \"bucket_name\": \"vahid-objectstore\",\n    \"failed_dataset_labels\": []\n}\n</code></pre>\n<p>This JSON object shows two Galaxy datasets,<code>rep1.bed</code> and <code>rep2.bed</code>, are queued for\nbeing sent to the <code>vahid-objectstore</code> bucket. </p>\n</li>\n</ol>\n"}},"context":{}}